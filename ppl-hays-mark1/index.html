<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hays SPA Template — 4 Themes</title>

  <style>
    /* =========================================================
       THEME TOKENS (4 schemes): Newspaper, Emerald Paper, Cyber Night, Emerald/Gold
       ========================================================= */
    :root{
      /* Newspaper (light) */
      --bg:#f8fafc; --ink:#0f172a; --muted:#475569; --card:#ffffff; --line:#e2e8f0;
      --acc1:#8c1c13; /* headings/accent */
      --nav-bg:#f1f1eb; --nav-border:#dcdcd3; --nav-text:#1c1c1c;
      --nav-hover-bg:#e5e5dd; --nav-active-bg:#e8e8e0; --nav-active-text:#1c1c1c;
    }
    .theme-emerald-paper{
      /* Emerald Paper (light) */
      --bg:#f7fbf9; --ink:#1e2b28; --muted:#2c3b37; --card:#ffffff; --line:#86c8ba;
      --acc1:#0f7f6d;
      --nav-bg:#e7f3ef; --nav-border:#86c8ba; --nav-text:#1e2b28;
      --nav-hover-bg:#d7ece6; --nav-active-bg:#dfeee9; --nav-active-text:#1e2b28;
    }
    .theme-cyber-blue{
      /* Cyber Night (dark blue) — Threaded Reader vibe */
      --bg:rgb(2,6,23); --ink:rgb(203,213,225); --muted:rgb(148,163,184);
      --card:rgb(30,41,59); --line:rgb(51,65,85);
      --acc1:#ffffff;
      --nav-bg:rgb(30,41,59); --nav-border:rgb(51,65,85); --nav-text:rgb(203,213,225);
      --nav-hover-bg:rgb(15,23,42); --nav-active-bg:rgb(39,51,74); --nav-active-text:rgb(203,213,225);
    }
    .theme-emerald-gold{
      /* Emerald / Gold (dark) — neutral selected tabs */
      --bg:linear-gradient(135deg,#022c22 0%,#064e3b 60%,#065f46 100%);
      --ink:#ecfdf5; --muted:#a7f3d0; --card:#064e3b; --line:#0a6a56;
      --acc1:#f0c475;
      --nav-bg:#064e3b; --nav-border:#0a6a56; --nav-text:#ecfdf5;
      --nav-hover-bg:#065f46; --nav-active-bg:#075245; --nav-active-text:#ecfdf5;
    }

    /* =========================================================
       Base UI
       ========================================================= */
    html,body{height:100%}
    body{
      background:var(--bg); color:var(--ink);
      font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial,"Apple Color Emoji","Segoe UI Emoji";
      margin:0;
    }
    a{ color:inherit }
    .muted{ color:var(--muted) }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:.75rem }
    .btn{ padding:.5rem .875rem; border-radius:.5rem; border:1px solid var(--nav-border); background:var(--card); color:var(--ink); transition:.15s }
    .btn:hover{ background:var(--nav-hover-bg) }
    .btn:focus-visible{ outline:3px solid color-mix(in oklab, var(--acc1) 45%, transparent); outline-offset:2px }

    /* Tabs — neutral, theme-safe */
    .tab-btn{
      background:var(--nav-bg); color:var(--nav-text);
      border:1px solid var(--nav-border); border-radius:.5rem; padding:.5rem .75rem;
      transition:.15s;
    }
    .tab-btn:hover, .tab-btn:focus-visible{ background:var(--nav-hover-bg) }
    .tab-btn[aria-selected="true"]{
      background:var(--nav-active-bg); color:var(--nav-active-text); border-color:var(--nav-border); font-weight:600;
    }

    .section-title{ color:var(--acc1) }

    /* Modal */
    .modal{ display:none; position:fixed; inset:0; z-index:50; background:rgba(0,0,0,.6); align-items:center; justify-content:center }
    .modal.show{ display:flex }
    .modal-panel{ background:var(--card); color:var(--ink); border:1px solid var(--nav-border); border-radius:.75rem; min-width:280px; max-width:90vw }
  </style>
</head>
<body class="min-h-screen">

  <!-- Header -->
  <header class="w-full">
    <div class="px-6 py-6" style="background:var(--card); border-bottom:1px solid var(--line)">
      <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
        <div>
          <h1 id="appTitle" class="text-2xl" style="font-weight:700; letter-spacing:-.01em">Loading…</h1>
          <p id="appSubtitle" class="muted mt-1" style="max-width:60ch"></p>
        </div>
        <button id="settingsBtn" class="btn" title="Theme settings" aria-haspopup="dialog" aria-controls="settingsModal">⚙️</button>
      </div>
    </div>

    <!-- Tabs -->
    <nav class="px-6 py-3" role="tablist" aria-label="Primary" style="background:color-mix(in oklab, var(--card) 80%, transparent); border-bottom:1px solid var(--line); display:flex; flex-wrap:wrap; gap:.5rem">
      <button class="tab-btn" data-tab="overview"  aria-selected="true">Overview</button>
      <button class="tab-btn" data-tab="concepts"  aria-selected="false">Concepts</button>
      <button class="tab-btn" data-tab="data"      aria-selected="false">Evidence / Data</button>
      <button class="tab-btn" data-tab="timeline"  aria-selected="false">Timeline</button>
      <button class="tab-btn" data-tab="critiques" aria-selected="false">Critiques</button>
      <button class="tab-btn" data-tab="glossary"  aria-selected="false">Glossary</button>
      <button class="tab-btn" data-tab="source"    aria-selected="false">Source</button>
    </nav>
  </header>

  <!-- Main -->
  <main class="px-6 py-8" style="display:grid; gap:1.25rem">
    <!-- Overview -->
    <section id="tab-overview" role="tabpanel" aria-labelledby="Overview" class="tab-panel">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Context & Takeaways</h2>
        <p id="ovr-intro" class="mb-3" style="margin:.25rem 0 1rem"></p>
        <ul id="ovr-bullets" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
      <div id="ovr-cards" class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem; margin-top:1rem"></div>
    </section>

    <!-- Concepts -->
    <section id="tab-concepts" class="tab-panel hidden" role="tabpanel" aria-labelledby="Concepts">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Core Concepts</h2>
        <p id="con-intro" class="mb-3" style="margin:.25rem 0 1rem"></p>
        <ul id="con-bullets" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
      <div id="concepts-grid" class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem; margin-top:1rem"></div>
    </section>

    <!-- Evidence / Data -->
    <section id="tab-data" class="tab-panel hidden" role="tabpanel" aria-labelledby="Evidence / Data">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Evidence / Data</h2>
        <p id="dat-intro" class="mb-3" style="margin:.25rem 0 1rem"></p>
        <ul id="dat-bullets" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
      <div id="data-grid" class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem; margin-top:1rem"></div>
    </section>

    <!-- Timeline -->
    <section id="tab-timeline" class="tab-panel hidden" role="tabpanel" aria-labelledby="Timeline">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Timeline</h2>
        <p id="tim-intro" class="mb-3" style="margin:.25rem 0 1rem"></p>
        <ul id="tim-bullets" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
      <ol id="timeline-list" style="display:grid; gap:.75rem; margin-top:1rem; padding-left:0"></ol>
    </section>

    <!-- Critiques -->
    <section id="tab-critiques" class="tab-panel hidden" role="tabpanel" aria-labelledby="Critiques">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Critiques & Debates</h2>
        <p id="cri-intro" class="mb-3" style="margin:.25rem 0 1rem"></p>
        <ul id="cri-bullets" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
      <div id="critiques-grid" class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem; margin-top:1rem"></div>
    </section>

    <!-- Glossary -->
    <section id="tab-glossary" class="tab-panel hidden" role="tabpanel" aria-labelledby="Glossary">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Glossary</h2>
        <dl id="glossary-grid" class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:1rem; margin-top:1rem"></dl>
      </article>
    </section>

    <!-- Source -->
    <section id="tab-source" class="tab-panel hidden" role="tabpanel" aria-labelledby="Source">
      <article class="card p-6">
        <h2 class="text-xl section-title" style="font-weight:600; margin:0 0 .5rem">Source & Provenance</h2>
        <ul id="prov-list" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem; margin:0 0 1rem"></ul>
        <h3 class="text-lg" style="font-weight:600; margin:.25rem 0 .5rem">Quotes</h3>
        <ul id="quotes-list" class="list-disc" style="padding-left:1.25rem; display:grid; gap:.25rem"></ul>
      </article>
    </section>
  </main>

  <footer class="px-6 py-8 muted" style="font-size:.9rem">
    Hays SPA Template • Single-file — paste content JSON below
  </footer>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal-panel p-5 relative">
      <button id="closeSettings" class="btn" style="position:absolute; right:.75rem; top:.5rem" aria-label="Close settings">✕</button>
      <h3 id="settingsTitle" class="text-lg" style="font-weight:600; margin-bottom:.75rem">Display Settings</h3>
      <div class="space-y-3">
        <div>
          <label for="themeSelect" class="block" style="font-weight:600; margin-bottom:.25rem">Color theme</label>
          <select id="themeSelect" class="btn" style="width:100%">
            <option value="newspaper">Newspaper (Light)</option>
            <option value="emerald-paper">Emerald Paper (Light)</option>
            <option value="cyber-blue">Cyber Night (Dark)</option>
            <option value="emerald-gold">Emerald/Gold (Dark)</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================================================
       vvvvvvvvvvvvvv  INSERT YOUR CONTENT JSON BELOW  vvvvvvvvv
       ========================================================= -->
  <script id="report" type="application/json">
  {
{
  "meta": {
    "title": "Mark 1:1–3 — “Prepare the Way”: Hays on Figural Christology",
    "subtitle": "How Mark’s composite citation (Exod 23:20/Mal 3:1 + Isa 40:3) signals the LORD’s own advent in Jesus",
    "report_provenance": [
      { "label": "Compiled by", "detail": "Instructor v6.1 — Hays Session" },
      { "label": "Last updated", "detail": "2025-09-03" },
      { "label": "Primary sources", "detail": "Mark 1:1–3; Exod 23:20; Mal 3:1; Isa 40:3 (cf. Isa 40–55; Ps 2; Isa 42; Mark 1:10–11; 15:38)" },
      { "label": "Secondary sources", "detail": "Richard B. Hays, Reading Backwards (2014); Echoes of Scripture in the Gospels (2016)" }
    ]
  },
  "sections": [
    {
      "id": "overview",
      "title": "Overview",
      "intro": "Hays reads Mark’s prologue as a figural claim: the way prepared for YHWH in Isaiah is, in Mark’s story, the way for Jesus—so Jesus embodies Israel’s God returning to His people.",
      "bullets": [
        "Mark opens with a composite quotation labeled “in Isaiah,” foregrounding the Isaianic new-exodus horizon.",
        "Identity effect: the “way of the LORD” becomes the way for Jesus, aligning Him with YHWH via LXX kyrios.",
        "Early motifs (wilderness, Jordan, torn heavens) deepen the new-exodus/theophany frame."
      ],
      "items": [
        {
          "id": "o1",
          "label": "Composite as Overture",
          "summary": "Exod 23:20/Mal 3:1 + Isa 40:3 function as Mark’s theological prelude.",
          "detail": "By heading a composite as “in Isaiah,” Mark centers Isaiah’s promise of divine return while weaving in messenger language from Exodus/Malachi."
        },
        {
          "id": "o2",
          "label": "Figural Identification",
          "summary": "Jesus as the LORD’s arrival.",
          "detail": "If John prepares YHWH’s way (Isa 40), yet Jesus arrives after John, the narrative identifies Jesus with Israel’s God—without erasing the texts’ original sense."
        },
        {
          "id": "o3",
          "label": "New-Exodus Horizon",
          "summary": "Wilderness, water, and return from exile.",
          "detail": "Mark’s wilderness/Jordan setting and the “torn heavens” evoke Isaiah 40–55: God breaks in to restore His people."
        },
        {
          "id": "o4",
          "label": "Narrated Christology",
          "summary": "Story + Scripture disclose identity.",
          "detail": "Mark shows who Jesus is by scripting Him into Israel’s Scriptures rather than by abstract titles alone."
        }
      ]
    },
    {
      "id": "concepts",
      "title": "Core Concepts",
      "intro": "Key terms in Hays’s reading of Mark 1:1–3 and its scriptural horizon.",
      "bullets": [
        "Figural reading sees fuller patterns recognized retrospectively after Jesus’ death and resurrection.",
        "Metalepsis: an echo that summons its wider OT context.",
        "Narrative Christology: identity is shown by the story’s scriptural patterning."
      ],
      "items": [
        {
          "id": "c1",
          "label": "Figural Reading",
          "summary": "Later events disclose prefiguring patterns.",
          "detail": "Not free allegory; the OT sense stands, yet is seen anew in light of Christ’s paschal event."
        },
        {
          "id": "c2",
          "label": "Metalepsis",
          "summary": "Echo that pulls in its broader context.",
          "detail": "Quoting Isa 40:3 invokes the new-exodus chapters (Isa 40–55), shaping how we read Mark’s opening scenes."
        },
        {
          "id": "c3",
          "label": "Composite Citation",
          "summary": "Multiple texts as one witness.",
          "detail": "Mark conflates Exod 23:20/Mal 3:1 with Isa 40:3 to craft a single overture about God’s coming."
        },
        {
          "id": "c4",
          "label": "New Exodus",
          "summary": "Promise of divine return and renewal.",
          "detail": "Isaiah anticipates God Himself leading His people from exile; Mark frames Jesus within this hope."
        },
        {
          "id": "c5",
          "label": "Kyrios (Lord)",
          "summary": "LXX rendering of the divine name.",
          "detail": "The Greek kyrios often translates YHWH, easing the Markan identification effect when applied to Jesus."
        },
        {
          "id": "c6",
          "label": "Narrative Christology",
          "summary": "Identity shown in plot and pattern.",
          "detail": "Mark’s Christology emerges from narrative/scriptural choreography more than from formal creedal ascriptions."
        },
        {
          "id": "c7",
          "label": "Schizō — “Torn”",
          "summary": "Heavens/veil rent open.",
          "detail": "Mark 1:10 and 15:38 bookend access to God’s presence, echoing Isa 64:1."
        }
      ]
    },
    {
      "id": "data",
      "title": "Evidence / Data",
      "intro": "Textual signals that support a figural, high-Christology reading in Mark’s prologue.",
      "bullets": [
        "Identity transfer: YHWH’s “way” → Jesus’ way.",
        "LXX semantics: kyrios as YHWH’s title in Greek.",
        "Motif recurrence: wilderness, Jordan, torn heavens, divine voice."
      ],
      "items": [
        {
          "id": "d1",
          "label": "Identity Transfer",
          "summary": "From YHWH’s path to Jesus’ arrival.",
          "detail": "Mark 1:2–3 assigns Isaiah’s highway for the LORD to the one who comes after John—Jesus."
        },
        {
          "id": "d2",
          "label": "LXX Kyrios",
          "summary": "Title that bridges OT to NT usage.",
          "detail": "Kyrios commonly renders the Tetragrammaton; Mark’s “Lord” language can carry divine connotations when applied to Jesus."
        },
        {
          "id": "d3",
          "label": "Motif Recurrence",
          "summary": "Wilderness/Jordan + torn heavens.",
          "detail": "The setting and theophany (1:10–11) align with Isaianic hopes of God’s return and Spirit-anointed Servant."
        },
        {
          "id": "d4",
          "label": "Bookend Tearing",
          "summary": "Heavens (1:10) ↔ veil (15:38).",
          "detail": "Schizō links opening and climax, suggesting renewed access/presence consistent with divine advent."
        },
        {
          "id": "d5",
          "label": "Servant-King Convergence",
          "summary": "Ps 2 + Isa 42 at baptism.",
          "detail": "The heavenly voice blends royal sonship and servant vocation, reinforcing the Isaianic frame."
        }
      ]
    },
    {
      "id": "timeline",
      "title": "Timeline",
      "intro": "From the Greek Scriptures to Mark’s composition and modern articulation.",
      "bullets": [
        "LXX era establishes kyrios = YHWH convention.",
        "Mark’s Gospel opens with Isaianic overture.",
        "Modern scholarship articulates figural logic."
      ],
      "items": [
        { "id": "t1", "label": "3rd–1st c. BCE — Septuagint", "detail": "Greek OT normalizes kyrios for the divine name, shaping NT diction." },
        { "id": "t2", "label": "c. 60–70 CE — Mark Composed", "detail": "Gospel begins with Exod/Mal + Isa composite (1:2–3) as theological overture." },
        { "id": "t3", "label": "Mark 1:10–11 — Baptism Theophany", "detail": "Heavens torn; voice identifies the Son; Spirit descends—new-exodus tones." },
        { "id": "t4", "label": "Mark 15:38 — Veil Torn", "detail": "Temple curtain rips, echoing 1:10 and Isa 64:1; access theme climaxes." },
        { "id": "t5", "label": "2014 — Reading Backwards", "detail": "Hays articulates figural Christology across the Gospels." },
        { "id": "t6", "label": "2016 — Echoes of Scripture in the Gospels", "detail": "Expanded case studies of OT resonances shaping Gospel portraits." }
      ]
    },
    {
      "id": "critiques",
      "title": "Critiques & Debates",
      "intro": "Where readers push back and how Hays’s approach is assessed.",
      "bullets": [
        "Risk of over-reading echoes without controls.",
        "Historical-critical concerns about early Christology.",
        "Source-critical questions about the composite heading."
      ],
      "items": [
        {
          "id": "k1",
          "label": "Over-Reading?",
          "summary": "Echo vs. eisegesis.",
          "detail": "Subtle allusions can be subjective; Hays answers with criteria (availability, volume, recurrence, thematic coherence, satisfaction)."
        },
        {
          "id": "k2",
          "label": "Christology Controls",
          "summary": "Agent vs. identity.",
          "detail": "Some read the “way” as for God’s agent; Hays argues the Isaianic frame and Mark’s motifs press toward divine identity."
        },
        {
          "id": "k3",
          "label": "“In Isaiah” Problem",
          "summary": "Composite under one prophet.",
          "detail": "Mark’s ascription raises source questions; literarily it spotlights Isaiah’s horizon as the governing lens."
        }
      ]
    }
  ],
  "glossary": [
    { "term": "Figural Reading", "definition": "A retrospective, canonical way of seeing earlier texts prefigure later events in Christ without canceling their original sense." },
    { "term": "Metalepsis", "definition": "An echo that invokes the broader context of its source text, shaping interpretation beyond the quoted line." },
    { "term": "Composite Citation", "definition": "A merged quotation of multiple OT passages treated as a single scriptural witness." },
    { "term": "New Exodus", "definition": "Isaiah’s promise that God Himself would return to restore His people, guiding a second, greater deliverance." },
    { "term": "Kyrios", "definition": "Greek ‘Lord’; the Septuagint’s common rendering of YHWH, often bearing divine connotations in the NT." },
    { "term": "Narrative Christology", "definition": "Understanding who Jesus is through the Gospel’s plot, symbols, and scriptural patterning." },
    { "term": "Schizō", "definition": "Greek for “to tear”; used in Mark 1:10 and 15:38 to frame divine access." },
    { "term": "Theophany", "definition": "A manifestation of God’s presence, often marked by voice, Spirit, or cosmic signs." }
  ],
  "quotes": [
    { "text": "Prepare the way of the LORD; make straight in the desert a highway for our God.", "ref": "Isaiah 40:3" },
    { "text": "Behold, I send my messenger before your face, who will prepare your way.", "ref": "Exodus 23:20; Malachi 3:1 (as used in Mark 1:2)" },
    { "text": "He saw the heavens being torn open and the Spirit descending on him like a dove.", "ref": "Mark 1:10" },
    { "text": "And the curtain of the temple was torn in two, from top to bottom.", "ref": "Mark 15:38" }
  ]
}

    /* INSERT YOUR CONTENT JSON HERE.
       Example shape:

       "meta": {
         "title": "Your Title",
         "subtitle": "Short subtitle",
         "report_provenance": [
           { "label": "Compiled by", "detail": "You" },
           { "label": "Last updated", "detail": "2025-09-04" }
         ]
       },
       "sections": [
         { "id":"overview","title":"Overview","intro":"...","bullets":["..."],"items":[{"id":"o1","label":"...","summary":"...","detail":"..."}] },
         { "id":"concepts","title":"Core Concepts","intro":"...","bullets":["..."],"items":[...] },
         { "id":"data","title":"Evidence / Data","intro":"...","bullets":["..."],"items":[...] },
         { "id":"timeline","title":"Timeline","intro":"...","bullets":["..."],"items":[...] },
         { "id":"critiques","title":"Critiques","intro":"...","bullets":["..."],"items":[...] }
       ],
       "glossary":[ { "term":"...", "definition":"..." } ],
       "quotes":[ { "text":"...", "ref":"..." } ]
    */
  }
  </script>
  <!-- =========================================================
       ^^^^^^^^^^^^^^^^  INSERT JSON ABOVE  ^^^^^^^^^^^^^^^^^^^^
       ========================================================= -->

  <script>
    // ---------- Parse single-block content ----------
    let AppData = {};
    try {
      const raw = document.getElementById('report').textContent.trim();
      AppData = raw ? JSON.parse(raw) : { meta:{title:'Untitled',subtitle:''}, sections:[], glossary:[], quotes:[] };
    } catch (e) {
      console.error('JSON parse error:', e);
      AppData = { meta:{title:'Untitled',subtitle:''}, sections:[], glossary:[], quotes:[] };
    }

    // ---------- Theme ----------
    const root = document.documentElement;
    const themeSelect = document.getElementById('themeSelect');
    function applyTheme(key){
      root.classList.remove('theme-emerald-paper','theme-cyber-blue','theme-emerald-gold');
      if(key==='emerald-paper') root.classList.add('theme-emerald-paper');
      if(key==='cyber-blue')    root.classList.add('theme-cyber-blue');
      if(key==='emerald-gold')  root.classList.add('theme-emerald-gold');
      localStorage.setItem('hays-theme', key);
    }
    (function initTheme(){
      const saved = localStorage.getItem('hays-theme') || 'newspaper';
      if (themeSelect) themeSelect.value = saved;
      applyTheme(saved);
    })();

    // Settings modal
    const modal = document.getElementById('settingsModal');
    document.getElementById('settingsBtn').addEventListener('click', () => {
      modal.classList.add('show'); modal.setAttribute('aria-hidden','false');
    });
    document.getElementById('closeSettings').addEventListener('click', () => {
      modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
    });
    modal.addEventListener('click', (e)=>{ if(e.target===modal){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }});
    if (themeSelect) themeSelect.addEventListener('change', e => applyTheme(e.target.value));

    // ---------- Helpers ----------
    const $ = (id)=>document.getElementById(id);
    const getSection = (sid)=> (AppData.sections||[]).find(s=>s.id===sid);

    // Header
    $('appTitle').textContent = AppData.meta?.title || 'Untitled';
    $('appSubtitle').textContent = AppData.meta?.subtitle || '';

    // Context helpers
    function fillContext(sectionId, introId, bulletsId){
      const s = getSection(sectionId); if(!s) return;
      $(introId).textContent = s.intro || '';
      const ul = $(bulletsId); ul.innerHTML='';
      (s.bullets||[]).forEach(b=>{
        const li=document.createElement('li'); li.textContent=b; ul.appendChild(li);
      });
    }

    // Overview cards
    (function(){
      const s = getSection('overview');
      if(!s) return;
      fillContext('overview','ovr-intro','ovr-bullets');
      const wrap = $('ovr-cards'); if(!wrap) return; wrap.innerHTML='';
      (s.items||[]).forEach(it=>{
        const card = document.createElement('article');
        card.className = 'card p-5';
        card.style.padding = '1.25rem';
        card.innerHTML = `<h3 class="section-title" style="font-weight:600; margin:0 0 .25rem">${it.label||''}</h3>
                          <p class="muted" style="font-size:.9rem; margin:.15rem 0 .4rem">${it.summary||''}</p>
                          <p style="margin:.25rem 0 0">${it.detail||''}</p>`;
        wrap.appendChild(card);
      });
    })();

    // Concepts
    (function(){
      const s = getSection('concepts'); if(!s) return;
      fillContext('concepts','con-intro','con-bullets');
      const wrap = $('concepts-grid'); if(!wrap) return; wrap.innerHTML='';
      (s.items||[]).forEach(it=>{
        const el=document.createElement('article');
        el.className='card p-5'; el.style.padding='1.25rem';
        el.innerHTML=`<h3 class="section-title" style="font-weight:600; margin:0 0 .25rem">${it.label||''}</h3>
                      <p class="muted" style="font-size:.9rem; margin:.15rem 0 .4rem">${it.summary||''}</p>
                      <p style="margin:.25rem 0 0">${it.detail||''}</p>`;
        wrap.appendChild(el);
      });
    })();

    // Data
    (function(){
      const s = getSection('data'); if(!s) return;
      fillContext('data','dat-intro','dat-bullets');
      const wrap = $('data-grid'); if(!wrap) return; wrap.innerHTML='';
      (s.items||[]).forEach(it=>{
        const el=document.createElement('article');
        el.className='card p-5'; el.style.padding='1.25rem';
        el.innerHTML=`<h3 class="section-title" style="font-weight:600; margin:0 0 .25rem">${it.label||''}</h3>
                      <p class="muted" style="font-size:.9rem; margin:.15rem 0 .4rem">${it.summary||''}</p>
                      <p style="margin:.25rem 0 0">${it.detail||''}</p>`;
        wrap.appendChild(el);
      });
    })();

    // Timeline
    (function(){
      const s = getSection('timeline'); if(!s) return;
      fillContext('timeline','tim-intro','tim-bullets');
      const list = $('timeline-list'); if(!list) return; list.innerHTML='';
      (s.items||[]).forEach(it=>{
        const li=document.createElement('li');
        li.className='card p-4'; li.style.padding='1rem';
        li.innerHTML = `<div class="section-title" style="font-weight:600; margin:0 0 .25rem">${it.label||''}</div>
                        <div>${it.detail||''}</div>`;
        list.appendChild(li);
      });
    })();

    // Critiques
    (function(){
      const s = getSection('critiques'); if(!s) return;
      fillContext('critiques','cri-intro','cri-bullets');
      const wrap = $('critiques-grid'); if(!wrap) return; wrap.innerHTML='';
      (s.items||[]).forEach(it=>{
        const el=document.createElement('article');
        el.className='card p-5'; el.style.padding='1.25rem';
        el.innerHTML=`<h3 class="section-title" style="font-weight:600; margin:0 0 .25rem">${it.label||''}</h3>
                      <p class="muted" style="font-size:.9rem; margin:.15rem 0 .4rem">${it.summary||''}</p>
                      <p style="margin:.25rem 0 0">${it.detail||''}</p>`;
        wrap.appendChild(el);
      });
    })();

    // Glossary
    (function(){
      const wrap = $('glossary-grid'); if(!wrap) return; wrap.innerHTML='';
      (AppData.glossary||[]).forEach(g=>{
        const d=document.createElement('div');
        d.className='card p-5'; d.style.padding='1.25rem';
        d.innerHTML=`<dt class="section-title" style="font-weight:600; margin:0 0 .25rem">${g.term||''}</dt>
                     <dd>${g.definition||''}</dd>`;
        wrap.appendChild(d);
      });
    })();

    // Source
    (function(){
      const pl = $('prov-list'); if(pl){ pl.innerHTML='';
        (AppData.meta?.report_provenance||[]).forEach(p=>{
          const li=document.createElement('li'); li.textContent = `${p.label}: ${p.detail}`; pl.appendChild(li);
        });
      }
      const ql = $('quotes-list'); if(ql){ ql.innerHTML='';
        (AppData.quotes||[]).forEach(q=>{
          const li=document.createElement('li'); li.textContent = `"${q.text}" — ${q.ref}`; ql.appendChild(li);
        });
      }
    })();

    // ---------- Tabs ----------
    const tabs = Array.from(document.querySelectorAll('[data-tab]'));
    const panels = {
      overview: document.getElementById('tab-overview'),
      concepts: document.getElementById('tab-concepts'),
      data: document.getElementById('tab-data'),
      timeline: document.getElementById('tab-timeline'),
      critiques: document.getElementById('tab-critiques'),
      glossary: document.getElementById('tab-glossary'),
      source: document.getElementById('tab-source')
    };
    function activate(key){
      Object.entries(panels).forEach(([k,el])=>{
        el.classList.toggle('hidden', k!==key);
      });
      tabs.forEach(b=> b.setAttribute('aria-selected', b.dataset.tab===key ? 'true':'false'));
      localStorage.setItem('hays-tab', key);
      location.hash = key;
    }
    tabs.forEach(btn=> btn.addEventListener('click', ()=>activate(btn.dataset.tab)));
    window.addEventListener('hashchange', ()=>{
      const k = location.hash.replace('#','');
      if (panels[k]) activate(k);
    });
    // Init tab
    (function(){
      const fromHash = location.hash.replace('#','');
      const saved = localStorage.getItem('hays-tab') || 'overview';
      activate(panels[fromHash] ? fromHash : (panels[saved] ? saved : 'overview'));
    })();
  </script>
</body>
</html>

