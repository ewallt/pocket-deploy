<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>The Roman Empire - A Legacy in Stone</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg,#2c3e50 0%,#34495e 100%);
            --accent-1: #e74c3c;
            --accent-2: #c03b2b;
            --btn-gradient: linear-gradient(45deg,#e74c3c,#c0392b);
            --accent-1-rgb: 231, 76, 60;
            --accent-warning: #ffc107;
            --accent-warning-rgb: 255, 193, 7;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--accent-1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 15px rgba(var(--accent-1-rgb), 0.3));
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* --- FINAL BUTTON RULES START --- */

        /* Base style for ALL buttons */
        .tab-button, #settings-btn, .sector-button {
            padding: 12px 24px;
            background: var(--ui-background);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Specific settings for the icon */
        #settings-btn {
            font-size: 1.2rem;
            padding: 10px 15px;
        }

        /* HOVER state for buttons */
        .tab-button:hover, .sector-button:hover, #settings-btn:hover {
            background: var(--btn-gradient);
            transform: translateY(-2px);
            color: var(--btn-text-hover);
        }

        /* ACTIVE state for selected buttons */
        .tab-button.active, .sector-button.active {
            background: var(--btn-gradient);
            border-color: var(--accent-2);
            transform: translateY(-2px);
            color: var(--btn-text-active);
        }
        
        /* --- FINAL BUTTON RULES END --- */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: #2c3e50;
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
            position: relative;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            color: var(--accent-1);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .modal-content label {
            font-size: 1.1rem;
            margin-right: 10px;
        }

        #theme-select {
            background-color: var(--ui-background);
            color: var(--text-primary);
            border: 1px solid var(--accent-2);
            border-radius: 5px;
            padding: 8px;
            font-size: 1rem;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--text-primary);
            text-decoration: none;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .section-title {
            color: var(--accent-1);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-1);
        }

        .subsection {
            margin: 1.5rem 0;
        }

        .subsection h3 {
            color: var(--accent-1);
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
        }

        .subsection h4 {
            color: var(--accent-2);
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem 0;
        }

        .sector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .sector-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sector-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
        }

        .sector-name {
            color: var(--accent-1);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .casualties-highlight {
            background: rgba(var(--accent-warning-rgb), 0.15);
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid var(--accent-warning);
            margin: 1rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

           .stat-card {
            background: var(--ui-background-accent);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-1);
            display: block;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin-top: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent-1);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.05rem;
            top: 5px;
            width: 12px;
            height: 12px;
            background: var(--accent-1);
            border-radius: 50%;
            border: 2px solid var(--ui-background);
        }

        .timeline-time {
            color: var(--accent-1);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .highlight {
            background: rgba(var(--accent-1-rgb), 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .interactive-map {
            background: var(--container-background-subtle);
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sector-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .sector-detail {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .sector-detail.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            .container {
                padding: 1rem;
            }
            .sector-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script>
    // Self-executing function to manage all theme logic.
    (function() {
        const DEFAULT_THEME_NAME = 'cyber-night';
    
        let THEMES = {
            'cyber-night': {
                '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
                '--accent-1': '#a8b8d0', '--accent-1-rgb': '168, 184, 208',
                '--accent-2': '#8899b3',
                '--btn-gradient': 'linear-gradient(45deg,#1a1a3a,#2e2e5e)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'teal-matrix': {
                '--bg-gradient': 'linear-gradient(135deg,#0a231c 0%,#1a3a31 50%,#2e5e50 100%)',
                '--accent-1': '#ace0d5', '--accent-1-rgb': '172, 224, 213',
                '--accent-2': '#92b3a9',
                '--btn-gradient': 'linear-gradient(45deg,#1a3a31,#2e5e50)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#345e55',
                '--ui-background-accent': 'rgba(52, 94, 85, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'red-alert': {
                '--bg-gradient': 'linear-gradient(135deg,#2c1a1a 0%,#4e2a2a 50%,#5e3a3a 100%)',
                '--ui-background': '#5e3a3a',
                '--ui-background-accent': 'rgba(94, 58, 58, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#e74c3c',
                '--accent-2': '#c03b2b',
                '--btn-gradient': 'linear-gradient(45deg,#e74c3c,#c0392b)',
                '--accent-1-rgb': '231, 76, 60',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--btn-text-active': '#ffffff'
            },
            'scorched-gold': {
                '--bg-gradient': 'linear-gradient(135deg,#2a1d15 0%,#4e3427 50%,#5a4032 100%)',
                '--ui-background': '#5a4032',
                '--ui-background-accent': 'rgba(90, 64, 50, 0.8)',
                '--container-background-subtle': 'rgba(26, 15, 8, 0.3)',
                '--accent-1': '#f0c475',
                '--accent-2': '#d4a24c',
                '--btn-gradient': 'linear-gradient(45deg,#f0c475,#d4a24c)',
                '--accent-1-rgb': '240, 196, 117',
                '--btn-text-active': '#2a1d15',
                '--btn-text-hover': '#2a1d15',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57'
            }
        };

        function finalizeThemes(themes) {
            for (const themeName in themes) {
                const theme = themes[themeName];
                if (!theme['--btn-text-hover']) {
                    theme['--btn-text-hover'] = theme['--btn-text-active'];
                }
            }
            return themes;
        }

        THEMES = finalizeThemes(THEMES);
    
        function applyTheme(name) {
            const theme = THEMES[name];
            if (theme) {
                const root = document.documentElement;
                for (const [key, value] of Object.entries(theme)) {
                    root.style.setProperty(key, value);
                }
            }
        }
    
        window.setTheme = function(name) {
            applyTheme(name);
            localStorage.setItem('roman-theme', name); // Changed storage key
        }
    
        const availableThemeNames = Object.keys(THEMES);
        const savedTheme = localStorage.getItem('roman-theme'); // Changed storage key
        let themeToLoad = DEFAULT_THEME_NAME;

        if (savedTheme && availableThemeNames.includes(savedTheme)) {
            themeToLoad = savedTheme;
        }
        
        applyTheme(themeToLoad);
    
        document.addEventListener('DOMContentLoaded', () => {
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                availableThemeNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    themeSelect.appendChild(option);
                });
                themeSelect.value = themeToLoad;
            }
        });
    })();
    </script>
</head>
<body>
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="close-btn">&times;</button>
            <h3>Display Settings</h3>
            <label for="theme-select">Theme:</label>
            <select id="theme-select" onchange="setTheme(this.value)"></select>
        </div>
    </div>

    <div class="header">
        <h1>The Roman Empire</h1>
        <p>c. 753 BC – 476 AD • Senātus Populusque Rōmānus • Knowledge Base</p>
    </div>

    <div class="nav-tabs">
        <button class="tab-button active" data-tab="overview">Overview</button>
        <button class="tab-button" data-tab="republic">The Republic</button>
        <button class="tab-button" data-tab="empire">The Empire</button>
        <button class="tab-button" data-tab="figures">Key Figures</button>
        <button class="tab-button" data-tab="innovations">Innovations</button>
        <button class="tab-button" data-tab="search">Search</button>
        <button id="settings-btn" title="Settings">⚙️</button>
    </div>

    <div class="container">
        <div id="overview" class="tab-content active">
             <div class="section-card">
                <h2 class="section-title">The Eternal City and Its Legacy</h2>
                <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 2rem;">
                    From its mythical founding to its eventual decline, the history of Rome spans over a millennium, leaving an indelible mark on Western civilization. Evolving from a small city-state into a vast republic and then a dominant empire, Rome's innovations in law, governance, engineering, and language continue to influence the modern world.
                </p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">>1,200</span>
                        <div class="stat-label">Years of History</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~60M</span>
                        <div class="stat-label">Peak Population</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">>50,000</span>
                        <div class="stat-label">Miles of Roads Built</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">22%</span>
                        <div class="stat-label">of World Population (at peak)</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="republic" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Roman Republic (509 BC – 27 BC)</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-time">509 BC</div>
                        <h4>Founding of the Republic</h4>
                        <p>The overthrow of the last Roman king, Lucius Tarquinius Superbus, marks the establishment of the Republic. Power is vested in elected officials, principally two consuls, and the Senate.</p>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-time">264–146 BC</div>
                        <h4>The Punic Wars</h4>
                        <p>A series of three major wars fought between Rome and its rival, Carthage. Rome's ultimate victory, despite Hannibal's brilliant campaigns, established its dominance over the Mediterranean.</p>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-time">73 BC</div>
                        <h4>Spartacus' Revolt</h4>
                        <p>The most famous slave revolt in Roman history, led by the gladiator Spartacus. Though ultimately crushed by the legions of Crassus, the rebellion shook the Republic to its core.</p>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-time">44 BC</div>
                        <h4>Assassination of Julius Caesar</h4>
                        <p>After being declared "dictator in perpetuity," Caesar is assassinated by a group of senators fearing his power. His death plunges Rome into a new series of civil wars.</p>
                    </div>
                     <div class="timeline-item">
                        <div class="timeline-time">27 BC</div>
                        <h4>Rise of Augustus</h4>
                        <p>After defeating Mark Antony and Cleopatra, Caesar's heir Octavian is granted the title "Augustus" by the Senate, marking the end of the Republic and the beginning of the Roman Empire.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="empire" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Roman Empire (27 BC – 476 AD)</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <div class="sector-name">Pax Romana (27 BC - 180 AD)</div>
                        <p>The "Roman Peace," a two-century period of unprecedented stability, prosperity, and imperial expansion. The Empire reached its greatest extent under Emperor Trajan, stretching from Britain to Mesopotamia.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">The Five Good Emperors</div>
                        <p>A succession of rulers (Nerva, Trajan, Hadrian, Antoninus Pius, and Marcus Aurelius) who presided over the peak of the Empire's power and prosperity, noted for their administrative skill and peaceful successions.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">Crisis of the Third Century</div>
                        <p>A period of intense political instability, civil war, plague, and economic depression that nearly caused the collapse of the Empire. Order was eventually restored by emperors like Diocletian.</p>
                        <div class="casualties-highlight">
                            <strong>Result:</strong> Empire split into Eastern and Western halves for easier administration.
                        </div>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">The Fall of the West</div>
                        <p>A combination of internal decay, economic troubles, and constant invasions by barbarian tribes led to the gradual decline of the Western Roman Empire, culminating in the deposition of the last emperor, Romulus Augustulus, in 476 AD.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="figures" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Key Figures</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">Julius Caesar</h3>
                        <p>A brilliant general and politician who conquered Gaul and played a critical role in the events that led to the demise of the Roman Republic and the rise of the Empire.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">Augustus (Octavian)</h3>
                        <p>The first Roman Emperor. He ended a century of civil wars and initiated the Pax Romana, transforming Rome with massive building projects and reforms.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">Constantine the Great</h3>
                        <p>Emperor who reunited the Empire, moved the capital to Constantinople, and became the first emperor to convert to Christianity, profoundly changing the course of Roman and European history.</p>
                    </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Cicero</h3>
                        <p>A renowned statesman, lawyer, and philosopher. His writings and speeches are considered some of the greatest examples of Latin prose and were hugely influential on later European thought.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="innovations" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Roman Innovations</h2>
                <div class="sector-grid">
                     <div class="sector-card">
                        <h3 class="sector-name">Roman Law</h3>
                        <p>Developed sophisticated legal principles like "innocent until proven guilty" and the concept of a written legal code (The Twelve Tables), which form the basis of many modern legal systems.</p>
                     </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Concrete & The Arch</h3>
                        <p>Mastery of these two technologies allowed the Romans to build massive, durable structures like the Colosseum, Pantheon, and extensive aqueduct systems that still stand today. </p>
                     </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Roads and Highways</h3>
                        <p>The Romans constructed over 50,000 miles of paved roads ("All roads lead to Rome") to facilitate rapid troop movement, trade, and communication across their vast empire.</p>
                     </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Julian Calendar</h3>
                        <p>Introduced by Julius Caesar, this calendar, with its system of 365 days and a leap year, was the standard in the Western world for over 1,600 years and is the basis for our modern Gregorian calendar.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="search" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Search the Knowledge Base</h2>
                <input type="text" id="searchInput" class="search-box" placeholder="Search for emperors, battles, innovations...">
                
                <div id="searchResults">
                    <p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">
                        Enter a search term above to explore Roman history.<br>
                        Try searching for: "Caesar", "Colosseum", "Punic Wars", "Augustus", "Concrete", etc.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Knowledge base for searching
        const knowledgeBase = {
            "Caesar": "Gaius Julius Caesar was a Roman general and statesman who played a critical role in the events that led to the demise of the Roman Republic and the rise of the Roman Empire.",
            "Augustus": "The founder of the Roman Empire and its first Emperor, ruling from 27 BC until his death in AD 14. He initiated an era of relative peace known as the Pax Romana.",
            "Punic Wars": "A series of three wars fought between Rome and Carthage from 264 to 146 BC. They were among the largest wars of the ancient world and resulted in Roman dominance over the Mediterranean.",
            "Colosseum": "An oval amphitheater in the center of Rome, Italy. Built of travertine limestone, tuff, and brick-faced concrete, it was the largest amphitheater ever built at the time and held 50,000–80,000 spectators.",
            "Concrete": "Roman concrete (Opus caementicium) was a material used in construction during the late Roman Republic and the Empire. Its durability allowed for the construction of massive structures like the Pantheon dome.",
            "Aqueducts": "Romans constructed numerous aqueducts to bring water from distant sources into their cities and towns, supplying public baths, latrines, fountains, and private households.",
            "Legions": "The Roman legion was the largest military unit of the Roman army. It was a highly organized and disciplined force that was key to Rome's military supremacy.",
            "Constantine": "Constantine the Great was a Roman emperor from AD 306 to 337. He was the first Roman emperor to convert to Christianity and played an influential role in the proclamation of the Edict of Milan in 313, which declared religious tolerance for Christianity in the Roman empire.",
            "SPQR": "An abbreviation for Senātus Populusque Rōmānus ('The Roman Senate and People'), referring to the government of the ancient Roman Republic."
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeSectorButtons();
            initializeSearch();
            initializeModal();
        });

        function initializeModal() {
            const modal = document.getElementById('settings-modal');
            const openBtn = document.getElementById('settings-btn');
            const closeBtn = document.getElementById('close-modal-btn');

            if (modal && openBtn && closeBtn) {
                openBtn.addEventListener('click', () => modal.classList.add('show'));
                closeBtn.addEventListener('click', () => modal.classList.remove('show'));
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) modal.classList.remove('show');
                });
            }
        }

        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        }

        function showTab(tabName) {
            try {
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            } catch (error) { console.error('Error in showTab:', error); }
        }

        function initializeSectorButtons() {
            const sectorButtons = document.querySelectorAll('.sector-button');
            sectorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sectorName = this.getAttribute('data-sector');
                    showSectorDetail(sectorName, this);
                });
            });
        }

        function showSectorDetail(sector, clickedButton) {
            try {
                document.querySelectorAll('.sector-detail').forEach(detail => detail.classList.remove('show'));
                document.querySelectorAll('.sector-button').forEach(button => button.classList.remove('active'));
                const targetDetail = document.getElementById(sector + '-detail');
                if (targetDetail) {
                    targetDetail.classList.add('show');
                    clickedButton.classList.add('active');
                }
            } catch (error) { console.error('Error in showSectorDetail:', error); }
        }

        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keyup', searchContent);
            }
        }

        function searchContent() {
            try {
                const searchInput = document.getElementById('searchInput');
                const resultsDiv = document.getElementById('searchResults');
                if (!searchInput || !resultsDiv) return;
                
                const searchTerm = searchInput.value.toLowerCase();

                if (searchTerm.length < 2) {
                    resultsDiv.innerHTML = `<p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">Enter a search term above to explore Roman history.<br>Try searching for: "Caesar", "Colosseum", "Punic Wars", "Augustus", "Concrete", etc.</p>`;
                    return;
                }

                let results = [];
                for (const key in knowledgeBase) {
                    if (knowledgeBase.hasOwnProperty(key)) {
                        const value = knowledgeBase[key];
                        if (key.toLowerCase().includes(searchTerm) || value.toLowerCase().includes(searchTerm)) {
                            results.push({
                                title: key,
                                content: value,
                                relevance: key.toLowerCase().startsWith(searchTerm) ? 2 : 1
                            });
                        }
                    }
                }

                results.sort((a, b) => b.relevance - a.relevance);

                if (results.length === 0) {
                    resultsDiv.innerHTML = `<div class="section-card"><h3 style="color: var(--accent-1);">No results found for "${searchInput.value}"</h3><p>Try searching for emperors, battles, or innovations.</p></div>`;
                    return;
                }

                let resultHTML = `<h3 style="color: var(--accent-1); margin-bottom: 1.5rem;">Search Results for "${searchInput.value}"</h3>`;
                for (let i = 0; i < results.length; i++) {
                    const result = results[i];
                    const highlightedContent = result.content.replace(new RegExp(searchTerm, 'gi'), `<span class="highlight">$&</span>`);
                    resultHTML += `<div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--accent-1);"><h4 style="color: var(--accent-1); margin-bottom: 0.8rem;">${result.title}</h4><p style="line-height: 1.6;">${highlightedContent}</p></div>`;
                }

                resultsDiv.innerHTML = resultHTML;
            } catch (error) { console.error('Error in searchContent:', error); }
        }
    </script>
</body>
</html>
