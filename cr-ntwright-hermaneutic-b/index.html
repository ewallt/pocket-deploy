<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Course Template</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com/3.4.1?plugins=typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

<style>
  /* Default Theme: Newspaper */
  :root {
    --bg-gradient: #fdfdf8;
    --text: #1c1c1c;
    --accent-text: #8c1c13;
    --nav-bg: #f1f1eb;
    --nav-border: #dcdcd3;
    --nav-text: #1c1c1c;
    --nav-hover-bg: #e5e5dd;
    --nav-active-bg: #dcdcd3;
    --nav-active-text: #1c1c1c;
    --prose-text: var(--text);
    --prose-headings: var(--accent-text);
    --prose-links: var(--accent-text);
    --prose-bold: var(--text);
    font-family: 'Merriweather', serif;
  }

  .theme-emerald-paper,
  .theme-cyber-blue,
  .theme-emerald-gold {
    font-family: 'Lato', sans-serif;
  }

  body {
    background: var(--bg-gradient);
    color: var(--text);
    min-height: 100vh;
  }

  .ui-bg { background-color: var(--nav-bg); }
  .ui-border { border-color: var(--nav-border); }
  .text-primary { color: var(--text); }
  .text-accent { color: var(--accent-text); }

  .tab-button {
    background-color: var(--nav-bg);
    color: var(--nav-text);
    border-bottom: 3px solid transparent;
  }
  .tab-button:hover,
  .tab-button:focus-visible {
    background-color: var(--nav-hover-bg);
  }
  .tab-button.tab-active {
    background-color: var(--nav-active-bg);
    color: var(--nav-active-text);
    border-bottom-color: var(--accent-text);
  }

  .settings-button { background-color: var(--nav-hover-bg); }
  .settings-button:hover { opacity: 0.8; }
  *:focus-visible { outline: 3px solid var(--accent-text); outline-offset: 2px; }

  .prose { color: var(--prose-text); }
  .prose h2,
  .prose h3,
  .prose a,
  .prose strong { color: var(--prose-headings); }
  .prose p.lead { color: var(--prose-text); }

  /* Navy (Dark) overrides */
  .theme-cyber-blue .tab-button.tab-active {
    background-color: #1f2937; /* slate-800 */
    color: #e5e7eb;           /* slate-200 */
    border-bottom-color: #3b82f6; /* blue-500 */
    box-shadow: inset 0 -2px 0 0 #3b82f6;
  }
  .theme-cyber-blue .prose a {
    color: #60a5fa;              /* blue-400 */
    text-decoration-color: #60a5fa;
  }
  .theme-cyber-blue .prose a:hover {
    color: #93c5fd;              /* blue-300 */
    text-decoration-color: #93c5fd;
  }
</style>

</head>
<body class="transition-colors duration-300">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <header id="app-header" class="ui-bg border ui-border rounded-lg shadow-lg p-6 mb-6"></header>
        <nav id="app-tabs" class="ui-bg border ui-border rounded-lg shadow-lg mb-6" role="tablist" aria-label="Main navigation"></nav>
        <main id="app-panels" class="ui-bg border ui-border rounded-lg shadow-lg p-6 md:p-8"></main>
        
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="settings-title">
            <div class="ui-bg border ui-border rounded-lg p-6 max-w-md w-full shadow-2xl">
                <h2 id="settings-title" class="text-xl font-bold text-accent mb-4">Display Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="themeSelect" class="block text-primary font-semibold mb-2">Theme</label>
                        <select id="themeSelect" class="w-full px-3 py-2 rounded ui-bg border ui-border text-primary">
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button id="closeSettings" class="px-4 py-2 rounded text-primary hover:opacity-80">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 
    ============================================================
    vvvvvvvvvvvvvv PASTE YOUR JSON CONTENT BELOW vvvvvvvvvvvvvv
    ============================================================
    -->
    <script type="application/json" id="app-data">
{
  "ntw-paul-church-public": {
    "title": "NT Wright — Paul, Church & Public Theology",
    "description": "A 6-unit exploration of Paul’s theology, the church’s life, hope, and mission.",
    "categories": {
      "unit-7-paul-justification-covenant": {
        "display_order": 10,
        "name": "Unit 7: Paul — Justification & Covenant",
        "display_name": "Unit 7",
        "paragraphs": [
          {
            "heading": "Covenant and law-court",
            "content": "Paul’s justification language borrows the law-court’s declaration of status, but the courtroom serves the larger covenant story. The judge’s verdict is not a private feeling but a public announcement that certain people are now and truly members of God’s family. In Wright’s reading, God’s single-plan-through-Israel-for-the-world reaches its long-promised climax in the Messiah; justification is God’s present declaration that all who belong to the Messiah belong to that family. The verdict, issued in the present on the basis of the Messiah’s faithfulness and received by faith, creates a community here and now that anticipates the final judgment."
          },
          {
            "heading": "The righteousness of God",
            "content": "“God’s righteousness” is not a moral substance transferred to sinners but God’s own covenant faithfulness revealed in the gospel. It is God being true to his promises to Abraham, putting the world right by putting people right, and doing so through the faithfulness of Jesus the Messiah. When Paul says the righteousness of God has been unveiled, he claims that the Creator is keeping covenant in a way that both judges and rescues, condemns sin and sets the captives free. The gospel thus unveils who God has always been: faithful, just, and merciful."
          },
          {
            "heading": "Badge of membership",
            "content": "If the covenant has reached its goal in the Messiah, the badge of belonging can no longer be Torah boundary markers that separated Jew from Gentile. In Paul’s churches the Spirit and faith in Jesus function as the new identity markers, creating one table where formerly divided peoples now share bread. This is not a downgrade of Torah but its fulfillment: the law’s intention—love of God and neighbor—becomes reality in Spirit-formed communities. The practical test of justification’s truth is whether diverse believers eat together as one family."
          },
          {
            "heading": "Abraham and the nations",
            "content": "For Paul, the inclusion of the nations is not a late add-on; it is the point of the promise to Abraham. The Messiah, as Abraham’s seed, gathers Jews and Gentiles into one renewed family, fulfilling the covenant that through Abraham’s offspring all the families of the earth would be blessed. The gospel is therefore not a message about escaping the world but about God launching the worldwide family that will carry his restorative purposes into creation."
          },
          {
            "heading": "Works of the law",
            "content": "“Works of the law” in Paul are not generic moral effort; they are practices that functioned as Jewish identity markers—circumcision, food laws, special days—meant to guard the people until the time of fulfillment. With the Messiah’s arrival and the Spirit’s gift, those markers no longer define membership. Paul does not disparage the law; he reframes it. The law was a wise custodian whose time has passed because the promised maturity has arrived in Christ and the Spirit."
          },
          {
            "heading": "Present verdict, future judgment",
            "content": "Justification is God’s present declaration that anticipates the verdict of the last day. Those who are “in the Messiah” by faith and indwelt by the Spirit can have confidence that the future judgment will confirm in public what God has already said in the present. The Spirit’s transformative work does not replace grace with earning; it shows that the life of the age to come is already at work, aligning the community’s actual life with its declared status."
          },
          {
            "heading": "Ethical entailments",
            "content": "Because justification creates one family, its first ethical entailment is visible unity across ethnic and social lines. The renewed people practice reconciliation, economic generosity, and table fellowship that refuses class distinctions. Paul’s fiercest rebukes fall on communities that confess the right doctrine but deny it by segregated meals or status games. The verdict ‘in the right’ must become a culture of right-making practices."
          },
          {
            "heading": "Unity for mission",
            "content": "Paul’s vision is not unity for its own sake but unity for the sake of God’s mission. A reconciled, multiethnic family is the advance sign of new creation and the vehicle through which the royal announcement travels. Communities that embody the gospel’s social reality commend the message in the public square far more persuasively than words alone."
          }
        ]
      },
      "unit-8-participation-in-christ": {
        "display_order": 20,
        "name": "Unit 8: Paul — Participation in Christ",
        "display_name": "Unit 8",
        "paragraphs": [
          {
            "heading": "Union with the Messiah",
            "content": "For Paul, salvation is not merely the transfer of a legal status; it is incorporation into the Messiah himself. To be “in Christ” is to share his story and benefits—his death to sin, his vindicating life, his sonship before the Father. This participatory union is the engine of Christian identity: believers are who they are because they belong to the faithful one whose obedience has remade the human story."
          },
          {
            "heading": "Dying and rising with him",
            "content": "Baptism is the enacted doorway into participation: the old solidarity with Adam is drowned, and a new solidarity with the Messiah is born. The believer’s former slavery to sin loses its legal claim because the death that sin demanded has already occurred—in Christ’s cross—and resurrection life now stands on the other side. The ethical implication is stark: do not present your bodies to the old regime; you belong to the new world that began with Easter."
          },
          {
            "heading": "New Adam, new creation",
            "content": "Jesus is the new Adam, head of a renewed human family. In him, image-bearing is restored and the fractures that run through creation begin to heal. The church is not an optional spiritual association but the first fruits of God’s reclamation project, a people whose existence declares that new creation has already broken into the present age."
          },
          {
            "heading": "Life in the Spirit",
            "content": "Participation is powered by the Spirit, whose indwelling presence fulfills the law’s intent by forming cruciform love. The Spirit liberates from the tyranny of the flesh—not merely bodily desires but the whole pattern of self-asserting life—and trains habits that mirror the Messiah’s faithfulness. The fruit the Spirit grows is the lived evidence that union is real."
          },
          {
            "heading": "Suffering and glory",
            "content": "Union with Christ includes union with his sufferings. Far from contradicting God’s favor, affliction marks the path the Messiah walked and becomes the arena where resurrection power is displayed. The Spirit bears witness that present groaning will give way to glory, and communities learn hope by carrying one another’s crosses."
          },
          {
            "heading": "Election redefined",
            "content": "In Paul’s retelling, election is concentrated in the chosen one and then shared with all who are in him. The boundary of the people of God is not ethnocentric but Christocentric. This reframing both honors Israel’s unique role and opens the covenant to the nations, fulfilling the ancient promises without erasing Israel’s story."
          },
          {
            "heading": "Ethics of participation",
            "content": "Participation ethics are not rules bolted on after the fact; they are the shape of shared life with the crucified and risen Lord. Forgiveness, sexual holiness, truth-telling, and economic generosity are not techniques for self-improvement but the practices that fit people who live from resurrection power. The question is always: does this align with who we now are in the Messiah?"
          },
          {
            "heading": "Ecclesial identity",
            "content": "To be in Christ is to be in his body. There is no solitary Christianity in Paul. Gifts are given for mutual upbuilding, authority is exercised for service, and the many learn to speak the truth in love so that the whole body grows into maturity. Participation is personal but never private."
          }
        ]
      },
      "unit-9-church-sacraments-worship": {
        "display_order": 30,
        "name": "Unit 9: Church, Sacraments, Worship",
        "display_name": "Unit 9",
        "paragraphs": [
          {
            "heading": "Church as new temple",
            "content": "The Spirit indwells a living temple composed of reconciled people. In Christ, God’s presence is no longer tied to stone and geography but to a community that becomes the place of forgiveness and new creation. The church’s ordinary life—table, teaching, prayer, discipline—constitutes a portable holy space where heaven and earth meet."
          },
          {
            "heading": "Baptism as enactment",
            "content": "Baptism is not an isolated symbol but the covenant doorway: it enacts dying and rising with Christ, naming, washing, and incorporation into one family. Because it marks shared identity, baptism also commissions a shared vocation. Those who have passed through the waters belong to a people called to holiness and mission."
          },
          {
            "heading": "Eucharist as participation",
            "content": "At the table the church shares the Messiah’s life and proclaims his death until he comes. The meal embodies unity—one bread, one body—and trains gratitude as the community’s baseline posture. To eat and drink “in the Lord” is to discern the body both sacramentally and socially: we cannot celebrate communion while tolerating divisions that deny the gospel."
          },
          {
            "heading": "Worship and transformed minds",
            "content": "Worship in Paul is not confined to music or moments; it is the presentation of our whole selves as living sacrifices. As minds are renewed by the gospel’s story, communities learn to test and approve what is good, beautiful, and fitting. Liturgy and life interpenetrate: gathered praise forms scattered obedience."
          },
          {
            "heading": "Gifts and unity in diversity",
            "content": "The risen Lord distributes gifts by the Spirit for the common good. Leadership exists to equip the saints, not to replace them; authority is cruciform or it is not Christian. Unity does not require uniformity: the many members, rightly ordered in love, display the Messiah’s fullness more richly than any single part could."
          },
          {
            "heading": "Holiness in community",
            "content": "Because the church is God’s temple, holiness matters. Discipline and mercy walk together as communities confront sin for the sake of healing and witness. Sexual integrity, truthful speech, and economic fairness are not sectarian concerns; they are public signs that a different king is present."
          },
          {
            "heading": "Reconciliation as a sign",
            "content": "The gospel’s credibility is tested at the fault lines of human society. When enemies eat at one table, when the poor are honored, when ethnic hostility gives way to family affection, the church becomes a living apologetic. Reconciliation is not a program but the social shape of salvation."
          },
          {
            "heading": "Public witness of the local church",
            "content": "Each congregation is an embassy of the kingdom in its neighborhood. Its worship, governance, and common life are a public good, not a private hobby. The church’s stability, generosity, and peacemaking become signposts that point beyond themselves to the coming renewal of all things."
          }
        ]
      },
      "unit-10-eschatology-new-creation": {
        "display_order": 40,
        "name": "Unit 10: Eschatology — New Heavens & Earth",
        "display_name": "Unit 10",
        "paragraphs": [
          {
            "heading": "Renewal, not evacuation",
            "content": "Christian hope is the renewal of creation, not escape from it. The resurrection of Jesus affirms the goodness of bodies, land, and culture, promising their transformation rather than their disposal. The biblical end is not the soul’s permanent departure but God dwelling with humanity in a world finally put right."
          },
          {
            "heading": "The Lord’s return",
            "content": "Parousia imagery is royal and covenantal: the world’s true ruler will appear to judge evil and set things right. Trumpets, clouds, and welcome-processions are not forecasts of flight schedules but the symbolic language of enthronement. The church lives in alert allegiance, confident that the one who reigns will be seen to reign."
          },
          {
            "heading": "Resurrection hope",
            "content": "What happened to Jesus will happen to his people and, through them, to creation. The final resurrection is bodily and corporate, the Creator’s ‘yes’ to the goodness of the world he made. This hope dignifies grief and steadies courage: death is an enemy to be defeated, not a friend to be embraced."
          },
          {
            "heading": "Judgment as good news",
            "content": "Divine judgment is the long-promised end of evil and the vindication of faithful love. For those in the Messiah, judgment is not terror but the moment when God’s just verdict is publicly announced. Far from undermining grace, judgment is grace’s final victory over everything that destroys."
          },
          {
            "heading": "Israel and the nations",
            "content": "Paul envisages a future in which God’s mercy to Israel and the ingathering of the nations testify to the irrevocable wisdom of the covenant plan. The church does not replace Israel; it is grafted in. Hope for the world is inseparable from hope for the people through whom the world’s Messiah came."
          },
          {
            "heading": "Intermediate hope clarified",
            "content": "To be ‘with the Lord’ after death is real comfort, but it is penultimate. The final Christian hope is resurrection and renewed creation, when heaven and earth are married and God is all in all. This clarification protects the church from otherworldly piety and anchors discipleship in concrete expectation."
          },
          {
            "heading": "Ethics energized by hope",
            "content": "Because the future is guaranteed, present labor matters. Work in the Lord is not in vain; acts of justice, beauty, and evangelism are woven into God’s coming world. Hope does not create passivity but perseverance, a stubborn refusal to cede neighborhoods, vocations, and imaginations to the powers."
          },
          {
            "heading": "Practices of hope",
            "content": "Communities rehearse hope through lament and praise, Sabbath and generosity, patient peacemaking and courageous witness. These practices train desire toward the world God has promised and inoculate against fear. The church learns to live as if the resurrection is true because it is."
          }
        ]
      },
      "unit-11-mission-public-theology": {
        "display_order": 50,
        "name": "Unit 11: Mission & Public Theology",
        "display_name": "Unit 11",
        "paragraphs": [
          {
            "heading": "Jesus is Lord (and Caesar is not)",
            "content": "The gospel is a royal announcement with public implications. To confess Jesus as Lord is to unmask idols—political, economic, cultural—and to call rulers and systems to account. The church’s political posture is neither withdrawal nor domination but faithful presence that embodies a different kind of power: the cruciform authority of service."
          },
          {
            "heading": "Evangelism as announcement",
            "content": "Mission is not primarily the transfer of religious goods; it is the proclamation that the crucified and risen Jesus now reigns. The call is to repent, believe, and be baptized into a community that displays the reality of that reign. Narrative apologetics—telling the big story and inviting people in—replaces reduction to isolated propositions."
          },
          {
            "heading": "Justice and mercy",
            "content": "Kingdom mission includes caring for the poor, welcoming the stranger, and defending the vulnerable. These are not distractions from evangelism but expressions of the royal news that the world’s true king is setting things right. Mercy and righteousness belong together because they meet in the cross."
          },
          {
            "heading": "Beauty as mission",
            "content": "Truth and goodness are joined by beauty as a mode of witness. Music, craft, architecture, and celebration can be sacraments of new creation, hinting at the world to come. In a cynical age, beauty trains desire toward the Creator’s generous abundance."
          },
          {
            "heading": "Peacemaking and nonviolence",
            "content": "Enemy-love is not an optional virtue for unusually saintly Christians; it is the social ethic that fits people saved by a crucified Lord. The church renounces vengeance and learns to seek reconciliation in homes, congregations, and nations. This is a hard road, but it is the road the King himself walked."
          },
          {
            "heading": "Work and vocation",
            "content": "Vocation is broader than church programs. Bakers, teachers, coders, and caregivers participate in God’s project of putting the world right when their work is done in faith, hope, and love. The line between ‘sacred’ and ‘secular’ dissolves under the lordship of Jesus."
          },
          {
            "heading": "Political engagement without captivity",
            "content": "Christians act for the common good while refusing the idolatries of partisan identity. The cross critiques all power—including our own—so that we can speak truth without grasping and serve our neighbors without fear. The church’s independence is not aloofness but the freedom to love across tribal lines."
          },
          {
            "heading": "Communities of credibility",
            "content": "The most persuasive public theology is a congregation that actually lives the story it tells. Transparent leadership, economic sharing, chastity and compassion, hospitality to outsiders—these ordinary graces become a social apologetic. Mission runs on the plausibility created by a reconciled people."
          }
        ]
      },
      "unit-12-virtue-discipleship": {
        "display_order": 60,
        "name": "Unit 12: Virtue & Discipleship",
        "display_name": "Unit 12",
        "paragraphs": [
          {
            "heading": "Virtue after you believe",
            "content": "Salvation launches a long apprenticeship in Christlike character. Grace does not cancel effort; it reorders it, freeing us from earning so that we can train our loves. The Spirit works through habit and community to form people whose spontaneous responses increasingly resemble Jesus."
          },
          {
            "heading": "Telos: renewed image-bearing",
            "content": "Humans are made to reflect God’s wise, loving rule into the world and to reflect creation’s praise back to its Maker. In the Messiah this vocation is restored. Virtue is therefore not self-improvement but renewed image-bearing: learning to be truly human in and for God’s world."
          },
          {
            "heading": "Faith, hope, and love",
            "content": "Paul names faith, hope, and love as the cardinal virtues that organize Christian maturity. Faith clings to the faithful one, hope lives from the future he has secured, and love is the fulfilling of the law. All other virtues take their shape from this triad and from the cross where they are revealed."
          },
          {
            "heading": "Practices that shape desire",
            "content": "Prayer, Scripture, Eucharist, generosity, hospitality, fasting, and service are not performance metrics; they are training in desire. Over time these practices inscribe the gospel into muscle memory so that communities act with wise spontaneity when pressure comes. The habits carry us when feelings lag."
          },
          {
            "heading": "Moral imagination and story",
            "content": "We become what we contemplate. Immersion in the biblical story, biographies of saints, and congregational testimony expands the horizon of what seems possible. The renewed mind learns to perceive situations not as isolated problems but as scenes within God’s drama of new creation."
          },
          {
            "heading": "Community pedagogy",
            "content": "Character is a team sport. Mentors, accountability, intergenerational friendships, and shared mission form a pedagogy of belonging in which correction is offered for healing and encouragement fuels endurance. Authority, exercised cruciformly, serves the growth of others rather than the status of leaders."
          },
          {
            "heading": "Holiness with joy",
            "content": "Holiness is not dour legalism but radiant love. Joy is the energy of obedience because the future is secure and the King is good. Communities that celebrate well find resilience for sacrifice; their delight signals a kingdom not built on scarcity."
          },
          {
            "heading": "Discipleship for mission",
            "content": "Formation aims outward. The Spirit grows people who can bear responsibility in neighborhoods and nations, translating the gospel into public virtue: honesty, courage, chastity, justice, and peacemaking. As the church matures into the stature of Christ, the world receives a foretaste of its coming renewal."
          }
        ]
      }
    }
  }
}

    </script>
    <!-- 
    ============================================================
    ^^^^^^^^^^^^^^ PASTE YOUR JSON CONTENT ABOVE ^^^^^^^^^^^^^^
    ============================================================
-->

<script defer>
document.addEventListener('DOMContentLoaded', () => {

  const THEMES = {
    'newspaper': {
      name: 'Newspaper',
      type: 'classic',
      isDark: false
    },
    'emerald-paper': {
      name: 'Emerald Paper',
      type: 'variable',
      isDark: false,
      vars: {
        '--bg-gradient': '#f7fbf9',
        '--text': '#1e2b28',
        '--accent-text': '#0f7f6d',
        '--nav-bg': '#e7f3ef',
        '--nav-border': '#86c8ba',
        '--nav-text': '#1e2b28',
        '--nav-hover-bg': '#d7ece6',
        '--nav-active-bg': '#bfe3d9',
        '--nav-active-text': '#1e2b28',
        '--prose-text': '#1e2b28',
        '--prose-headings': '#0f7f6d'
      }
    },
    'cyber-blue': {
      name: 'Navy (Dark)',
      type: 'variable',
      isDark: true,
      vars: {
        '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%, #141433 50%, #0f172a 100%)',
        '--text': '#e5e7eb',
        '--accent-text': '#cbd5e1',
        '--nav-bg': '#0f172a',
        '--nav-border': '#1f2937',
        '--nav-text': '#e5e7eb',
        '--nav-hover-bg': '#111827',
        '--nav-active-bg': '#1f2937',
        '--nav-active-text': '#e5e7eb',
        '--prose-text': '#e5e7eb',
        '--prose-headings': '#cbd5e1'
      }
    },
    'emerald-gold': {
      name: 'Emerald/Gold',
      type: 'variable',
      isDark: true,
      vars: {
        '--bg-gradient': 'linear-gradient(135deg,#022c22 0%,#064e3b 60%,#065f46 100%)',
        '--text': '#ecfdf5',
        '--accent-text': '#f0c475',
        '--nav-bg': '#064e3b',
        '--nav-border': '#d4a24c',
        '--nav-text': '#ecfdf5',
        '--nav-hover-bg': '#065f46',
        '--nav-active-bg': '#0b3d31',
        '--nav-active-text': '#f0c475',
        '--prose-text': '#a7f3d0',
        '--prose-headings': '#f0c475'
      }
    }
  };

  const app = {
    root: document.documentElement,
    header: document.getElementById('app-header'),
    tabs: document.getElementById('app-tabs'),
    panels: document.getElementById('app-panels'),
    settings: {
      modal: document.getElementById('settingsModal'),
      closeBtn: document.getElementById('closeSettings'),
      themeSelect: document.getElementById('themeSelect')
    }
  };

  const state = { activeTab: null, theme: 'newspaper' };

  const loadState = () => {
    state.theme = localStorage.getItem('appTheme') || 'newspaper';
    state.activeTab = localStorage.getItem('activeTab');
  };

  const saveState = () => {
    localStorage.setItem('appTheme', state.theme);
    localStorage.setItem('activeTab', state.activeTab);
  };

  const applyTheme = (themeKey) => {
    const theme = THEMES[themeKey];
    if (!theme) return;

    app.root.className = '';
    app.root.style.cssText = '';

    if (theme.type === 'variable' && theme.vars) {
      for (const [key, value] of Object.entries(theme.vars)) {
        app.root.style.setProperty(key, value);
      }
      app.root.classList.add(`theme-${themeKey}`);
    }

    state.theme = themeKey;
    if (app.settings.themeSelect.value !== themeKey) {
      app.settings.themeSelect.value = themeKey;
    }
    saveState();
  };

  const populateThemeSelector = () => {
    app.settings.themeSelect.innerHTML = Object.entries(THEMES)
      .map(([key, theme]) => `<option value="${key}">${theme.name}</option>`)
      .join('');
  };

  const loadAndTransformData = () => {
    try {
      const dataNode = document.getElementById('app-data');
      if (!dataNode.textContent.trim()) {
        console.error('JSON data is empty.');
        return null;
      }
      const rawData = JSON.parse(dataNode.textContent);

      const topLevelKey = Object.keys(rawData)[0];
      if (!topLevelKey) {
        console.error('JSON data is missing a top-level key.');
        return null;
      }
      const course = rawData[topLevelKey];

      const units = Object.entries(course.categories)
        .map(([id, unitData]) => ({ id, ...unitData }))
        .sort((a, b) => a.display_order - b.display_order);

      return { meta: { title: course.title, description: course.description }, units };
    } catch (e) {
      console.error('Failed to load or transform app data:', e);
      app.panels.innerHTML =
        `<div class="p-4 text-red-500 bg-red-100 rounded"><strong>Error:</strong> Could not load content. Please ensure the JSON is correctly formatted and pasted into the data island.</div>`;
      return null;
    }
  };

  const data = loadAndTransformData();
  if (!data) return;

  const renderHeader = () => {
    document.title = data.meta.title || 'Interactive Course';
    app.header.innerHTML = `
      <div class="flex justify-between items-start gap-4">
        <div>
          <h1 class="text-3xl font-bold text-accent">${data.meta.title}</h1>
          <p class="mt-2 text-primary/80">${data.meta.description}</p>
        </div>
        <button id="settingsBtn" class="flex-shrink-0 p-3 rounded-lg settings-button transition-opacity" aria-label="Display Settings">
          <span class="text-2xl text-accent">⚙️</span>
        </button>
      </div>`;
  };

  const renderTabs = () => {
    app.tabs.innerHTML = `<div class="flex flex-wrap">${
      data.units.map(unit => `
        <button role="tab" aria-selected="false" aria-controls="${unit.id}-panel" id="${unit.id}-tab"
                class="px-5 py-3 font-semibold transition-colors tab-button">
          ${unit.display_name}
        </button>`
      ).join('')
    }</div>`;
  };

  const renderPanels = () => {
    app.panels.innerHTML = data.units.map(unit => {
      const introHTML = unit.introduction ? `<p class="lead">${unit.introduction}</p>` : '';
      const paragraphsHTML = (unit.paragraphs || []).map(p => `
        <h3>${p.heading}</h3>
        <p>${p.content}</p>
      `).join('');
      const proseClasses = THEMES[state.theme].isDark ? 'prose prose-lg max-w-none prose-invert' : 'prose prose-lg max-w-none';
      return `
        <div role="tabpanel" id="${unit.id}-panel" aria-labelledby="${unit.id}-tab" hidden>
          <div class="${proseClasses}">
            <h2>${unit.name}</h2>
            ${introHTML}
            ${paragraphsHTML}
          </div>
        </div>`;
    }).join('');
  };

  const switchTab = (tabId) => {
    if (!data.units.some(u => u.id === tabId)) {
      tabId = data.units[0]?.id;
    }
    if (!tabId) return;

    app.tabs.querySelectorAll('[role="tab"]').forEach(tab => {
      const isActive = tab.id === `${tabId}-tab`;
      tab.setAttribute('aria-selected', isActive);
      tab.classList.toggle('tab-active', isActive);
    });

    app.panels.querySelectorAll('[role="tabpanel"]').forEach(panel => {
      panel.hidden = panel.id !== `${tabId}-panel`;
    });

    state.activeTab = tabId;
    saveState();
  };

  const setupEventListeners = () => {
    app.tabs.addEventListener('click', e => {
      const tab = e.target.closest('[role="tab"]');
      if (tab) switchTab(tab.id.replace('-tab', ''));
    });

    app.header.addEventListener('click', e => {
      if (e.target.closest('#settingsBtn')) {
        app.settings.modal.classList.remove('hidden');
        app.settings.themeSelect.focus();
      }
    });

    const closeModal = () => {
      app.settings.modal.classList.add('hidden');
      document.getElementById('settingsBtn')?.focus();
    };
    app.settings.closeBtn.addEventListener('click', closeModal);
    app.settings.modal.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeModal();
    });

    app.settings.themeSelect.addEventListener('change', (e) => {
      applyTheme(e.target.value);
      renderPanels();
      const activePanel = document.getElementById(`${state.activeTab}-panel`);
      if (activePanel) activePanel.hidden = false;
    });
  };

  const init = () => {
    loadState();
    populateThemeSelector();
    applyTheme(state.theme);
    renderHeader();
    renderTabs();
    renderPanels();
    setupEventListeners();
    switchTab(state.activeTab || data.units[0]?.id);
  };

  init();
});
</script>
</body>
</html>



