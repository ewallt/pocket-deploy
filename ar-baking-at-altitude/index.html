<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Adaptive Reader</title>

  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>

  <script src="https://www.blueletterbible.org/scripts/blbToolTip/BLB_ScriptTagger-min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
    /* Typography */
    .font-newspaper{font-family:'Lora',serif}
    .font-dark-theme{font-family:'Lora',serif}
    body{transition:background-color .3s,color .3s}
    .prose h1{min-height:7.5rem}

    /* Light */
    .newspaper-theme{background:#fdfdfd;color:#1a1a1a}
    .newspaper-theme .nav-button{background:#f8f9fa;border:1px solid #dee2e6;color:#212529}
    .newspaper-theme .nav-button:hover{background:#e9ecef}
    .newspaper-theme .nav-button.active{background:#1a1a1a;color:#fdfdfd}

    /* Dark */
    .dark-theme{background:#2d2d30;color:#fff}
    .dark-theme .nav-button{background:#3c3c3c;border:1px solid #4a4a4a;color:#ccc}
    .dark-theme .nav-button:hover{background:#4a4a4a}
    .dark-theme .nav-button.active{background:#fff;color:#2d2d30}

    /* Shared */
    .nav-container{margin-bottom:2rem}
    .nav-button{padding:.5rem 1rem;margin:.5rem .5rem .5rem 0;border-radius:.375rem;transition:all .2s;cursor:pointer}
    #library-switcher,#topic-switcher{padding:.5rem;border-radius:.375rem;margin-bottom:1rem;width:100%;border:1px solid #ccc}
    .nav-buttons-wrapper{display:flex;flex-wrap:wrap;align-items:center;width:100%}
    .flex-break{flex-basis:100%;height:0}
  </style>
</head>
<body class="font-newspaper newspaper-theme">  
  <script id="embedded-content" type="application/json">
{
    "baking-at-altitude": {
        "display_order": 20,
        "title": "High-Altitude Baking: Conquering the Thin Air",
        "description": "A scientific guide for bakers moving beyond sea-level. Learn why altitude changes the fundamental rules of baking and how to adjust your formulas for perfect results, from cakes to artisan breads.",
        "categories": {
            "altitude-science": {
                "display_order": 10,
                "name": "The Science of Thin Air: Why Altitude Changes Everything",
                "display_name": "The Science",
                "introduction": "Before you can fix a recipe, you must understand the problem. At high altitude, the fundamental issue isn't the ingredients; it's the air itself. All adjustments are made to counteract the effects of lower atmospheric pressure.",
                "paragraphs": [
                    {
                        "heading": "Lower Atmospheric Pressure: The Root Cause",
                        "content": "As altitude increases, the column of air above you shortens, resulting in <strong>lower atmospheric pressure</strong>. This single change has a cascade of effects. Think of it as removing a weighted blanket from your dough; with less pressure holding it down, it behaves very differently."
                    },
                    {
                        "heading": "Consequence 1: Accelerated Leavening",
                        "content": "The gases produced by yeast and chemical leaveners (carbon dioxide) and steam from liquids expand more easily and rapidly in a low-pressure environment. This causes doughs and batters to rise much faster. If the structure isn't strong enough to support this rapid rise, the cell walls will stretch too thin and <strong>collapse</strong>, resulting in a dense, sunken center."
                    },
                    {
                        "heading": "Consequence 2: Faster Evaporation",
                        "content": "Liquids turn to gas more easily at lower pressures. This means moisture evaporates more quickly from the surface of your dough and batter, both during mixing and baking. This can lead to dry, crumbly results and can cause sugar concentrations to increase, which further weakens the structure."
                    },
                    {
                        "heading": "Consequence 3: Lower Boiling Point",
                        "content": "At sea level, water boils at 212°F (100°C). For every 500-foot increase in elevation, the boiling point drops by about 1°F. At 5,000 feet, water boils around 203°F (95°C). Since many baked goods rely on reaching a certain internal temperature for starches to gelatinize and proteins to set, a lower boiling point means the product may <strong>dry out or collapse before its structure is fully baked</strong> and stable."
                    }
                ]
            },
            "leavening-adjustments": {
                "display_order": 20,
                "name": "Taming the Rise: Adjusting Leavening Agents",
                "display_name": "Leavening",
                "introduction": "The most common and critical adjustment at altitude is controlling the leavening. The goal is to slow down the production of gas so that the dough's structure has time to develop and strengthen, allowing it to properly contain that gas during the oven spring.",
                "paragraphs": [
                    {
                        "heading": "Reducing Chemical Leaveners",
                        "content": "For cakes, cookies, and quick breads, this is your first line of defense. The rapid expansion from baking soda and baking powder is the primary culprit in sunken cakes. Start by <strong>reducing the amount of baking powder or soda by 15-25%</strong>. For example, if a recipe calls for 1 teaspoon, start by using 3/4 teaspoon."
                    },
                    {
                        "heading": "Controlling Yeast Activity",
                        "content": "In yeast breads, you need to slow down the fermentation. You can achieve this in several ways: <strong>reduce the amount of yeast</strong> by up to 25%, use slightly cooler water or milk to slow the yeast's initial activity, or simply decrease the bulk fermentation and final proofing times significantly. Pay attention to the dough, not the clock."
                    },
                    {
                        "heading": "The 'Under-Proofing' Strategy",
                        "content": "What looks like a perfectly proofed loaf at sea level is actually over-proofed at altitude. Because the oven spring will be so much more dramatic, you need the dough to have more power in reserve. Your dough should seem slightly under-proofed when it goes into the oven. It should be buoyant but still firm, ensuring it has the strength to rise without collapsing."
                    }
                ]
            },
            "structure-moisture": {
                "display_order": 30,
                "name": "Building Strength and Retaining Moisture",
                "display_name": "Structure & Moisture",
                "introduction": "With leavening under control, the next step is to reinforce the product's structure and compensate for the arid environment. These adjustments work together to create a strong-yet-tender crumb that can withstand the dramatic oven spring.",
                "paragraphs": [
                    {
                        "heading": "Strengthening the Structure with Flour",
                        "content": "To contain the more aggressive gas expansion, you need a stronger gluten and starch network. The simplest way to achieve this is to <strong>add more flour</strong>. For every cup of flour in the original recipe, start by adding an extra 1-2 tablespoons. This gives the cell walls the reinforcement they need to stretch without breaking."
                    },
                    {
                        "heading": "Boosting Hydration",
                        "content": "To counteract the faster evaporation, you must <strong>increase the liquid content</strong> in your recipe. Add 2-4 tablespoons of extra liquid for every cup of flour. Your batter will seem slightly runnier and your doughs stickier than you're used to, but this extra moisture is essential to prevent a dry final product."
                    },
                    {
                        "heading": "The Power of Eggs",
                        "content": "Eggs are a secret weapon at altitude. They contribute protein for structure, fat for tenderness, and water for moisture. Sometimes, the easiest fix for a cake recipe that's giving you trouble is to simply <strong>add an extra egg</strong>. This often provides the perfect balance of strengthening and moistening needed to succeed."
                    }
                ]
            },
            "fine-tuning": {
                "display_order": 40,
                "name": "Fine-Tuning: Sugar, Fat, and Oven Temperature",
                "display_name": "Fine-Tuning",
                "introduction": "With the major variables accounted for, these final tweaks are what create a truly professional result. Adjusting sugar and oven temperature are the final steps to perfecting your high-altitude baking formula.",
                "paragraphs": [
                    {
                        "heading": "Reducing Sugar",
                        "content": "Sugar is hygroscopic, meaning it attracts water. This property, normally great for moistness, can be a problem at altitude because it pulls water away from the proteins and starches needed for structure. Reducing the sugar by 1-2 tablespoons per cup can <strong>strengthen the gluten network</strong> and help prevent collapse. It also helps raise the boiling point of the liquid in the batter."
                    },
                    {
                        "heading": "Increasing Oven Temperature",
                        "content": "This is a non-negotiable step. A hotter oven is needed to 'set' the structure of the baked good as quickly as possible, before the leavening gases have expanded to the point of collapse. <strong>Increase your oven temperature by 15°F to 25°F</strong> (about $8$°C to $14$°C). This rapid blast of heat solidifies the outer crust and inner crumb, locking the structure in place."
                    },
                    {
                        "heading": "General Starting Adjustments (for 5,000 ft / 1,524 m)",
                        "content": "When adapting a sea-level recipe, start here: <ul><li><strong>Leavening:</strong> Decrease by 20-25%.</li><li><strong>Flour:</strong> Increase by 2-3 tbsp per cup.</li><li><strong>Liquid:</strong> Increase by 3-4 tbsp per cup.</li><li><strong>Sugar:</strong> Decrease by 1-2 tbsp per cup.</li><li><strong>Oven Temp:</strong> Increase by 25°F ($14$°C).</li></ul> Always bake a small test batch if possible."
                    }
                ]
            }
        }
    }
}
  </script>

  <div class="fixed top-4 right-4 z-50">
    <button id="theme-switcher-btn" class="p-2 rounded-full" aria-label="toggle theme">
      <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 100-10 5 5 0 000 10z"/></svg>
      <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
    </button>
  </div>

  <main id="app-container" class="prose dark:prose-invert mx-auto max-w-prose p-8"></main>

  <script>
    /* ---------- state ---------- */
    let masterLibrary=null,sortedLibraryIds=null,currentLibraryId=null;
    let libraryData=null,currentTopicId=null;
    const app=document.getElementById('app-container');

    /* ---------- rendering ---------- */
    const buildNav = (categories, activeTopicId) => {
        const sortedKeys = Object.keys(categories).sort((a,b) => (categories[a].display_order || 0) - (categories[b].display_order || 0));
        let html = '<div class="nav-container"><div class="nav-buttons-wrapper">';
        sortedKeys.forEach(key => {
            const topic = categories[key];
            html += `<button class="nav-button ${key === activeTopicId ? 'active' : ''}" data-topic-id="${key}">${topic.display_name || topic.name}</button>`;
        });
        html += '</div></div>';
        return html;
    };

    function render(){
        if (!libraryData) {
            app.innerHTML = '<h1>Error</h1><p>No library data found.</p>';
            return;
        }

        const rootKey = Object.keys(libraryData)[0];
        const rootData = libraryData[rootKey];
        if (!rootData || !rootData.categories) {
            app.innerHTML = '<h1>Error</h1><p>Invalid data structure.</p>';
            return;
        }
        
        const categories = rootData.categories;
        const sortedTopicIds = Object.keys(categories).sort((a,b) => (categories[a].display_order || 0) - (categories[b].display_order || 0));

        if (!currentTopicId || !categories[currentTopicId]) {
            currentTopicId = sortedTopicIds[0];
        }

        const activeTopic = categories[currentTopicId];
        if (!activeTopic) {
            app.innerHTML = '<h1>Error</h1><p>Could not load the selected topic.</p>';
            return;
        }

        document.title = rootData.title || 'Adaptive Reader';
        
        let contentHtml = `<h1>${rootData.title}</h1>`;
        contentHtml += buildNav(categories, currentTopicId);
        contentHtml += `<h2>${activeTopic.name || ''}</h2>`;
        contentHtml += activeTopic.introduction ? `<p class="lead">${activeTopic.introduction}</p>` : '';
        contentHtml += (activeTopic.paragraphs || []).map(p => `<h3>${p.heading}</h3><p>${p.content}</p>`).join('');
        
        app.innerHTML = contentHtml;

        document.querySelectorAll('.nav-button[data-topic-id]').forEach(btn => {
            btn.onclick = (e) => {
                currentTopicId = e.target.dataset.topicId;
                render();
            };
        });
    }

    /* ---------- data load ---------- */
    async function init(){
      let raw = null;
      try {
        const embedded = document.getElementById('embedded-content').textContent.trim();
        if (!embedded || embedded.startsWith('
