System Architecture: The Universal Snapshot Factory

Version: 1.5 (Stable)
Pattern: Generative Micro-Architecture (Client-Side Only)
Stack: Vanilla JS, Tailwind CSS, Gemini API, LocalStorage

1. Core Philosophy

The system replaces domain-specific application code with a single, universal engine. We utilize a Meta-Configuration stored in localStorage to hydrate three generic HTML shells.

Key Constraint: To ensure usability, the visual theme is Strictly Enforced (Navy Blue "Command Center") for structural elements, while the AI-generated "Brand Color" is applied only to accents (borders, icons, text highlights).

2. File Manifest (The "Infrastructure")

The application consists of exactly four files.

A. The Architect (as-factory-admin/index.html)

Role: System Configurator & Data Manager.

Function: Accepts a domain (e.g., "Chemistry"). Uses AI to generate a JSON configuration.

Key Features:

Export/Import: Serializes localStorage to JSON for backup/restore.

7-Section Topology: Enforces a specific prompt structure (Context, Timeline, Sources + 4 Dynamic Sections).

API Handling: Contains the hardcoded API Key and error handling logic.

Output: Saves config to localStorage key as-config-{slug}.

B. The Room (as-factory-room/index.html)

Role: Domain Entry & Context Switcher.

Function: Reads ?factory={slug}. Loads the Config to set titles/accents. Manages the list of "Contexts" (e.g., Factory: Chemistry -> Contexts: "Organic", "Inorganic").

State: Reads/Writes to as-{factory_slug}-list.

C. The Hub (as-factory-hub/index.html)

Role: Dashboard & Index.

Function: Reads ?factory={slug}&context={context_slug}. Lists generated items.

State: Reads keys starting with as-{factory_slug}-{context_slug}-data-.

D. The Viewer (as-factory-viewer/index.html)

Role: Generation Engine.

Function: Reads config to build a dynamic AI Prompt.

Theme Enforcement: Ignores AI-suggested background colors; forces #0b1020 (Navy) background for readability.

Rendering: Dynamically maps AI-generated JSON sections to HTML accordions using specific icons defined in the Config.

3. Data Schema (LocalStorage)

The system relies on a strict naming convention for keys to prevent data collision between factories.

Data Type

Key Pattern

Content

Config

as-config-{factory_slug}

JSON object defining colors, titles, persona, and the 7-section prompt structure.

Context List

as-{factory_slug}-list

Array of objects [{name: "Organic", slug: "organic"}].

Item Data

as-{factory_slug}-{context_slug}-data-{item_id}

The final generated report (JSON) for a specific item (Battle/Chapter/Molecule).

4. The Configuration Object

This is the "Brain" generated by the Architect. It drives the logic of the other three files.

{
  "slug": "chemistry",
  "theme": {
    "brand": "#00ff00" // Only the accent color is used; background is ignored by Viewer.
  },
  "text": {
    "roomTitle": "The Lab",
    "hubTitle": "Compound Index",
    "unitNoun": "Molecule"
  },
  "ai": {
    "role": "PhD Chemist",
    "context": "Analyze chemical properties",
    "guardRails": "Reject non-chemical queries.",
    "sections": [
      { "label": "Context", "icon": "üéØ", "instruction": "..." },
      { "label": "Dynamic 1", "icon": "‚öõÔ∏è", "instruction": "..." },
      { "label": "Timeline", "icon": "üìú", "instruction": "..." }, // Or N/A
      // ... 4 more sections (7 total)
    ]
  }
}


5. Logic Flow: The "Snapshot" Generation

When a user requests an item (e.g., "Carbon") in the Viewer:

Hydration: Viewer loads as-config-chemistry.

Prompt Assembly: It reads config.ai.sections. It constructs a prompt telling the AI: "You are a [role]. Output JSON with these specific keys..."

Error Handling: Viewer checks for API errors or missing keys before attempting to parse.

Rendering: The Viewer loops through the data sections, applying the active class logic for accordion toggling and using the config icons.

6. Future Expansion Roadmap

Edit Mode: Allow manual tweaking of the AI-generated config (e.g., changing a color or refining a prompt instruction) without re-generating the whole app.
