<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Adaptive Reader</title>

  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>

  <script src="https://www.blueletterbible.org/scripts/blbToolTip/BLB_ScriptTagger-min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
    /* Typography */
    .font-newspaper{font-family:'Lora',serif}
    .font-dark-theme{font-family:'Lora',serif}
    body{transition:background-color .3s,color .3s}
    .prose h1{min-height:7.5rem}

    /* Light */
    .newspaper-theme{background:#fdfdfd;color:#1a1a1a}
    .newspaper-theme .nav-button{background:#f8f9fa;border:1px solid #dee2e6;color:#212529}
    .newspaper-theme .nav-button:hover{background:#e9ecef}
    .newspaper-theme .nav-button.active{background:#1a1a1a;color:#fdfdfd}

    /* Dark */
    .dark-theme{background:#2d2d30;color:#fff}
    .dark-theme .nav-button{background:#3c3c3c;border:1px solid #4a4a4a;color:#ccc}
    .dark-theme .nav-button:hover{background:#4a4a4a}
    .dark-theme .nav-button.active{background:#fff;color:#2d2d30}

    /* Shared */
    .nav-container{margin-bottom:2rem}
    .nav-button{padding:.5rem 1rem;margin:.5rem .5rem .5rem 0;border-radius:.375rem;transition:all .2s;cursor:pointer}
    #library-switcher,#topic-switcher{padding:.5rem;border-radius:.375rem;margin-bottom:1rem;width:100%;border:1px solid #ccc}
    .nav-buttons-wrapper{display:flex;flex-wrap:wrap;align-items:center;width:100%}
    .flex-break{flex-basis:100%;height:0}
  </style>
</head>
<body class="font-newspaper newspaper-theme">  
  <script id="embedded-content" type="application/json">
{
    "anglers-almanac": {
        "display_order": 10,
        "title": "The Angler's Almanac: The Science & Strategy of the Fly",
        "description": "An in-depth guide for intermediate to advanced anglers, exploring the hydrology, entomology, and strategic thinking that elevates success on the water.",
        "categories": {
            "reading-the-water": {
                "display_order": 10,
                "name": "Reading the Water: Finding Fish in the Flow",
                "display_name": "Reading Water",
                "introduction": "A river is a complex map of currents, structures, and feeding lanes. Learning to read this map is the single most important skill for a successful angler, revealing where trout are likely to be holding, feeding, and resting based on their three primary needs: safety, food, and energy conservation.",
                "paragraphs": [
                    {
                        "heading": "Riffles and Runs: The Buffet Line",
                        "content": "A <strong>riffle</strong> is the shallow, fast-moving, broken water that churns up insects and oxygenates the river. While too turbulent for fish to hold in, the adjacent downstream section, known as a <strong>run</strong>, offers slightly slower, deeper water. Fish will sit in the run, often at the head of the pool, and watch the 'buffet line' of food drift out of the riffle."
                    },
                    {
                        "heading": "Seams and Eddies: The Conveyor Belt",
                        "content": "A <strong>seam</strong> is the visible border between a fast current and a slow current. This is a prime holding area for trout. They can rest in the slow water of the <strong>eddy</strong>, conserving energy, while watching the fast 'conveyor belt' current deliver a steady stream of food. A well-placed cast along a seam is one of the highest-percentage plays in fly fishing."
                    },
                    {
                        "heading": "Pools and Tailouts: Resting and Ambush Zones",
                        "content": "A deep <strong>pool</strong> offers fish safety from overhead predators like birds and anglers. While fish rest in the belly of the pool, the most strategic place to fish it is often the <strong>tailout</strong>â€”the shallow area at the end of the pool where the water thins and speeds up. Here, insects drift out of the pool at a concentrated point, and resident fish will move into position to feed."
                    },
                    {
                        "heading": "Structure: Wood, Boulders, and Banks",
                        "content": "Physical <strong>structure</strong> provides the two things fish constantly seek: a break from the current and cover from predators. Submerged boulders, fallen logs ('wood'), and deep, eroded undercut banks are all prime examples. They create pockets of slow water where fish can rest and ambush prey from a position of safety."
                    }
                ]
            },
            "aquatic-entomology": {
                "display_order": 20,
                "name": "The Angler's Entomology: Matching the Hatch",
                "display_name": "Entomology",
                "introduction": "Understanding the life cycles of aquatic insects is the key to the 'match the hatch' puzzle. This isn't just about identifying bugs; it's about knowing which stage of their life is most available to trout and presenting an imitation that mimics that specific stage and behavior.",
                "paragraphs": [
                    {
                        "heading": "The Big Three: Mayflies, Caddisflies, and Stoneflies",
                        "content": "While countless insects inhabit a river, three orders form the bedrock of a trout's diet. These are the <strong>Mayflies</strong> (<em>Ephemeroptera</em>), known for their distinct upright wings; <strong>Caddisflies</strong> (<em>Trichoptera</em>), which often have tent-like wings as adults; and <strong>Stoneflies</strong> (<em>Plecoptera</em>), which are typically larger and crawl out of the water to hatch. Recognizing these three is the first step to advanced fly selection."
                    },
                    {
                        "heading": "The Mayfly Lifecycle: Nymph, Emerger, Dun, Spinner",
                        "content": "The mayfly presents four distinct feeding opportunities. The <strong>nymph</strong> lives on the riverbed for up to a year. To hatch, it swims to the surface as an <strong>emerger</strong>, a highly vulnerable stage. It then hatches into a floating <strong>dun</strong>, the classic dry fly stage. Finally, it returns to the river as a sexually mature <strong>spinner</strong> to mate and die, creating a final feast."
                    },
                    {
                        "heading": "The Caddisfly Lifecycle: Larva, Pupa, Adult",
                        "content": "Caddisflies have a different lifecycle. The larva often builds a protective case of small stones. To hatch, it transitions into a <strong>pupa</strong>, which actively swims to the surface. This ascent is a major trigger for feeding trout. The adult caddis then breaks free and often skitters across the surface, a behavior that must be imitated with the fly for success."
                    },
                    {
                        "heading": "Midges and Terrestrials: The Year-Round Staples",
                        "content": "<strong>Chironomids</strong>, or midges, are tiny but are present in virtually all trout waters 365 days a year, making them a crucial food source, especially in winter. <strong>Terrestrials</strong> are land-based insects like ants, beetles, and grasshoppers that are blown into the water. During the summer and on windy days, they can become the most important food item on the menu."
                    }
                ]
            },
            "casting-strategy": {
                "display_order": 30,
                "name": "The Art of Presentation: Beyond the Basic Cast",
                "display_name": "Presentation",
                "introduction": "A perfect fly presented unnaturally will be refused every time. Mastering presentation is about manipulating the fly line and leader to achieve a natural, 'drag-free drift,' ensuring your fly behaves exactly like the insects the fish are eating.",
                "paragraphs": [
                    {
                        "heading": "The Drag-Free Drift: The Golden Rule",
                        "content": "A <strong>drag-free drift</strong> is the foundation of nearly all river fishing. Drag occurs when the fly line, caught in a current faster or slower than the water around the fly, pulls the fly at an unnatural speed. Fish are acutely aware of the current's speed and will ignore a fly that is visibly 'dragging' or creating a wake on the surface."
                    },
                    {
                        "heading": "Mending: Active Drift Management",
                        "content": "<strong>Mending</strong> is the primary technique to combat drag. After the cast lands, you use the rod tip to flip a curve of line either upstream or downstream. This places a 'belly' of slack in the line that the current must straighten out before it can start pulling on your fly, thus extending the duration of your natural drift through the target zone."
                    },
                    {
                        "heading": "Reach Casts and Parachute Mends: Proactive Line Control",
                        "content": "Advanced anglers use casts that proactively place slack in the line. A <strong>Reach Cast</strong> is performed by 'reaching' the rod upstream or downstream just before the line lands on the water, creating an instant mend. A <strong>Parachute Mend</strong> involves stopping the rod high to drop the line with built-in 'S' curves of slack. These are proactive solutions to complex currents."
                    },
                    {
                        "heading": "Controlling Depth: The Nymphing Challenge",
                        "content": "For nymphing, presentation is about depth. To get the fly to the bottom where fish are feeding, you must use weighted flies or add split shot to the leader. Techniques like <strong>high-sticking</strong> or 'Euro-nymphing' use a long leader and keep the fly line off the water entirely, allowing for maximum depth control and strike detection in tight quarters."
                    }
                ]
            },
            "gear-physics": {
                "display_order": 40,
                "name": "The Balanced System: Rod, Reel, and Line Physics",
                "display_name": "The System",
                "introduction": "A fly fishing setup is more than just a collection of parts; it's a balanced system designed to store and release energy. Understanding how these components work together is crucial for efficient casting, effective presentation, and successfully fighting fish.",
                "paragraphs": [
                    {
                        "heading": "Rod Action and Power: Loading the Spring",
                        "content": "A rod's <strong>action</strong> describes where it bends: a 'fast' action rod bends mostly at the tip, while a 'slow' action rod bends deep into the butt section. The rod's <strong>weight</strong> (e.g., a 5-weight) is a rating for the mass of the line it's designed to cast. The cast itself works by using the moving line's mass to flex or 'load' the rod, which then unsprings to propel the line forward."
                    },
                    {
                        "heading": "Fly Line Tapers: The Engine of the Cast",
                        "content": "In fly casting, you cast the line, not the lure. The line's mass is concentrated in a specific <strong>taper</strong> to facilitate this. A Weight Forward (WF) line has a heavy front section that helps shoot the line for distance. A Double Taper (DT) line is more traditional and excels at delicate, short-range presentations. The taper is the engine that loads the rod."
                    },
                    {
                        "heading": "The Tapered Leader: Dissipating the Energy",
                        "content": "The <strong>leader</strong> is the critical, tapered monofilament link between the thick fly line and the fly. Its thick butt section efficiently receives energy from the fly line, while the taper smoothly dissipates this energy down to the fine tippet. This unrolling effect is what allows a heavy line to delicately present a nearly weightless fly."
                    },
                    {
                        "heading": "Reel and Drag: Applying Controlled Pressure",
                        "content": "While the reel's most basic job is to store line, its most important technical function is the <strong>drag system</strong>. This system, usually a series of discs, applies calibrated resistance as a fish pulls line. A smooth drag protects your light tippet from snapping under the sudden lunges of a powerful fish, acting as a crucial shock absorber during the fight."
                    }
                ]
            },
            "essential-knots": {
                "display_order": 50,
                "name": "The Angler's Connection: Essential Knots",
                "display_name": "Essential Knots",
                "introduction": "Your connection to the fish is only as strong as your weakest knot. There is no 'one knot for everything.' Mastering a few key, reliable knots for specific situations ensures that when you hook the fish of a lifetime, it stays hooked.",
                "paragraphs": [
                    {
                        "heading": "Tippet-to-Fly: The Improved Clinch Knot",
                        "content": "The <strong>Improved Clinch Knot</strong> is the universal standard for attaching your fly to your tippet. It's strong, reliable, and relatively easy to tie. The 'improved' step, which involves passing the tag end back through the loop you create, significantly increases its strength and prevents it from slipping. Always moisten the knot before pulling it tight."
                    },
                    {
                        "heading": "Leader-to-Tippet: The Double Surgeon's Knot",
                        "content": "When you need to add more tippet to your leader, the <strong>Double Surgeon's Knot</strong> is often the fastest and most reliable choice. It's simply an overhand knot where you pass both the leader and tippet material through the loop twice. It's exceptionally strong for joining two lines of similar diameter and can be tied quickly even with cold, wet hands."
                    },
                    {
                        "heading": "Fly Line-to-Leader: The Perfection Loop",
                        "content": "Modern fly lines come with a welded loop at the end for easy leader changes. To create a corresponding loop on the butt section of your leader, the <strong>Perfection Loop</strong> is the gold standard. It creates a perfectly in-line loop that won't compromise the strength of the material, making for a smooth and strong loop-to-loop connection."
                    },
                    {
                        "heading": "The Action Knot: Non-Slip Loop Knot",
                        "content": "When fishing streamers or large nymphs, you want the fly to have as much natural movement as possible. A <strong>Non-Slip Loop Knot</strong> (also known as the Kreh Loop) creates a fixed, open loop connecting to the fly's eye. This allows the fly to pivot and dart freely in the current, giving it a much more lifelike action than a knot cinched tight to the hook."
                    }
                ]
            }
        }
    }
}
  </script>

  <div class="fixed top-4 right-4 z-50">
    <button id="theme-switcher-btn" class="p-2 rounded-full" aria-label="toggle theme">
      <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 100-10 5 5 0 000 10z"/></svg>
      <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
    </button>
  </div>

  <main id="app-container" class="prose dark:prose-invert mx-auto max-w-prose p-8"></main>

  <script>
    /* ---------- state ---------- */
    let libraryData=null,currentTopicId=null;
    const app=document.getElementById('app-container');

    /* ---------- rendering ---------- */
    const buildNav = (categories, activeTopicId) => {
        const sortedKeys = Object.keys(categories).sort((a,b) => (categories[a].display_order || 0) - (categories[b].display_order || 0));
        let html = '<div class="nav-container"><div class="nav-buttons-wrapper">';
        sortedKeys.forEach(key => {
            const topic = categories[key];
            html += `<button class="nav-button ${key === activeTopicId ? 'active' : ''}" data-topic-id="${key}">${topic.display_name || topic.name}</button>`;
        });
        html += '</div></div>';
        return html;
    };

    function render(){
        if (!libraryData) {
            app.innerHTML = '<h1>Error</h1><p>No library data found.</p>';
            return;
        }

        const rootKey = Object.keys(libraryData)[0];
        const rootData = libraryData[rootKey];
        if (!rootData || !rootData.categories) {
            app.innerHTML = '<h1>Error</h1><p>Invalid data structure.</p>';
            return;
        }
        
        const categories = rootData.categories;
        const sortedTopicIds = Object.keys(categories).sort((a,b) => (categories[a].display_order || 0) - (categories[b].display_order || 0));

        if (!currentTopicId || !categories[currentTopicId]) {
            currentTopicId = sortedTopicIds[0];
        }

        const activeTopic = categories[currentTopicId];
        if (!activeTopic) {
            app.innerHTML = '<h1>Error</h1><p>Could not load the selected topic.</p>';
            return;
        }

        document.title = rootData.title || 'Adaptive Reader';
        
        let contentHtml = `<h1>${rootData.title}</h1>`;
        contentHtml += buildNav(categories, currentTopicId);
        contentHtml += `<h2>${activeTopic.name || ''}</h2>`;
        contentHtml += activeTopic.introduction ? `<p class="lead">${activeTopic.introduction}</p>` : '';
        contentHtml += (activeTopic.paragraphs || []).map(p => `<h3>${p.heading}</h3><p>${p.content}</p>`).join('');
        
        app.innerHTML = contentHtml;

        document.querySelectorAll('.nav-button[data-topic-id]').forEach(btn => {
            btn.onclick = (e) => {
                currentTopicId = e.target.dataset.topicId;
                render();
            };
        });
    }

    /* ---------- data load ---------- */
    async function init(){
      let raw = null;
      try {
        const embedded = document.getElementById('embedded-content').textContent.trim();
        if (!embedded) throw new Error('No embedded data found.');
        raw = JSON.parse(embedded);
        console.log("Data loaded successfully:", raw); // DEBUG: Confirm data is loaded
      } catch(err) {
        console.error("Failed to load or parse data:", err);
        app.innerHTML = '<h1>Error</h1><p>Could not load content. Check browser console for details.</p>';
        return;
      }

      libraryData = raw;
      render(); // Initial render
    }

    /* ---------- theme ---------- */
    const themeBtn=document.getElementById('theme-switcher-btn');
    function applyTheme(t){
      const dark = t === 'dark';
      document.documentElement.classList.toggle('dark',dark);
      document.body.classList.toggle('dark-theme',dark);
      document.body.classList.toggle('font-dark-theme',dark);
      document.body.classList.toggle('newspaper-theme',!dark);
      document.body.classList.toggle('font-newspaper',!dark);
      document.getElementById('sun-icon').classList.toggle('hidden',dark);
      document.getElementById('moon-icon').classList.toggle('hidden',!dark);
    }
    themeBtn.onclick=()=>{const t=document.documentElement.classList.contains('dark')?'light':'dark';localStorage.setItem('theme',t);applyTheme(t)};

    /* ---------- boot ---------- */
    document.addEventListener('DOMContentLoaded',()=>{
      applyTheme(localStorage.getItem('theme') || 'light');
      init().catch(err=>{console.error(err);app.innerHTML='<h1>Error</h1><p>Could not load content due to an initialization error.</p>'});
    });
  </script>
</body>
</html>
