<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Threaded Reader</title>

  <!-- Prepaint bootstrap: set dark + theme class before paint to avoid flicker -->
  <script>
  (function () {
    const root = document.documentElement;
    try {
      const savedTheme = localStorage.getItem('theme');       // 'light' | 'dark' | null
      const savedColor = localStorage.getItem('colorScheme'); // 'slate' | 'emerald' | future
      const isDark = savedTheme !== 'light';                  // default to dark if unset
      root.classList.toggle('dark', isDark);
      // Apply colored theme classes ONLY in dark mode; light is always neutral slate
      root.classList.toggle('theme-emerald', isDark && savedColor === 'emerald');
    } catch (_) {}
  })();
  </script>

  <!-- Tailwind (with Typography) -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- Google Font (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
  :root { color-scheme: light dark; }
  html { scroll-behavior: smooth; }
  .font-newspaper { font-family: 'Lora', serif; }
  :where(h2,h3,h4){ scroll-margin-top: 84px; }
  mark { background: #fde68a; padding: .1em .2em; border-radius: .2rem; }
  @media (max-width: 380px){ .prose { font-size: .96rem; } }

  /* ---------- Semantic surfaces (read from CSS variables) ---------- */
.hero {
  /* give the header an explicit base fill so gradient blends to the right hue */
  background-color: var(--hero-base);
  background:
    radial-gradient(50% 120% at 10% 10%, var(--hero-r1), transparent 60%),
    radial-gradient(80% 140% at 90% 10%, var(--hero-r2), transparent 70%),
    linear-gradient(180deg, var(--hero-wash), transparent 35%);
}
.border-var { border-color: var(--border) !important; }
.surface { border-width: 1px; border-style: solid; border-color: var(--border); }
.hr-var { border-color: var(--border); }
.subtitle { color: var(--subtitle-fg); }
.timeline-fg { color: var(--timeline-fg); }
.footer-note { color: var(--footer-fg); }
.active-link { color: var(--active); font-weight: 700; }

.input-surface {
  border: 1px solid var(--input-border);
  background-color: var(--input-bg);
}
.btn-surface { border: 1px solid var(--btn-border); }
.btn-surface:hover { background: var(--btn-hover-bg); }
.toc-link:hover { background: var(--hover-bg); }

/* ---------- Slate (default) variables ---------- */
:root{
  /* accents / inks */
  --active: rgb(59,130,246);                      /* sky-500 */
  --subtitle-fg: rgb(71,85,105);                  /* slate-600 */
  --timeline-fg: rgb(100,116,139);                /* slate-500 */
  --footer-fg: rgb(100,116,139);                  /* slate-500 */

  /* surfaces */
  --border: rgb(226,232,240);                     /* slate-200 */
  --hover-bg: rgb(248,250,252);                   /* slate-50 */
  --btn-border: rgb(203,213,225);                 /* slate-300 */
  --btn-hover-bg: rgb(248,250,252);               /* slate-50 */
  --input-border: rgba(203,213,225,0.7);          /* slate-300/70 */
  --input-bg: rgba(255,255,255,0.7);              /* white/70 */

  /* hero base & gradient (light) */
  --hero-base: transparent;                       /* keep light header airy */
  --hero-r1: rgba(49,46,129,.12);                 /* indigo-700 */
  --hero-r2: rgba(234,88,12,.12);                 /* orange-600 hint */
  --hero-wash: rgba(14,165,233,.08);              /* sky-500 wash */
}
.dark{
  --subtitle-fg: rgb(203,213,225);                /* slate-300 */
  --timeline-fg: rgb(148,163,184);                /* slate-400 */
  --footer-fg: rgb(148,163,184);                  /* slate-400 */

  --border: rgb(30,41,59);                        /* slate-800 */
  --hover-bg: rgb(15,23,42);                      /* slate-900 */
  --btn-border: rgb(51,65,85);                    /* slate-700 */
  --btn-hover-bg: rgb(15,23,42);                  /* slate-900 */
  --input-border: rgba(51,65,85,0.7);             /* slate-700/70 */
  --input-bg: rgba(2,6,23,0.6);                   /* slate-950/60 */

  /* hero base & gradient (dark) */
  --hero-base: rgb(2,6,23);                       /* slate-950 */
  --hero-r1: rgba(49,46,129,.12);
  --hero-r2: rgba(234,88,12,.12);
  --hero-wash: rgba(14,165,233,.08);
}

/* ---------- Emerald theme overrides (light & dark) ---------- */
.theme-emerald{
  --active: #10b981;                              /* emerald-500 */

  --border: rgb(187,247,208);                     /* emerald-200 */
  --hover-bg: rgb(240,253,244);                   /* emerald-50 */
  --btn-border: rgb(187,247,208);                 /* emerald-200 */
  --btn-hover-bg: rgb(240,253,244);               /* emerald-50 */
  --input-border: rgba(110,231,183,0.7);          /* emerald-300/70 */
  --input-bg: rgba(255,255,255,0.7);              /* white/70 */

  /* keep subtitles/timeline neutral for readability over hero */
  --subtitle-fg: rgb(71,85,105);                  /* slate-600 */
  --timeline-fg: rgb(71,85,105);                  /* slate-600 */
  --footer-fg: rgb(16,185,129);                   /* emerald-500 */

  /* hero base & gradient (emerald light) */
  --hero-base: transparent;
  --hero-r1: rgba(16,185,129,.14);                /* emerald-500 */
  --hero-r2: rgba(163,230,53,.12);                /* lime-400 */
  --hero-wash: rgba(5,150,105,.10);               /* emerald-600 wash */
}
.dark.theme-emerald{
  /* ↑ Give borders enough contrast on dark emerald surfaces */
  --border: rgba(110,231,183,0.55);                /* emerald-300 @ 55% */
  --hover-bg: rgb(6,78,59);                        /* emerald-900 */
  --btn-border: rgba(110,231,183,0.45);            /* slightly softer than borders */
  --btn-hover-bg: rgb(6,78,59);                    /* emerald-900 */
  --input-border: rgba(110,231,183,0.55);          /* match border contrast */
  --input-bg: rgba(6,95,70,0.60);                  /* emerald-900/60 */

  /* text accents for readability */
  --footer-fg: rgb(110,231,183);                   /* emerald-300/400 */
  --subtitle-fg: rgb(226,252,236);                 /* emerald-100 */
  --timeline-fg: rgb(187,247,208);                 /* emerald-200 */

  /* hero base & gradient (unchanged, stays emerald) */
  --hero-base: rgb(2,44,34);                       /* emerald-950 (#022c22) */
  --hero-r1: rgba(16,185,129,.14);
  --hero-r2: rgba(163,230,53,.12);
  --hero-wash: rgba(5,150,105,.10);
}

</style>

</head>

<body class="bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]">



  <!-- Header -->
  <header id="top" class="hero border-b border-var">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between gap-4">
      <div>
        <h1 id="docTitle" class="text-2xl sm:text-3xl font-bold font-newspaper tracking-tight">Loading...</h1>
        <p id="docSubtitle" class="subtitle text-sm sm:text-base"></p>
      </div>
      <div class="flex items-center gap-2">
        <label for="search" class="sr-only">Search</label>
        <input id="search" type="search" placeholder="Search…" class="hidden md:block w-56 rounded-xl input-surface px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400" />
        <button id="clearSearch" type="button" class="hidden md:inline-flex text-xs px-2 py-2 rounded-lg btn-surface">Clear</button>
        <button id="colorSchemeToggle" type="button" class="inline-flex items-center justify-center rounded-xl btn-surface px-3 py-2 text-sm" title="Change color scheme">
          <span class="inline md:hidden">Colors</span>
          <svg aria-hidden="true" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/>
            <circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/>
            <circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/>
            <circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/>
            <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 7.012 17.461 2 12 2z"/>
          </svg>
        </button>
        <button id="themeToggle" type="button" class="inline-flex items-center justify-center rounded-xl btn-surface px-3 py-2 text-sm" title="Toggle dark mode" aria-pressed="false">
          <span class="inline md:hidden">Theme</span>
          <svg aria-hidden="true" class="w-5 h-5 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg aria-hidden="true" class="w-5 h-5 dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </button>
      </div>
    </div>

    <!-- Timeline -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6" id="timelineWrap" hidden>
      <nav aria-label="Journey timeline" id="timelineNav" class="timeline-fg">
        <ol id="timeline" class="grid grid-cols-3 sm:grid-cols-6 items-center gap-x-2 gap-y-1 text-[11px] sm:text-sm"></ol>
        <div id="timelineCoda" class="mt-2 text-[11px] sm:text-xs"></div>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-[260px_minmax(0,1fr)] gap-8">
    <!-- Sidebar -->
    <aside class="lg:sticky lg:top-4 h-max">
      <nav aria-label="On this page" class="rounded-2xl surface p-4">
        <h2 class="text-sm font-semibold mb-2">Sections</h2>
        <ol id="toc" class="space-y-1 text-sm"></ol>
        <hr class="my-4 hr-var" />
        <button id="expandAll" type="button" class="w-full text-xs px-3 py-2 rounded-lg btn-surface">Expand All</button>
        <button id="collapseAll" type="button" class="mt-2 w-full text-xs px-3 py-2 rounded-lg btn-surface">Collapse All</button>
      </nav>
    </aside>

    <section id="content" class="prose prose-slate dark:prose-invert max-w-none">
      <!-- DROP ARTICLE HERE -->

<article class="rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
  <meta name="doc-title" content="Using Free AI Tools to Boost Your Job Search in Salt Lake City">
  <meta name="doc-subtitle" content="Practical AI strategies and ready-to-use prompts for optimizing your finance job search">
  <meta name="timeline-steps" content="getting-started-with-ai-tools,resume-optimization,interview-and-career-preparation,networking-and-linkedin-strategy,advanced-job-search-tactics">
  <meta name="timeline-labels" content="Getting Started,Resume,Interview Prep,Networking,Advanced">

  <h2>Getting Started with AI Tools</h2>
  <p>Getting started with AI for your job search is simple and free. Two of the best options are Google Gemini and OpenAI's ChatGPT. Gemini gives generous free access to its latest model at gemini.google.com, and ChatGPT lets you use its newest GPT-5 model for free at chat.openai.com.</p>
  
  <p>To begin, create a free account with your email, then log in and open a new chat. You can type instructions or questions into the box at the bottom, and the AI will respond instantly. Both tools can help you tailor your resume, prepare for interviews, research companies, and polish your LinkedIn profile.</p>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Setting up your AI workflow</summary>
    <div class="pt-2">
      <ul>
        <li><strong>Account setup:</strong> Create accounts on both platforms to compare responses and capabilities</li>
        <li><strong>Browser bookmarks:</strong> Save direct links for quick access during your job search</li>
        <li><strong>Document preparation:</strong> Have your current resume, job descriptions, and career goals ready to copy/paste</li>
        <li><strong>Session management:</strong> Start new chats for different job search tasks to maintain focus</li>
        <li><strong>Output organization:</strong> Copy useful responses to a document for reference and refinement</li>
      </ul>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Effective prompting principles</summary>
    <div class="pt-2">
      <p>The key is to make your prompts conversational—tell the AI what role it should play, what you're trying to accomplish, and ask it to work with you step-by-step. This way, it will guide you, ask clarifying questions, and adapt its advice to your situation.</p>
      <ul>
        <li><strong>Role assignment:</strong> Start with "You are a [specific expert role]" to set context</li>
        <li><strong>Clear objectives:</strong> Specify exactly what you want to accomplish</li>
        <li><strong>Interactive approach:</strong> Ask for step-by-step guidance rather than one large output</li>
        <li><strong>Specificity:</strong> Include details about your situation, location (SLC), and industry (finance)</li>
        <li><strong>Iterative refinement:</strong> Use follow-up prompts to improve and customize responses</li>
      </ul>
    </div>
  </details>
</article>

<article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
  <h2>Resume Optimization</h2>
  <p>Transform your resume into a powerful tool that speaks directly to Salt Lake City employers using AI-guided optimization and industry-specific insights.</p>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Resume optimization prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are an expert resume writer and career coach for finance professionals. Work with me to optimize my resume for the Salt Lake City job market. Ask me one question at a time about my experience, achievements, and career goals, then guide me in making the best possible updates. Keep the tone encouraging but focused."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Cover letter development prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are a professional cover letter writer who specializes in senior finance roles. Help me create a compelling cover letter for a specific job in Salt Lake City. First, ask for the job description, then ask questions about my relevant achievements, values, and skills. Use my answers to draft and refine the letter with me."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Additional resume enhancement prompts</summary>
    <div class="pt-2">
      <ul>
        <li><strong>ATS optimization:</strong> "Review my resume for ATS compatibility and suggest improvements for keyword density and formatting."</li>
        <li><strong>Quantification help:</strong> "Help me transform these achievement descriptions into quantified, impact-focused bullet points: [paste descriptions]"</li>
        <li><strong>Industry targeting:</strong> "Adapt this resume section for a [healthcare/tech/manufacturing] finance role in Salt Lake City."</li>
        <li><strong>Skills translation:</strong> "Help me translate my [current industry] finance experience for opportunities in Utah's [target industry] sector."</li>
      </ul>
    </div>
  </details>
</article>

<article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
  <h2>Interview and Career Preparation</h2>
  <p>Use AI to conduct realistic practice sessions, develop compelling stories, and build confidence for your Salt Lake City finance interviews.</p>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Interview practice prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are an experienced hiring manager for finance leadership positions. Conduct a mock interview with me for a [Job Title] role in Salt Lake City. Ask one interview question at a time, wait for my answer, then give detailed feedback on how I could improve my response. Adjust your questions based on my answers."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Salary negotiation coaching prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are a salary negotiation coach for finance roles. Prepare me to negotiate effectively in Salt Lake City's job market. Ask me about the role, company, and my priorities, then role-play a negotiation with me, providing feedback on my responses and suggesting better ways to phrase my requests."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Additional interview preparation prompts</summary>
    <div class="pt-2">
      <ul>
        <li><strong>STAR method coaching:</strong> "Help me develop STAR method responses for common finance leadership behavioral questions."</li>
        <li><strong>Technical preparation:</strong> "Quiz me on financial concepts and accounting principles relevant to senior finance roles."</li>
        <li><strong>Company research:</strong> "Help me research [Company Name] and prepare thoughtful questions that demonstrate my interest and strategic thinking."</li>
        <li><strong>Weakness reframing:</strong> "Help me reframe potential weaknesses into growth opportunities and learning experiences."</li>
        <li><strong>Culture fit preparation:</strong> "Coach me on demonstrating cultural alignment with Utah's collaborative business environment."</li>
      </ul>
    </div>
  </details>
</article>

<article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
  <h2>Networking and LinkedIn Strategy</h2>
  <p>Leverage AI to build meaningful professional connections and create a compelling online presence that attracts Salt Lake City finance opportunities.</p>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">LinkedIn profile optimization prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are a LinkedIn branding expert for finance professionals. Help me optimize my LinkedIn profile so it attracts employers in Salt Lake City. Ask for my current About section, work history, and job goals, then guide me step-by-step in improving each section, making suggestions as we go."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Networking strategy prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are a career networking strategist. Help me create a plan to connect with finance professionals and decision-makers in Salt Lake City. Ask me about my current network, target companies, and event preferences, then recommend specific actions, draft outreach messages, and coach me on how to follow up effectively."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Social media and outreach prompts</summary>
    <div class="pt-2">
      <ul>
        <li><strong>Connection requests:</strong> "Draft personalized LinkedIn connection requests for [role/company] professionals in Salt Lake City."</li>
        <li><strong>Follow-up messages:</strong> "Help me write thoughtful follow-up messages after networking events or informational interviews."</li>
        <li><strong>Content creation:</strong> "Suggest professional LinkedIn posts that showcase my finance expertise and attract SLC employers."</li>
        <li><strong>Industry engagement:</strong> "Identify Utah finance groups, associations, and events where I should build connections."</li>
        <li><strong>Alumni networking:</strong> "Help me craft outreach messages to university alumni working in Salt Lake City finance."</li>
      </ul>
    </div>
  </details>
</article>

<article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
  <h2>Advanced Job Search Tactics</h2>
  <p>Deploy sophisticated AI-powered strategies to identify hidden opportunities, optimize your application approach, and accelerate your job search timeline.</p>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Job search targeting prompt</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-blue-500 pl-4 italic">
        "You are a job search strategist. Work with me to identify the best companies and roles for my background in Salt Lake City. Ask questions about my skills, preferred industries, and work style, then suggest companies, job titles, and application strategies tailored to my goals."
      </blockquote>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Advanced strategy prompts</summary>
    <div class="pt-2">
      <ul>
        <li><strong>Market analysis:</strong> "Analyze Salt Lake City's finance job market trends and identify emerging opportunities in my field."</li>
        <li><strong>Application optimization:</strong> "Help me create a tracking system and timeline for managing multiple job applications effectively."</li>
        <li><strong>Industry transition:</strong> "Guide me in positioning my [current industry] experience for opportunities in Utah's [target industry] sector."</li>
        <li><strong>Competitive positioning:</strong> "Help me identify my unique value proposition compared to other finance candidates in Salt Lake City."</li>
        <li><strong>Reference strategy:</strong> "Coach me on selecting and preparing references who can speak to my finance leadership capabilities."</li>
        <li><strong>Offer evaluation:</strong> "Help me create a framework for evaluating job offers that considers salary, benefits, growth potential, and cultural fit."</li>
      </ul>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">Bonus: Master prompt engineering</summary>
    <div class="pt-2">
      <blockquote class="border-l-4 border-green-500 pl-4 italic">
        "You are an expert instructor in prompt engineering. Design a course which teaches me how to write powerful prompts like the ones you gave me."
      </blockquote>
      <p class="mt-2 text-sm opacity-80">Use this prompt to develop advanced AI skills that will serve you throughout your career, not just in job searching.</p>
    </div>
  </details>
  
  <details class="mt-4">
    <summary class="font-semibold cursor-pointer">AI tool comparison and best practices</summary>
    <div class="pt-2">
      <ul>
        <li><strong>ChatGPT strengths:</strong> Detailed career advice, comprehensive resume feedback, complex reasoning tasks</li>
        <li><strong>Gemini strengths:</strong> Real-time web research, company information, current market data</li>
        <li><strong>Session management:</strong> Use separate chats for different job applications to avoid context confusion</li>
        <li><strong>Iterative improvement:</strong> Start with basic prompts, then refine based on the quality of AI responses</li>
        <li><strong>Human oversight:</strong> Always review and personalize AI-generated content before using it professionally</li>
        <li><strong>Privacy considerations:</strong> Avoid sharing sensitive personal information or proprietary company data</li>
      </ul>
    </div>
  </details>
</article>

      <!-- DO NOT PASTE ANYTHING AFTER THIS POINT -->
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 text-xs footer-note">
    Threaded Reader — a single-file template
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ===== Utilities =====
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
      const slug = s => s.toLowerCase().replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-');

      // ===== Read Metadata from Content =====
      const firstArticle = document.querySelector('#content article');
      const docTitle = firstArticle?.querySelector('meta[name="doc-title"]')?.content || 'Untitled Document';
      const docSubtitle = firstArticle?.querySelector('meta[name="doc-subtitle"]')?.content || '';
      const timelineStepsData = firstArticle?.querySelector('meta[name="timeline-steps"]')?.content;
      const timelineLabelsData = firstArticle?.querySelector('meta[name="timeline-labels"]')?.content;

      // ===== Populate Header from Metadata =====
      document.getElementById('docTitle').textContent = docTitle;
      document.getElementById('docSubtitle').textContent = docSubtitle;
      document.title = docTitle; // Also update browser tab title

      // ===== Theme packs: only control article "prose-*" family
      // ===== Theme packs: control article prose family AND base <body> ink/background
const THEME_PACKS = {
  slate: {
    proseClass: 'prose-slate',
    bodyClass: 'bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]'
  },
  emerald: {
    proseClass: 'prose-emerald',
    bodyClass: 'bg-white text-emerald-900 dark:bg-emerald-950 dark:text-emerald-100 pb-[env(safe-area-inset-bottom)]'
  }
};
const availableThemes = Object.keys(THEME_PACKS);


function applyTheme(themeKey){
  const root = document.documentElement;
  const isDark = root.classList.contains('dark');

  const THEME_PACKS = {
    slate: {
      proseClass: 'prose-slate',
      bodyClass: 'bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]'
    },
    emerald: {
      proseClass: 'prose-emerald',
      bodyClass: 'bg-white text-emerald-900 dark:bg-emerald-950 dark:text-emerald-100 pb-[env(safe-area-inset-bottom)]'
    }
  };

  const pack = THEME_PACKS[themeKey] || THEME_PACKS.slate;

  // Color theme classes only attach in DARK; LIGHT is always neutral slate
  root.classList.toggle('theme-emerald', isDark && themeKey === 'emerald');

  // Body ink/background:
  document.body.className = isDark ? pack.bodyClass : THEME_PACKS.slate.bodyClass;

  // Article prose color family (ok to vary by theme in both modes; change if you want neutral):
  const content = document.getElementById('content');
  content.className = `prose ${pack.proseClass} dark:prose-invert max-w-none`;

  // Persist choice (used when you return to dark)
  try { localStorage.setItem('colorScheme', themeKey); } catch(_){}
}



      // Initialize from localStorage
      let currentThemeIndex = 0;
      try {
        const saved = localStorage.getItem('colorScheme');
        if (saved && THEME_PACKS[saved]) currentThemeIndex = availableThemes.indexOf(saved);
      } catch(_) {}

      // ===== Color Scheme Toggle =====
const colorBtn = document.getElementById('colorSchemeToggle');
colorBtn?.addEventListener('click', () => {
  const root = document.documentElement;

  // If we're in LIGHT mode, switch to DARK and stop here (do NOT cycle color yet)
  if (!root.classList.contains('dark')) {
    root.classList.add('dark');
    try { localStorage.setItem('theme','dark'); } catch(_){}
    document.getElementById('themeToggle')?.setAttribute('aria-pressed','true');
    return; // first click behaves like the theme toggle only
  }

  // Already DARK: now cycle to the next color scheme
  currentThemeIndex = (currentThemeIndex + 1) % availableThemes.length;
  const newTheme = availableThemes[currentThemeIndex];
  applyTheme(newTheme);

  // Rebuild TOC (keeps hover styles consistent with the new scheme)
  buildTOC();
});


      // ===== Theme (dark/light) Handling =====
const themeBtn = document.getElementById('themeToggle');
if (themeBtn) {
  themeBtn.setAttribute('aria-pressed', String(document.documentElement.classList.contains('dark')));
}
themeBtn?.addEventListener('click', () => {
  const root = document.documentElement;
  const isDark = root.classList.toggle('dark');
  try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(_){}
  themeBtn.setAttribute('aria-pressed', String(isDark));

  if (!isDark) {
    // Going to LIGHT → always neutralize to slate
    root.classList.remove('theme-emerald');
    try { localStorage.setItem('colorScheme','slate'); } catch(_){}
    applyTheme('slate');
  } else {
    // Back to DARK → reapply saved (or default) color
    let saved = 'slate';
    try { const s = localStorage.getItem('colorScheme'); if (s) saved = s; } catch(_){}
    applyTheme(saved);
  }
  buildTOC();
});

try {
  const mq = matchMedia('(prefers-color-scheme: dark)');
  const onChange = (e) => {
    if (!localStorage.getItem('theme')) { // only if user hasn't forced a theme
      const isDark = e.matches;
      const root = document.documentElement;
      root.classList.toggle('dark', isDark);
      themeBtn?.setAttribute('aria-pressed', String(isDark));

      if (!isDark) {
        root.classList.remove('theme-emerald');
        try { localStorage.setItem('colorScheme','slate'); } catch(_){}
        applyTheme('slate');
      } else {
        let saved = 'slate';
        try { const s = localStorage.getItem('colorScheme'); if (s) saved = s; } catch(_){}
        applyTheme(saved);
      }
      buildTOC();
    }
  };
  if (mq.addEventListener) mq.addEventListener('change', onChange);
  else if (mq.addListener) mq.addListener(onChange); // Safari <14
} catch (_) {}

      // ===== Expand/Collapse Functionality =====
      const getDetails = () => document.querySelectorAll('#content details');
      const expandBtn = document.getElementById('expandAll');
      const collapseBtn = document.getElementById('collapseAll');

      if (getDetails().length === 0) {
        if(expandBtn) expandBtn.hidden = true;
        if(collapseBtn) collapseBtn.hidden = true;
      } else {
        expandBtn?.addEventListener('click', () => { getDetails().forEach(d => d.open = true); });
        collapseBtn?.addEventListener('click', () => { getDetails().forEach(d => d.open = false); });
      }

      // ===== Add Back to Top Links =====
      (function addBackToTopLinks(){
        $$('#content > article').forEach((article, index, arr) => {
          if (index === arr.length - 1) return;
          const wrapper = document.createElement('div');
          wrapper.className = 'mt-6 flex justify-end';
          wrapper.innerHTML = `<a href="#top" class="text-sm underline decoration-dotted">Back to top</a>`;
          article.appendChild(wrapper);
        });
      })();

      // ===== Build Table of Contents =====
      function buildTOC(){
        const toc = document.getElementById('toc');
        if (!toc) return;
        const headings = $$('#content h2, #content h3');
        const items = headings.map(h => {
          if (!h.id) h.id = slug(h.textContent);
          return { id: h.id, text: h.textContent.trim(), level: h.tagName.toLowerCase() };
        });

        toc.innerHTML = items.map(({id, text, level}) => {
          const pad = level === 'h3' ? ' pl-4' : '';
          return `<li><a href="#${id}" class="toc-link block px-2 py-1.5 rounded${pad}">${text}</a></li>`;
        }).join('');

        const links = $$('#toc a');
        const sections = items.map(i => document.getElementById(i.id));
        const obs = new IntersectionObserver(entries => {
          entries.forEach(e => {
            if (e.isIntersecting) {
              links.forEach(a => a.classList.remove('active-link'));
              const id = '#' + e.target.id;
              const active = links.find(a => a.getAttribute('href') === id);
              active?.classList.add('active-link');
            }
          });
        }, { rootMargin: '-40% 0px -55% 0px', threshold: 0.01 });
        sections.forEach(sec => sec && obs.observe(sec));
      }
      buildTOC();

      // ===== Build Timeline from Metadata =====
      (function buildTimeline(){
        const wrap = document.getElementById('timelineWrap');
        const list = document.getElementById('timeline');
        const coda = document.getElementById('timelineCoda');

        if (!timelineStepsData || !wrap || !list) { if(wrap) wrap.hidden = true; return; }

        const steps = timelineStepsData.split(',').map(s => s.trim());
        const labels = timelineLabelsData ? timelineLabelsData.split(',').map(s => s.trim()) : [];

        if (!steps.length) { wrap.hidden = true; return; }
        wrap.hidden = false;

        const mkStep = (id, label) => (
          `<li class="flex items-center gap-2"><span class="inline-block w-[14px] h-[14px] rounded-full border-2 border-current bg-current"></span><a href="#${id}" class="hover:underline">${label}</a></li>`
        );

        const segments = [];
        steps.forEach((id, idx) => {
          const el = $$('#content h2, #content h3').find(h => slug(h.textContent) === id);
          if (el && !el.id) el.id = id;
          const label = labels[idx] || (el?.textContent || id.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
          segments.push(mkStep(id, label));
          if (idx !== steps.length - 1) segments.push('<li class="h-[2px] bg-current opacity-35"></li>');
        });
        list.innerHTML = segments.join('');
      })();

      // ===== Search Highlighter =====
      (function searchHL(){
        const input = document.getElementById('search');
        const clearBtn = document.getElementById('clearSearch');
        const content = document.getElementById('content');
        if (!input || !content) return;
        let originalHTML = '';
        function restore(){ 
          if (originalHTML) {
            content.innerHTML = originalHTML; 
            buildTOC(); 
          }
        }
        function highlight(term){
          if (!originalHTML) originalHTML = content.innerHTML;
          restore();
          if (!term) return;
          const esc = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const re = new RegExp(`(${esc})(?![^<]*>)`, 'gi');
          content.innerHTML = content.innerHTML.replace(re, '<mark>$1</mark>');
          buildTOC();
        }
        let t; 
        input.addEventListener('input', (e) => { 
          clearTimeout(t); 
          t = setTimeout(() => highlight(e.target.value.trim()), 120); 
        });
        clearBtn?.addEventListener('click', () => { 
          if (input) input.value=''; 
          restore(); 
        });
      })();

      // ===== Apply initial theme pack to prose =====
      try {
        const saved = localStorage.getItem('colorScheme');
        applyTheme(saved && THEME_PACKS[saved] ? saved : 'slate');
      } catch(_){
        applyTheme('slate');
      }
    });
  </script>
</body>
</html>

