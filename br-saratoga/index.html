<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battles of Saratoga Knowledge Base Explorer</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg,#2c3e50 0%,#34495e 100%);
            --accent-1: #e74c3c;
            --accent-2: #c03b2b;
            --btn-gradient: linear-gradient(45deg,#e74c3c,#c0392b);
            --accent-1-rgb: 231, 76, 60;
            --accent-warning: #ffc107;
            --accent-warning-rgb: 255, 193, 7;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--accent-1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 15px rgba(var(--accent-1-rgb), 0.3));
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* --- FINAL BUTTON RULES START --- */

        /* Base style for ALL buttons */
        .tab-button, #settings-btn, .sector-button {
            padding: 12px 24px;
            background: var(--ui-background);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Specific settings for the icon */
        #settings-btn {
            font-size: 1.2rem;
            padding: 10px 15px;
        }

        /* HOVER state for buttons */
        .tab-button:hover, .sector-button:hover, #settings-btn:hover {
            background: var(--btn-gradient);
            transform: translateY(-2px);
        }

        /* ACTIVE state for selected buttons */
        .tab-button.active, .sector-button.active {
            background: var(--btn-gradient);
            border-color: var(--accent-2);
            transform: translateY(-2px);
            color: var(--btn-text-active);
        }

        /* LOGIC-DRIVEN TEXT COLOR FOR HOVER AND ACTIVE STATES */
        .btn-light-text:hover, .btn-light-text.active {
             color: var(--text-primary);
        }
        .btn-dark-text:hover, .btn-dark-text.active {
             color: var(--btn-text-active);
        }
        
        /* --- FINAL BUTTON RULES END --- */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: #2c3e50;
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
            position: relative;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            color: var(--accent-1);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .modal-content label {
            font-size: 1.1rem;
            margin-right: 10px;
        }

        #theme-select {
            background-color: var(--ui-background);
            color: var(--text-primary);
            border: 1px solid var(--accent-2);
            border-radius: 5px;
            padding: 8px;
            font-size: 1rem;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--text-primary);
            text-decoration: none;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .section-title {
            color: var(--accent-1);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-1);
        }

        .subsection {
            margin: 1.5rem 0;
        }

        .subsection h3 {
            color: var(--accent-1);
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
        }

        .subsection h4 {
            color: var(--accent-2);
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem 0;
        }

        .sector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .sector-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sector-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
        }

        .sector-name {
            color: var(--accent-1);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .casualties-highlight {
            background: rgba(var(--accent-warning-rgb), 0.15);
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid var(--accent-warning);
            margin: 1rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

           .stat-card {
            background: var(--ui-background-accent);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-1);
            display: block;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .highlight {
            background: rgba(var(--accent-1-rgb), 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .interactive-map {
            background: var(--container-background-subtle);
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sector-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .sector-detail {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .sector-detail.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            .container {
                padding: 1rem;
            }
            .sector-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script>
    // Self-executing function to manage all theme logic.
    (function() {
        const DEFAULT_THEME_NAME = 'cyber-night';
    
        let THEMES = {
    'cyber-night': {
        '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
        '--accent-1': '#a8b8d0', '--accent-1-rgb': '168, 184, 208',
        '--accent-2': '#8899b3',
        '--btn-gradient': 'linear-gradient(45deg,#1a1a3a,#2e2e5e)',
        '--accent-warning': '#e8b339',
        '--accent-warning-rgb': '232, 179, 57',
        '--ui-background': '#34495e',
        '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
        '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
        '--btn-text-active': '#ecf0f1' // Light text for dark button
    },
    'teal-matrix': {
        '--bg-gradient': 'linear-gradient(135deg,#0a231c 0%,#1a3a31 50%,#2e5e50 100%)',
        '--accent-1': '#ace0d5', '--accent-1-rgb': '172, 224, 213',
        '--accent-2': '#92b3a9',
        '--btn-gradient': 'linear-gradient(45deg,#1a3a31,#2e5e50)',
        '--accent-warning': '#e8b339',
        '--accent-warning-rgb': '232, 179, 57',
        '--ui-background': '#345e55',
        '--ui-background-accent': 'rgba(52, 94, 85, 0.8)',
        '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
        '--btn-text-active': '#ecf0f1' // Light text for dark button
    },
'red-alert': {
        '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
        '--ui-background': '#34495e',
        '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
        '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
        '--accent-1': '#e74c3c',
        '--accent-2': '#c03b2b',
        '--btn-gradient': 'linear-gradient(45deg,#e74c3c,#c0392b)',
        '--accent-1-rgb': '231, 76, 60',
        '--accent-warning': '#e8b339',
        '--accent-warning-rgb': '232, 179, 57',
        '--btn-text-active': '#ffffff' // Light text for mid-tone button
    },
'scorched-gold': {
    // --- Deep Teal Base ---
    '--bg-gradient': 'linear-gradient(135deg,#0a231f 0%,#193a33 50%,#2e5e54 100%)',
    '--ui-background': '#345e56',
    '--ui-background-accent': 'rgba(52, 94, 86, 0.8)',
    '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',

    // --- Gold & Amber Accents ---
    '--accent-1': '#f0c475', // Bright Gold
    '--accent-2': '#d4a24c', // Darker Amber
    '--btn-gradient': 'linear-gradient(45deg,#f0c475,#d4a24c)',
    '--accent-1-rgb': '240, 196, 117',
    '--btn-text-active': '#2a1d15', // Dark text for the gold button
    '--btn-text-hover': '#2a1d15',  // Dark text for the gold button

    // --- Standard Warning Color ---
    '--accent-warning': '#e8b339',
    '--accent-warning-rgb': '232, 179, 57'
},
'crimson-emerald': {
        '--bg-gradient': 'linear-gradient(135deg,#0a230a 0%,#1a3a1a 50%,#2e5e2e 100%)',
        '--ui-background': '#345e49',
        '--ui-background-accent': 'rgba(52, 94, 73, 0.8)',
        '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
        '--accent-1': '#e04f7f',
        '--accent-2': '#c73363',
        '--btn-gradient': 'linear-gradient(45deg,#e04f7f,#c73363)',
        '--accent-1-rgb': '224, 79, 127',
        '--accent-warning': '#e8b339',
        '--accent-warning-rgb': '232, 179, 57',
        '--btn-text-active': '#ffffff' // Light text for mid-tone button
    },
'emerald-cyber': {
                '--bg-gradient': 'linear-gradient(135deg,#0a230a 0%,#1a3a1a 50%,#2e5e2e 100%)',
                '--accent-1': '#a8d0b8', '--accent-1-rgb': '168, 208, 184',
                '--accent-2': '#6a947a', '--btn-gradient': 'linear-gradient(45deg,#1a3a1a,#2e5e2e)',
                '--accent-warning': '#ffc107', '--accent-warning-rgb': '255, 193, 7',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)'

            },
'scorched-copper': {
    // --- Dark, Earthy Brown Base ---
    '--bg-gradient': 'linear-gradient(135deg,#2a1d15 0%,#4e3427 50%,#5a4032 100%)',
    '--ui-background': '#5a4032',
    '--ui-background-accent': 'rgba(90, 64, 50, 0.8)',
    '--container-background-subtle': 'rgba(26, 15, 8, 0.3)',

    // --- Bright Copper Accents ---
    '--accent-1': '#d4af37', // A bright gold/copper
    '--accent-2': '#b87333', // A darker, true copper
    '--btn-gradient': 'linear-gradient(45deg,#d4af37,#b87333)',
    '--accent-1-rgb': '212, 175, 55',
    '--btn-text-active': '#2a1d15', // Dark brown text for the bright button
    '--btn-text-hover': '#2a1d15',  // Dark brown text for the bright button

    // --- Sandy Gold Warning Color ---
    '--accent-warning': '#f0e68c',
    '--accent-warning-rgb': '240, 230, 140'
},
    'emerald-night': {
        '--bg-gradient': 'linear-gradient(135deg,#0a230a 0%,#1a3a1a 50%,#2e5e2e 100%)',
        '--accent-1': '#a8d0b8', '--accent-1-rgb': '168, 208, 184',
        '--accent-2': '#6a947a',
        '--btn-gradient': 'linear-gradient(45deg,#1a3a1a,#2e5e2e)',
        '--accent-warning': '#ffc107', '--accent-warning-rgb': '255, 193, 7',
        '--ui-background': '#345e49',
        '--ui-background-accent': 'rgba(52, 94, 73, 0.8)',
        '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
        '--btn-text-active': '#ecf0f1' // Light text for dark button
    }
    
};

        function finalizeThemes(themes) {
            for (const themeName in themes) {
                const theme = themes[themeName];
                const gradient = theme['--btn-gradient'];

                // Simple check for light/luminous hex codes in the gradient
                if (gradient.includes('#d') || gradient.includes('#e') || gradient.includes('#f') || gradient.includes('#99e') || gradient.includes('#cd')) {
                    theme.hover_style = 'btn-dark-text'; 
                } else {
                    theme.hover_style = 'btn-light-text';
                }
            }
            return themes;
        }

        THEMES = finalizeThemes(THEMES);
    
        function applyTheme(name) {
            const theme = THEMES[name];
            if (theme) {
                const root = document.documentElement;
                for (const [key, value] of Object.entries(theme)) {
                    if(key !== 'hover_style') { // Don't try to set hover_style as a CSS variable
                        root.style.setProperty(key, value);
                    }
                }

                const buttons = document.querySelectorAll('.tab-button, .sector-button, #settings-btn');
                buttons.forEach(button => {
                    button.classList.remove('btn-light-text', 'btn-dark-text');
                    if (theme.hover_style) {
                        button.classList.add(theme.hover_style);
                    }
                });
            }
        }
    
        window.setTheme = function(name) {
            applyTheme(name);
            localStorage.setItem('saratoga-theme', name);
        }
    
        const availableThemeNames = Object.keys(THEMES);
        const savedTheme = localStorage.getItem('saratoga-theme');
        let themeToLoad = DEFAULT_THEME_NAME;

        if (savedTheme && availableThemeNames.includes(savedTheme)) {
            themeToLoad = savedTheme;
        }
        
        applyTheme(themeToLoad);
    
        document.addEventListener('DOMContentLoaded', () => {
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                availableThemeNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    themeSelect.appendChild(option);
                });
                themeSelect.value = themeToLoad;
            }
        });
    })();
    </script>
</head>
<body>
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="close-btn">&times;</button>
            <h3>Display Settings</h3>
            <label for="theme-select">Theme:</label>
            <select id="theme-select" onchange="setTheme(this.value)"></select>
        </div>
    </div>

    <div class="header">
        <h1>The Battles of Saratoga</h1>
        <p>Sept 19 & Oct 7, 1777 • The Turning Point of the Revolution • Knowledge Base Explorer</p>
    </div>

    <div class="nav-tabs">
        <button class="tab-button active" data-tab="overview">Overview</button>
        <button class="tab-button" data-tab="commanders">Commanders</button>
        <button class="tab-button" data-tab="battles">The Battles</button>
        <button class="tab-button" data-tab="turning-point">Turning Point</button>
        <button class="tab-button" data-tab="casualties">Casualties & Surrender</button>
        <button class="tab-button" data-tab="search">Search Knowledge</button>
        <button id="settings-btn" title="Settings">⚙️</button>
    </div>

    <div class="container">
        <div id="overview" class="tab-content active">
             <div class="section-card">
                <h2 class="section-title">The Saratoga Campaign: A Decisive Victory</h2>
                <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 2rem;">
                    Fought in the autumn of 1777, the two Battles of Saratoga were a crucial victory for the Patriot cause during the American Revolution. British General John Burgoyne's army, moving south from Canada, intended to split New England from the other colonies but was met by a determined American force. The American victory convinced France to enter the war as an ally, providing essential support that would ultimately lead to American independence.
                </p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">2</span>
                        <div class="stat-label">Major Battles</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">>15,000</span>
                        <div class="stat-label">American Forces Assembled</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~6,000</span>
                        <div class="stat-label">British & German Troops Surrendered</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">1</span>
                        <div class="stat-label">Major Turning Point</div>
                    </div>
                </div>

                <div class="interactive-map">
                    <h3 style="color: var(--accent-1); margin-bottom: 1rem;">The Two Key Engagements</h3>
                    <p>Click on each battle to learn more about the specific encounters:</p>
                    <div class="sector-buttons">
                        <button class="sector-button" data-sector="freeman">Battle of Freeman's Farm</button>
                        <button class="sector-button" data-sector="bemis">Battle of Bemis Heights</button>
                    </div>

                    <div id="freeman-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">Battle of Freeman's Farm - September 19, 1777</h4>
                        <p><strong>Outcome:</strong> A tactical British victory, but at a great cost. American forces, particularly Daniel Morgan's riflemen, inflicted heavy casualties on the advancing British. The British held the field but were weakened significantly.</p>
                    </div>
                    <div id="bemis-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">Battle of Bemis Heights - October 7, 1777</h4>
                        <p><strong>Outcome:</strong> A decisive American victory. A British reconnaissance in force was repulsed, and a spirited American counter-attack, led in part by Benedict Arnold, broke the British lines and forced their retreat.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="commanders" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Opposing Commanders</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">American Command</h3>
                        <p><strong>Maj. Gen. Horatio Gates:</strong> The overall commander of the American Northern Department, credited with the victory despite his cautious approach. He organized the strong defensive position at Bemis Heights.</p>
                        <p><strong>Maj. Gen. Benedict Arnold:</strong> A brilliant and aggressive field commander. His initiative was crucial at Freeman's Farm and he famously defied orders to lead a charge at Bemis Heights, sustaining a serious leg wound.</p>
                         <p><strong>Col. Daniel Morgan:</strong> Leader of a corps of expert riflemen who played a key role in inflicting heavy casualties on the British, especially at Freeman's Farm.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">British Command</h3>
                        <p><strong>Lt. Gen. John Burgoyne:</strong> Commander of the British forces. Nicknamed "Gentleman Johnny," he devised the plan to invade from Canada but was ultimately outmaneuvered and forced to surrender his entire army.</p>
                        <p><strong>Maj. Gen. William Phillips:</strong> A senior officer in Burgoyne's army, commanding the British regulars.</p>
                        <p><strong>Brig. Gen. Simon Fraser:</strong> Commanded the advance corps of the British army. His death at the Battle of Bemis Heights was a major blow to British morale.</p>
                    </div>
                </div>
                <div class="casualties-highlight">
                    <h4>Clash of Command</h4>
                    <p>A bitter personal dispute between Horatio Gates and Benedict Arnold erupted between the two battles. Gates, jealous and cautious, relieved Arnold of his command. Despite this, Arnold famously rode into the Battle of Bemis Heights, rallying the American troops to victory.</p>
                </div>
            </div>
        </div>

        <div id="battles" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Battles - Sept & Oct 1777</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <div class="sector-name">Freeman's Farm (Sept 19)</div>
                        <p><strong>Forces Engaged:</strong> Burgoyne attempted to flank the entrenched American position on Bemis Heights. Benedict Arnold, anticipating the move, met the British force at a clearing on John Freeman's farm.</p>
                        <p><strong>Outcome:</strong> The fighting was fierce and lasted for hours. While the British technically won by holding the field, they suffered nearly 600 casualties, double the American losses. This pyrrhic victory halted Burgoyne's advance.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">Bemis Heights (Oct 7)</div>
                        <p><strong>Forces Engaged:</strong> With his supplies dwindling and no reinforcements arriving, Burgoyne launched a reconnaissance-in-force against the American left flank. The Americans, now numbering over 11,000, decisively met the attack.</p>
                        <p><strong>Outcome:</strong> The American forces, spearheaded by a charge led by Benedict Arnold, overwhelmed the British and German troops. The death of British General Simon Fraser demoralized his men. The British were thrown back to their original positions and a portion of their defenses were captured, leading to their eventual surrender.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="turning-point" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Turning Point of the War</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">French Alliance</h3>
                        <p>The decisive American victory was the catalyst for France to formally enter the war on the American side. Benjamin Franklin, negotiating in Paris, used the victory to secure a formal treaty of alliance in February 1778.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">International Support</h3>
                        <p>The victory at Saratoga convinced other European powers that the Americans could win the war. French financial aid, troops, and, most importantly, naval power, were critical to the ultimate American victory at Yorktown.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">Boost to American Morale</h3>
                        <p>The surrender of an entire British army was an enormous psychological victory for the Patriots. It lifted morale throughout the colonies and gave credibility to the cause of independence, encouraging recruitment and continued resistance.</p>
                    </div>
                </div>
                <div class="subsection">
                    <h3>Strategic Impact</h3>
                    <p style="font-size: 1.1rem; line-height: 1.7;">
                        The failure of Burgoyne's campaign completely derailed the British strategy to isolate New England. It proved that American forces could stand up to and defeat regular British army units in open battle, not just from behind fortifications. The British were forced to reconsider their strategy and the war expanded into a global conflict with the entry of France.
                    </p>
                </div>
            </div>
        </div>

        <div id="casualties" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Casualties and Surrender</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">~800</span>
                        <div class="stat-label">Total American Casualties (KIA, WIA)</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~1,500</span>
                        <div class="stat-label">Total British & German Casualties</div>
                    </div>
                     <div class="stat-card">
                        <span class="stat-number">5,800+</span>
                        <div class="stat-label">British & German Troops Surrendered</div>
                    </div>
                </div>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">Freeman's Farm Losses</h3>
                        <p>The British suffered heavily in the first battle, with about 600 killed, wounded, or captured. American losses were around 300. The British 62nd Regiment was reduced to the size of a single company.</p>
                    </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Bemis Heights Losses</h3>
                         <p>The second battle was also costly for Burgoyne, with another 600 casualties. The Americans suffered about 150 killed and wounded. The death of Brigadier Simon Fraser was a critical loss for the British.</p>
                    </div>
                     <div class="sector-card">
                        <h3 class="sector-name">The Surrender: October 17, 1777</h3>
                         <p>Surrounded by a much larger American army (numbering up to 15,000 men) and with no hope of reinforcement, General Burgoyne surrendered his entire army to General Gates. The formal ceremony took place in what is now Schuylerville, NY.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="search" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Search the Knowledge Base</h2>
                <input type="text" id="searchInput" class="search-box" placeholder="Search for people, places, battles, or any topic...">
                
                <div id="searchResults">
                    <p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">
                        Enter a search term above to explore the Saratoga knowledge base.<br>
                        Try searching for: "Benedict Arnold", "Horatio Gates", "Freeman's Farm", "turning point", "French alliance", etc.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Knowledge base for searching
        const knowledgeBase = {
            "Horatio Gates": "Major General Horatio Gates was the American commander of the Northern Department. He was credited with the victory at Saratoga, though his field commanders, like Benedict Arnold, were more aggressive. Gates and Arnold had a severe personal disagreement after the first battle.",
            "Benedict Arnold": "A brilliant but controversial American general. Arnold's aggressive tactics were vital at both Freeman's Farm and Bemis Heights. He defied orders from Gates to lead a heroic charge at Bemis Heights, where he was severely wounded in the leg. His contributions were initially downplayed by Gates.",
            "John Burgoyne": "Known as 'Gentleman Johnny', he was the British Lieutenant General who led the invasion from Canada. His plan was to cut New England off from the other colonies, but his slow advance and losses at Bennington and Saratoga led to the surrender of his entire army.",
            "Daniel Morgan": "Colonel Daniel Morgan commanded a unit of highly skilled American riflemen. Their marksmanship was devastating to the British officer corps at the Battle of Freeman's Farm.",
            "Simon Fraser": "A British Brigadier General commanding the advance force. His death by a rifleman's shot at Bemis Heights was a turning point in that battle, causing significant demoralization among the British troops.",
            "Freeman's Farm": "The first battle, fought on September 19, 1777. It was a tactical victory for the British, but they suffered unsustainable casualties, halting their campaign. The fighting was intense and centered on a clearing on loyalist John Freeman's property.",
            "Bemis Heights": "The second battle, fought on October 7, 1777. It was a decisive American victory. A British attack was repelled, and an American counter-assault broke the British lines, forcing a general retreat.",
            "Turning Point": "Saratoga is widely considered the turning point of the Revolutionary War. The victory convinced France to form a military alliance with the United States, providing crucial money, troops, and naval support that helped win the war.",
            "French Alliance": "The American victory at Saratoga was the key event that convinced the Kingdom of France to officially recognize and ally with the United States. This transformed the war into a global conflict for Great Britain.",
            "Surrender": "On October 17, 1777, General Burgoyne surrendered his surrounded and depleted army of over 5,800 men to General Gates. It was the first time in history a British army had ever surrendered.",
            "Casualties": "Over the two battles, the British and their German allies suffered about 1,500 casualties. The Americans lost about 800 men killed and wounded. The British also lost over 6,000 men as prisoners of war after the surrender."
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeSectorButtons();
            initializeSearch();
            initializeModal();
        });

        function initializeModal() {
            const modal = document.getElementById('settings-modal');
            const openBtn = document.getElementById('settings-btn');
            const closeBtn = document.getElementById('close-modal-btn');

            if (modal && openBtn && closeBtn) {
                openBtn.addEventListener('click', () => {
                    modal.classList.add('show');
                });

                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });

                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            }
        }

        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        }

        function showTab(tabName) {
            try {
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(content => {
                    if (content && content.classList) {
                        content.classList.remove('active');
                    }
                });

                const tabButtons = document.querySelectorAll('.tab-button');
                tabButtons.forEach(button => {
                    if (button && button.classList) {
                        button.classList.remove('active');
                    }
                });

                const targetTab = document.getElementById(tabName);
                if (targetTab && targetTab.classList) {
                    targetTab.classList.add('active');
                }

                const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
                if (activeButton && activeButton.classList) {
                    activeButton.classList.add('active');
                }
            } catch (error) {
                console.error('Error in showTab:', error);
            }
        }

        function initializeSectorButtons() {
            const sectorButtons = document.querySelectorAll('.sector-button');
            sectorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sectorName = this.getAttribute('data-sector');
                    showSectorDetail(sectorName, this);
                });
            });
        }

        function showSectorDetail(sector, clickedButton) {
            try {
                const details = document.querySelectorAll('.sector-detail');
                details.forEach(detail => detail.classList.remove('show'));

                const buttons = document.querySelectorAll('.sector-button');
                buttons.forEach(button => button.classList.remove('active'));

                const targetDetail = document.getElementById(sector + '-detail');
                if (targetDetail) {
                    targetDetail.classList.add('show');
                    clickedButton.classList.add('active');
                }
            } catch (error) {
                console.error('Error in showSectorDetail:', error);
            }
        }

        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keyup', searchContent);
            }
        }

        function searchContent() {
            try {
                const searchInput = document.getElementById('searchInput');
                const resultsDiv = document.getElementById('searchResults');
                
                if (!searchInput || !resultsDiv) return;
                
                const searchTerm = searchInput.value.toLowerCase();

                if (searchTerm.length < 2) {
                    resultsDiv.innerHTML = '<p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">Enter a search term above to explore the Saratoga knowledge base.<br>Try searching for: "Benedict Arnold", "Horatio Gates", "Freeman\'s Farm", "turning point", "French alliance", etc.</p>';
                    return;
                }

                let results = [];
                
                for (const key in knowledgeBase) {
                    if (knowledgeBase.hasOwnProperty(key)) {
                        const value = knowledgeBase[key];
                        if (key.toLowerCase().includes(searchTerm) || value.toLowerCase().includes(searchTerm)) {
                            results.push({
                                title: key,
                                content: value,
                                relevance: key.toLowerCase().startsWith(searchTerm) ? 2 : 1
                            });
                        }
                    }
                }

                results.sort((a, b) => b.relevance - a.relevance);

                if (results.length === 0) {
                    resultsDiv.innerHTML = `<div class="section-card"><h3 style="color: var(--accent-1);">No results found for "${searchInput.value}"</h3><p>Try searching for commander names, battle names, or key terms.</p></div>`;
                    return;
                }

                let resultHTML = `<h3 style="color: var(--accent-1); margin-bottom: 1.5rem;">Search Results for "${searchInput.value}"</h3>`;
                
                for (let i = 0; i < results.length; i++) {
                    const result = results[i];
                    const highlightedContent = result.content.replace(new RegExp(searchTerm, 'gi'), '<span class="highlight">$&</span>');
                    
                    resultHTML += `<div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--accent-1);"><h4 style="color: var(--accent-1); margin-bottom: 0.8rem;">${result.title}</h4><p style="line-height: 1.6;">${highlightedContent}</p></div>`;
                }

                resultsDiv.innerHTML = resultHTML;
            } catch (error) {
                console.error('Error in searchContent:', error);
            }
        }
    </script>
</body>
</html>
