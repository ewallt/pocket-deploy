<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Threaded Reader — Song of Moses (Exodus 15)</title>

  <!-- Tailwind (with Typography) -->
  <script>
    tailwind = { config: { darkMode: 'class' } };
  </script>
  <script defer src="https://cdn.tailwindcss.com?plugins=typography"></script>

  <!-- Blue Letter Bible verse tagger (auto-links refs like Exod 15:2) -->
  <script src="https://www.blueletterbible.org/scripts/blbToolTip/BLB_ScriptTagger-min.js"></script>

  <!-- Google Font (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: light dark; }
    html { scroll-behavior: smooth; }
    .font-newspaper { font-family: 'Lora', serif; }
    /* Header gradient */
    .hero { background: radial-gradient(50% 120% at 10% 10%, rgba(49,46,129,.12), transparent 60%),
                     radial-gradient(80% 140% at 90% 10%, rgba(234,88,12,.12), transparent 70%),
                     linear-gradient(180deg, rgba(14,165,233,.08), transparent 35%); }
    /* Anchor comfort */
    :where(h2,h3,h4){ scroll-margin-top: 84px; }
    /* Highlight */
    mark { background: #fde68a; padding: .1em .2em; border-radius: .2rem; }
    /* Tiny screens */
    @media (max-width: 380px){ .prose { font-size: .96rem; } }
    .active-link { color: rgb(59,130,246); font-weight: 700; }
#themeToggle { display: none !important; }
  </style>
</head>
<body class="bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]">
  <!-- Theme bootstrap -->
  <script>
    (function(){
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'dark' || (!saved && matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
      } catch(_){}
    })();
  </script>

  <!-- Header -->
  <header id="top" class="hero border-b border-slate-200/60 dark:border-slate-800/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold font-newspaper tracking-tight">Threaded Reader — Song of Moses (Exodus 15)</h1>
        <p class="text-sm sm:text-base text-slate-600 dark:text-slate-400">Study notes for church on the “Song of the Sea” (<span>Exodus 15:1–18</span>) with Miriam’s refrain (<span>Exodus 15:20–21</span>). Focus: story context, themes, worship use, reception, and music inspired by it.</p>
      </div>
      <div class="flex items-center gap-2">
        <label for="search" class="sr-only">Search</label>
        <input id="search" type="search" placeholder="Search…" class="hidden md:block w-56 rounded-xl border border-slate-300/70 dark:border-slate-700/70 bg-white/70 dark:bg-slate-900/60 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400" />
        <button id="clearSearch" class="hidden md:inline-flex text-xs px-2 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-900">Clear</button>
        <button id="themeToggle" class="inline-flex items-center justify-center rounded-xl border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm hover:bg-slate-50 dark:hover:bg-slate-900" title="Toggle dark mode">
          <span class="inline md:hidden">Theme</span>
          <svg aria-hidden="true" class="w-5 h-5 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg aria-hidden="true" class="w-5 h-5 dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </button>
      </div>
    </div>

    <!-- Timeline (auto from FEATURE below) -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6" id="timelineWrap">
      <nav aria-label="Journey timeline" class="text-slate-500 dark:text-slate-400">
        <ol id="timeline" class="grid grid-cols-3 sm:grid-cols-6 items-center gap-x-2 gap-y-1 text-[11px] sm:text-sm"></ol>
        <div id="timelineCoda" class="mt-2 text-[11px] sm:text-xs"></div>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-[260px_minmax(0,1fr)] gap-8">
    <!-- Sidebar -->
    <aside class="lg:sticky lg:top-4 h-max">
      <nav aria-label="On this page" class="rounded-2xl border border-slate-200 dark:border-slate-800 p-4">
        <h2 class="text-sm font-semibold mb-2">Sections</h2>
        <ol id="toc" class="space-y-1 text-sm"></ol>
        <hr class="my-4 border-slate-200 dark:border-slate-800" />
        <button id="expandAll" class="w-full text-xs px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-900">Expand All</button>
        <button id="collapseAll" class="mt-2 w-full text-xs px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-900">Collapse All</button>
      </nav>
      <div class="mt-4 text-xs text-slate-500 dark:text-slate-400">
        Tip: Search highlights terms. Auto‑TOC builds from your H2/H3 headings.
      </div>
    </aside>

    <!-- CONTENT -->
    <section id="content" class="prose prose-slate dark:prose-invert max-w-none">

      <article class="rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Overview</h2>
        <p>The Song of Moses (also called the “Song of the Sea”) celebrates deliverance at the Red Sea (<span>Exodus 15:1–18</span>), with Miriam’s refrain preserved in <span>Exodus 15:20–21</span>. These notes highlight story context, major themes, worship use, reception through history, and music influenced by the text.</p>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Biblical Text &amp; Outline</h2>
        <p><strong>Location in Scripture:</strong> <span>Exodus 15:1–18</span> is the main poem; <span>Exodus 15:20–21</span> preserves Miriam’s refrain with timbrel and dance.</p>
        <h3>Simple Outline</h3>
        <ol>
          <li><strong>Opening praise:</strong> the LORD as Deliverer (vv. 1–3).</li>
          <li><strong>Egypt’s defeat &amp; Israel’s rescue:</strong> through the sea (vv. 4–16).</li>
          <li><strong>Hope for God’s dwelling &amp; reign:</strong> among his people (vv. 17–18).</li>
        </ol>
        <h3>Poetry Features</h3>
        <ul>
          <li>Repetition (“horse and rider”), short parallel lines, vivid imagery (deep waters; the LORD’s right hand).</li>
          <li>Forward look to worship at God’s holy mountain (v. 17).</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Historical Background</h2>
        <ul>
          <li><strong>Right after the crossing:</strong> Israel sings in response to deliverance from Pharaoh’s chariots (<span>Exodus 14</span>). Communal thanksgiving after passing through the waters.</li>
          <li><strong>Late Bronze Age context:</strong> References to horses, chariots, and elite officers match Egyptian military of the period; sea imagery fits a real escape followed by enemy loss.</li>
          <li><strong>Women lead the refrain:</strong> Miriam the prophet leads with timbrels and dancing, modeling responsive worship for the congregation.</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Theological Themes</h2>
        <ul>
          <li><strong>God the Warrior — for the oppressed:</strong> “a man of war” depicts God using power to free slaves and confront injustice, not to bully the weak.</li>
          <li><strong>From rescue to worship:</strong> v. 17 anticipates a holy dwelling where God “plants” his people; salvation aims at fellowship and worship, not only escape.</li>
          <li><strong>From Exodus to Revelation:</strong> <span>Revelation 15:3–4</span> echoes this as “the song of Moses and the Lamb,” linking the first great deliverance to the final one.</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Use in Worship</h2>
        <ul>
          <li><strong>Jewish prayer:</strong> <em>Shirat HaYam</em> recited in daily morning prayers; read on the seventh day of Passover in many communities.</li>
          <li><strong>Christian baptismal echoes:</strong> Red Sea as a type of baptism: slavery → freedom, death → life, enemies left behind.</li>
          <li><strong>Call‑and‑response:</strong> Miriam’s refrain models leader lines with congregational response—still used widely.</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Music &amp; Arts</h2>
        <ul>
          <li><strong>Handel and beyond:</strong> Baroque works like Handel’s <em>Israel in Egypt</em> set Exodus 15 lines for choir; composers continue to adapt the text.</li>
          <li><strong>Chant and cantillation:</strong> Traditional Torah cantillation assigns special melodies to this chapter; many congregations stand during its singing.</li>
          <li><strong>Modern chorus:</strong> Popular worship songs quote the refrain: “I will sing unto the LORD, for he has triumphed gloriously; the horse and rider thrown into the sea.”</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Reception Through Time</h2>
        <ul>
          <li><strong>Rabbinic &amp; patristic readings:</strong> Rabbis linked the song to creation and covenant; church fathers read Pharaoh as sin and the sea as baptismal waters.</li>
          <li><strong>Scholarly notes:</strong> Often considered among the oldest Hebrew poems due to archaic style and early Israelite worship themes.</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Geography &amp; Visuals</h2>
        <ul>
          <li><strong>Route snapshot:</strong> Egypt → departure sites → sea crossing → desert route toward Sinai.</li>
          <li><strong>Teaching aid:</strong> One‑slide timeline: Slavery → Plagues → Passover → Crossing → Song → Journey to Sinai.</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Discussion Starters</h2>
        <ul>
          <li><strong>Praise after rescue:</strong> Why does praise come so naturally after deliverance? Share a time God brought you through and how you responded.</li>
          <li><strong>Power and goodness:</strong> How does the song keep power from feeling scary? What in the lyrics shows God’s power is for the vulnerable?</li>
          <li><strong>From then to now:</strong> If <span>Revelation 15</span> puts this song on the lips of the redeemed, what do we learn about worship at the end of time?</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Teaching Helps</h2>
        <ul>
          <li><strong>Memory line:</strong> “The LORD is my strength and my song, and he has become my salvation” (<span>Exodus 15:2</span>).</li>
          <li><strong>One‑sentence summary:</strong> God rescues his people, defeats oppression, and leads them toward a future of worship in his presence.</li>
          <li><strong>Class opener:</strong> Play a modern setting of the refrain and ask: Which words or images stand out to you, and why?</li>
        </ul>
      </article>

      <article class="mt-6 rounded-2xl border border-slate-200 dark:border-slate-800 p-6">
        <h2>Further Reading</h2>
        <ul>
          <li><strong>Bible cross‑refs:</strong> See <span>Psalms 66</span>, <span>78</span>, <span>106</span>; <span>Isaiah 12</span>; <span>Revelation 15:3–4</span> for echoes.</li>
          <li><strong>Background notes:</strong> Intro sections of strong Exodus commentaries cover historical setting, poetry, and worship use.</li>
        </ul>
      </article>

      <div class="mt-8 flex items-center justify-between">
        <a href="#top" class="text-sm underline decoration-dotted">Back to top</a>
        <span class="text-xs text-slate-500 dark:text-slate-400">Threaded Reader — single‑file study</span>
      </div>
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 text-xs text-slate-500 dark:text-slate-400">
    Paste any document → headings become anchors & TOC → optional timeline set below.
  </footer>

  <script>
    // ===== Feature toggles =====
    const FEATURE = {
      TIMELINE: true,
      TIMELINE_STEPS: [
        'overview',
        'biblical-text-outline',
        'historical-background',
        'theological-themes',
        'use-in-worship',
        'reception-through-time'
      ],
      TIMELINE_LABELS: {
        'biblical-text-outline': 'Text & Outline',
        'use-in-worship': 'Worship Use',
        'reception-through-time': 'Reception'
      },
      TIMELINE_CODA: 'Coda: <a href="#music-arts" class="underline decoration-dotted">Music & Arts</a>'
    };

    // ===== Utilities =====
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const slug = s => s.toLowerCase().replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-');

    // Theme toggle
    document.getElementById('themeToggle')?.addEventListener('click', () => {
      const root = document.documentElement;
      const isDark = root.classList.toggle('dark');
      try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(_){ }
    });

    // Expand/Collapse all <details>
    const detailsAll = () => $$('#content details');
    document.getElementById('expandAll')?.addEventListener('click', () => detailsAll().forEach(d => d.open = true));
    document.getElementById('collapseAll')?.addEventListener('click', () => detailsAll().forEach(d => d.open = false));

    // Build TOC from H2/H3
    (function buildTOC(){
      const toc = document.getElementById('toc');
      if (!toc) return;
      const headings = $$('#content h2, #content h3');
      const items = headings.map(h => {
        if (!h.id) h.id = slug(h.textContent);
        return { id: h.id, text: h.textContent.trim(), level: h.tagName.toLowerCase() };
      });
      toc.innerHTML = items.map(({id, text, level}) => {
        const pad = level === 'h3' ? ' pl-4' : '';
        return `<li><a href="#${id}" class="block px-2 py-1.5 rounded hover:bg-slate-50 dark:hover:bg-slate-900${pad}">${text}</a></li>`;
      }).join('');

      // Scroll‑spy
      const links = $$('#toc a');
      const sections = items.map(i => document.getElementById(i.id));
      const obs = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            links.forEach(a => a.classList.remove('active-link'));
            const id = '#' + e.target.id;
            const active = links.find(a => a.getAttribute('href') === id);
            active?.classList.add('active-link');
          }
        });
      }, { rootMargin: '-40% 0px -55% 0px', threshold: 0.01 });
      sections.forEach(sec => sec && obs.observe(sec));
    })();

    // Optional timeline builder
    (function buildTimeline(){
      if (!FEATURE.TIMELINE) { document.getElementById('timelineWrap').hidden = true; return; }
      const steps = (FEATURE.TIMELINE_STEPS || []).filter(Boolean);
      const wrap = document.getElementById('timelineWrap');
      const list = document.getElementById('timeline');
      const coda = document.getElementById('timelineCoda');
      if (!wrap || !list) return;
      if (!steps.length) { wrap.hidden = true; return; }
      wrap.hidden = false;

      const mkStep = (id, label) => (
        `<li class="flex items-center gap-2"><span class="inline-block w-[14px] h-[14px] rounded-full border-2 border-current bg-current"></span><a href="#${id}" class="hover:underline">${label}</a></li>`
      );
      const segments = [];
      steps.forEach((id, idx) => {
        const el = document.getElementById(id);
        const fallback = id.replace(/-/g,' ').replace(/\b\w/g, m => m.toUpperCase());
        const label = FEATURE.TIMELINE_LABELS?.[id] || (el ? el.textContent : fallback);
        segments.push(mkStep(id, label));
        if (idx !== steps.length - 1) segments.push('<li class="h-[2px] bg-current opacity-35"></li>');
      });
      list.innerHTML = segments.join('');
      if (FEATURE.TIMELINE_CODA) coda.innerHTML = FEATURE.TIMELINE_CODA;
    })();

    // Search highlighter
    (function searchHL(){
      const input = document.getElementById('search');
      const clearBtn = document.getElementById('clearSearch');
      const content = document.getElementById('content');
      let originalHTML = '';
      function restore(){ if (originalHTML) content.innerHTML = originalHTML; }
      function highlight(term){
        if (!originalHTML) originalHTML = content.innerHTML;
        restore();
        if (!term) return;
        const esc = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const re = new RegExp(`(${esc})(?![^<]*>)`, 'gi');
        content.innerHTML = content.innerHTML.replace(re, '<mark>$1</mark>');
      }
      let t; input?.addEventListener('input', (e) => { clearTimeout(t); t = setTimeout(() => highlight(e.target.value.trim()), 120); });
      clearBtn?.addEventListener('click', () => { input.value=''; restore(); });
    })();
  </script>
</body>
</html>
