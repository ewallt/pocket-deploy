<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Course Template</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com/3.4.1?plugins=typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Default Theme: Newspaper */
        :root {
            --bg-gradient: #fdfdf8;
            --text: #1c1c1c;
            --accent-text: #8c1c13;
            --nav-bg: #f1f1eb;
            --nav-border: #dcdcd3;
            --nav-text: #1c1c1c;
            --nav-hover-bg: #e5e5dd;
            --nav-active-bg: #dcdcd3;
            --nav-active-text: #1c1c1c;
            --prose-text: var(--text);
            --prose-headings: var(--accent-text);
            --prose-links: var(--accent-text);
            --prose-bold: var(--text);
            font-family: 'Merriweather', serif;
        }

        .theme-emerald-paper, .theme-cyber-blue, .theme-emerald-gold {
            font-family: 'Lato', sans-serif;
        }
        
        body {
            background: var(--bg-gradient);
            color: var(--text);
            min-height: 100vh;
        }

        .ui-bg { background-color: var(--nav-bg); }
        .ui-border { border-color: var(--nav-border); }
        .text-primary { color: var(--text); }
        .text-accent { color: var(--accent-text); }

        .tab-button {
            background-color: var(--nav-bg);
            color: var(--nav-text);
            border-bottom: 3px solid transparent;
        }
        .tab-button:hover, .tab-button:focus-visible {
            background-color: var(--nav-hover-bg);
        }
        .tab-button.tab-active {
            background-color: var(--nav-active-bg);
            color: var(--nav-active-text);
            border-bottom-color: var(--accent-text);
        }

        .settings-button { background-color: var(--nav-hover-bg); }
        .settings-button:hover { opacity: 0.8; }
        *:focus-visible { outline: 3px solid var(--accent-text); outline-offset: 2px; }

        .prose { color: var(--prose-text); }
        .prose h2, .prose h3, .prose a, .prose strong { color: var(--prose-headings); }
        .prose p.lead { color: var(--prose-text); }
    </style>
</head>
<body class="transition-colors duration-300">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <header id="app-header" class="ui-bg border ui-border rounded-lg shadow-lg p-6 mb-6"></header>
        <nav id="app-tabs" class="ui-bg border ui-border rounded-lg shadow-lg mb-6" role="tablist" aria-label="Main navigation"></nav>
        <main id="app-panels" class="ui-bg border ui-border rounded-lg shadow-lg p-6 md:p-8"></main>
        
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="settings-title">
            <div class="ui-bg border ui-border rounded-lg p-6 max-w-md w-full shadow-2xl">
                <h2 id="settings-title" class="text-xl font-bold text-accent mb-4">Display Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="themeSelect" class="block text-primary font-semibold mb-2">Theme</label>
                        <select id="themeSelect" class="w-full px-3 py-2 rounded ui-bg border ui-border text-primary">
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button id="closeSettings" class="px-4 py-2 rounded text-primary hover:opacity-80">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 
    ============================================================
    vvvvvvvvvvvvvv PASTE YOUR JSON CONTENT BELOW vvvvvvvvvvvvvv
    ============================================================
    -->
    <script type="application/json" id="app-data">
{
  "ww2-analysis": {
    "title": "The Wages of Destruction: An Economic History of the Third Reich",
    "description": "A 6-unit analysis based on Adam Tooze's work, exploring the economic constraints, strategic gambles, and material realities that shaped Nazi Germany's rise and fall.",
    "categories": {
      "unit-1-rearmament-constraints": {
        "display_order": 10,
        "name": "Unit 1: Rearmament and Economic Constraints",
        "display_name": "Unit 1",
        "paragraphs": [
          {
            "heading": "The Fragile Foundations of Nazi Ambition",
            "content": "When Hitler came to power in 1933, he promised to restore German strength through rapid rearmament. Yet the Nazi state inherited an economy battered by the Depression, short of raw materials, and dependent on foreign imports for vital supplies like oil and rubber. Tooze shows that rearmament was launched on shaky financial ground, funded by credit schemes and deficit spending rather than sustainable growth. This meant that every step forward deepened Germany’s reliance on conquest to keep the system afloat. The promise of a self-sufficient fortress Germany was never realistic. Instead, the regime was locked into a cycle of expansion to feed its war machine."
          },
          {
            "heading": "The Limits of Autarky",
            "content": "Nazi ideology emphasized autarky—economic self-sufficiency—but geography and resources made this impossible. Germany produced coal and steel in abundance, but it lacked oil, rubber, and key metals like chromium. Efforts to substitute synthetic fuels and ersatz materials were impressive but costly and never enough to meet military needs. By 1939, Germany still depended heavily on imports, many of which came from the very countries it would soon invade. Tooze underscores that the dream of autarky was less a reality than a propaganda claim. In practice, the German economy was a patchwork of shortages, forcing Hitler to see expansion as the only solution."
          },
          {
            "heading": "Rearmament on Credit",
            "content": "The Nazi state financed rearmament through creative but dangerous fiscal maneuvers. Mefo bills, essentially promissory notes guaranteed by the state, allowed armaments firms to be paid without immediate cash. This concealed the growing debt from the public but could not hide the underlying imbalance. The economy was overheated, with inflationary pressures rising and consumer goods scarce. By the late 1930s, rearmament had created impressive armed forces but at the cost of exhausting Germany’s financial reserves. The system could not be sustained indefinitely, which made war not only an ideological goal but an economic necessity."
          },
          {
            "heading": "The Four-Year Plan",
            "content": "In 1936, Hitler unveiled the Four-Year Plan to prepare Germany for war and reduce its reliance on imports. Hermann Göring was put in charge, reflecting Hitler’s belief that only political will could overcome economic limits. The plan pushed synthetic fuel production, expanded armaments, and redirected labor toward military industries. Yet the goals consistently outstripped results. Tooze argues that the Four-Year Plan reveals the contradictions of the regime: it aimed at both preparing for a long war and rushing toward short-term confrontation. The economy was never ready for prolonged conflict, but political urgency demanded rapid mobilization."
          },
          {
            "heading": "Civilian Sacrifices",
            "content": "To fuel rearmament, German civilians bore the cost. Consumer goods were restricted, food was rationed, and living standards stagnated. Nazi propaganda emphasized sacrifice for the national struggle, portraying shortages as patriotic duty. While this was tolerated during the 1930s, it created tensions that would deepen during the war. Tooze emphasizes that the Nazi economy was not the efficient, streamlined machine of myth. It was a system of trade-offs, where civilian needs were constantly squeezed to keep the military supplied. The price of Hitler’s ambition was paid daily in the shops and kitchens of ordinary Germans."
          },
          {
            "heading": "The Illusion of Economic Strength",
            "content": "To outsiders, Nazi Germany looked formidable by the late 1930s, boasting rapid growth and a vast army. Yet Tooze demonstrates that this strength was precarious. The state was juggling debt, managing shortages, and relying on imports even as it boasted of independence. The apparent economic miracle was built on fragile foundations, and German leaders knew it. Hitler’s push for expansion was in part an acknowledgment that the Reich could not survive indefinitely within its borders. War was not simply chosen for ideological reasons—it was driven by material necessity."
          },
          {
            "heading": "Why Economic Limits Mattered",
            "content": "Understanding Germany’s economic constraints is key to understanding why it pursued such aggressive policies. Tooze shows that the decision to rearm at breakneck speed locked the regime into a path where only conquest could resolve its deficits. Each step of the way, from credit schemes to autarky campaigns, deepened the urgency to act before economic weakness became unmanageable. Hitler’s timetable for war was not arbitrary; it was shaped by the realities of what the economy could and could not support. The Nazi state was, in effect, running against the clock."
          },
          {
            "heading": "A War Born of Weakness",
            "content": "Rather than being an unstoppable juggernaut, Nazi Germany was a power gambling on war to solve its economic crisis. This is Tooze’s central insight: the regime’s aggression was born less from strength than from weakness. Hitler launched the most destructive conflict in history while knowing that time was not on Germany’s side. Rearmament without resources created the illusion of power, but it could only be sustained through conquest. The contradiction between ambition and capacity would define the entire course of the war and ultimately lead to Germany’s downfall."
          }
        ]
      },
      "unit-2-expansion-conquest": {
        "display_order": 20,
        "name": "
    </script>
    <!-- 
    ============================================================
    ^^^^^^^^^^^^^^ PASTE YOUR JSON CONTENT ABOVE ^^^^^^^^^^^^^^
    ============================================================
    -->

    <script defer>
    document.addEventListener('DOMContentLoaded', () => {

        const THEMES = {
          'newspaper': { 
            name: 'Newspaper', 
            type: 'classic', 
            isDark: false 
          },
          'emerald-paper': {
            name: 'Emerald Paper', 
            type: 'variable', 
            isDark: false,
            vars: {
              '--bg-gradient': '#f7fbf9', '--text': '#1e2b28', '--accent-text': '#0f7f6d', '--nav-bg': '#e7f3ef',
              '--nav-border': '#86c8ba', '--nav-text': '#1e2b28', '--nav-hover-bg': '#d7ece6', '--nav-active-bg': '#bfe3d9',
              '--nav-active-text': '#1e2b28', '--prose-text': '#1e2b28', '--prose-headings': '#0f7f6d'
            }
          },
          'cyber-blue': {
            name: 'Cyber Night', 
            type: 'variable', 
            isDark: true,
            vars: {
              '--bg-gradient': 'rgb(2, 6, 23)',
              '--text': 'rgb(203, 213, 225)',
              '--accent-text': 'rgb(203, 213, 225)',
              '--nav-bg': 'rgb(30, 41, 59)',
              '--nav-border': 'rgb(51, 65, 85)',
              '--nav-text': 'rgb(203, 213, 225)',
              '--nav-hover-bg': 'rgb(15, 23, 42)',
              '--nav-active-bg': 'rgb(51, 65, 85)',
              '--nav-active-text': '#FFFFFF',
              '--prose-text': 'rgb(203, 213, 225)',
              '--prose-headings': '#FFFFFF'
            }
          },
          'emerald-gold': {
            name: 'Emerald/Gold', 
            type: 'variable', 
            isDark: true,
            vars: {
              '--bg-gradient': 'linear-gradient(135deg,#022c22 0%,#064e3b 60%,#065f46 100%)', '--text': '#ecfdf5',
              '--accent-text': '#f0c475', '--nav-bg': '#064e3b', '--nav-border': '#d4a24c', '--nav-text': '#ecfdf5',
              '--nav-hover-bg': '#065f46', '--nav-active-bg': '#0b3d31', '--nav-active-text': '#f0c475',
              '--prose-text': '#a7f3d0', '--prose-headings': '#f0c475'
            }
          }
        };

        const app = {
            root: document.documentElement,
            header: document.getElementById('app-header'),
            tabs: document.getElementById('app-tabs'),
            panels: document.getElementById('app-panels'),
            settings: {
                modal: document.getElementById('settingsModal'),
                closeBtn: document.getElementById('closeSettings'),
                themeSelect: document.getElementById('themeSelect')
            }
        };

        const state = { activeTab: null, theme: 'newspaper' };

        const loadState = () => {
            state.theme = localStorage.getItem('appTheme') || 'newspaper';
            state.activeTab = localStorage.getItem('activeTab');
        };

        const saveState = () => {
            localStorage.setItem('appTheme', state.theme);
            localStorage.setItem('activeTab', state.activeTab);
        };

        const applyTheme = (themeKey) => {
            const theme = THEMES[themeKey];
            if (!theme) return;

            app.root.className = '';
            app.root.style.cssText = '';

            if (theme.type === 'variable' && theme.vars) {
                for (const [key, value] of Object.entries(theme.vars)) {
                    app.root.style.setProperty(key, value);
                }
                app.root.classList.add(`theme-${themeKey}`);
            }

            state.theme = themeKey;
            if (app.settings.themeSelect.value !== themeKey) {
                app.settings.themeSelect.value = themeKey;
            }
            saveState();
        };

        const populateThemeSelector = () => {
            app.settings.themeSelect.innerHTML = Object.entries(THEMES).map(([key, theme]) => 
                `<option value="${key}">${theme.name}</option>`
            ).join('');
        };

        const loadAndTransformData = () => {
            try {
                const dataNode = document.getElementById('app-data');
                if (!dataNode.textContent.trim()) {
                    console.error("JSON data is empty.");
                    return null;
                }
                const rawData = JSON.parse(dataNode.textContent);
                
                // *** IMPROVEMENT: Automatically find the top-level key ***
                const topLevelKey = Object.keys(rawData)[0];
                if (!topLevelKey) {
                    console.error("JSON data is missing a top-level key.");
                    return null;
                }
                const course = rawData[topLevelKey];
                
                const units = Object.entries(course.categories).map(([id, unitData]) => ({ id, ...unitData }))
                    .sort((a, b) => a.display_order - b.display_order);
                return { meta: { title: course.title, description: course.description }, units };
            } catch (e) {
                console.error("Failed to load or transform app data:", e);
                app.panels.innerHTML = `<div class="p-4 text-red-500 bg-red-100 rounded"><strong>Error:</strong> Could not load content. Please ensure the JSON is correctly formatted and pasted into the data island.</div>`;
                return null;
            }
        };
        
        const data = loadAndTransformData();
        
        // Stop execution if data failed to load
        if (!data) return;

        const renderHeader = () => {
            // Update document title dynamically
            document.title = data.meta.title || "Interactive Course";
            
            app.header.innerHTML = `
                <div class="flex justify-between items-start gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-accent">${data.meta.title}</h1>
                        <p class="mt-2 text-primary/80">${data.meta.description}</p>
                    </div>
                    <button id="settingsBtn" class="flex-shrink-0 p-3 rounded-lg settings-button transition-opacity" aria-label="Display Settings">
                        <span class="text-2xl text-accent">⚙️</span>
                    </button>
                </div>`;
        };
        
        const renderTabs = () => {
            app.tabs.innerHTML = `<div class="flex flex-wrap">${
                data.units.map(unit => `
                    <button role="tab" aria-selected="false" aria-controls="${unit.id}-panel" id="${unit.id}-tab"
                            class="px-5 py-3 font-semibold transition-colors tab-button">
                        ${unit.display_name}
                    </button>`
                ).join('')
            }</div>`;
        };

        const renderPanels = () => {
            app.panels.innerHTML = data.units.map(unit => {
                const introHTML = unit.introduction ? `<p class="lead">${unit.introduction}</p>` : '';
                const paragraphsHTML = (unit.paragraphs || []).map(p => `
                    <h3>${p.heading}</h3>
                    <p>${p.content}</p>
                `).join('');
                const proseClasses = THEMES[state.theme].isDark ? 'prose prose-lg max-w-none prose-invert' : 'prose prose-lg max-w-none';
                return `
                    <div role="tabpanel" id="${unit.id}-panel" aria-labelledby="${unit.id}-tab" hidden>
                        <div class="${proseClasses}">
                            <h2>${unit.name}</h2>
                            ${introHTML}
                            ${paragraphsHTML}
                        </div>
                    </div>`;
            }).join('');
        };

        const switchTab = (tabId) => {
            if (!data.units.some(u => u.id === tabId)) {
                tabId = data.units[0]?.id;
            }
            if (!tabId) return;

            app.tabs.querySelectorAll('[role="tab"]').forEach(tab => {
                const isActive = tab.id === `${tabId}-tab`;
                tab.setAttribute('aria-selected', isActive);
                tab.classList.toggle('tab-active', isActive);
            });

            app.panels.querySelectorAll('[role="tabpanel"]').forEach(panel => {
                panel.hidden = panel.id !== `${tabId}-panel`;
            });
            
            state.activeTab = tabId;
            saveState();
        };

        const setupEventListeners = () => {
            app.tabs.addEventListener('click', e => {
                const tab = e.target.closest('[role="tab"]');
                if (tab) switchTab(tab.id.replace('-tab', ''));
            });

            app.header.addEventListener('click', e => {
                if (e.target.closest('#settingsBtn')) {
                    app.settings.modal.classList.remove('hidden');
                    app.settings.themeSelect.focus();
                }
            });
            
            const closeModal = () => {
                app.settings.modal.classList.add('hidden');
                document.getElementById('settingsBtn')?.focus();
            };
            app.settings.closeBtn.addEventListener('click', closeModal);
            app.settings.modal.addEventListener('keydown', e => {
                if (e.key === 'Escape') closeModal();
            });

            app.settings.themeSelect.addEventListener('change', (e) => {
                applyTheme(e.target.value);
                renderPanels();
                const activePanel = document.getElementById(`${state.activeTab}-panel`);
                if(activePanel) activePanel.hidden = false;
            });
        };

        const init = () => {
            loadState();
            populateThemeSelector();
            applyTheme(state.theme);
            renderHeader();
            renderTabs();
            renderPanels();
            setupEventListeners();
            switchTab(state.activeTab || data.units[0]?.id);
        };

        init();
    });
    </script>
</body>
</html>

