<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Adaptive Reader</title>

  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>

  <script src="https://www.blueletterbible.org/scripts/blbToolTip/BLB_ScriptTagger-min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
    /* Typography */
    .font-newspaper{font-family:'Lora',serif}
    .font-dark-theme{font-family:'Lora',serif}
    body{transition:background-color .3s,color .3s}
    .prose h1{min-height:7.5rem}

    /* Light */
    .newspaper-theme{background:#fdfdfd;color:#1a1a1a}
    .newspaper-theme .nav-button{background:#f8f9fa;border:1px solid #dee2e6;color:#212529}
    .newspaper-theme .nav-button:hover{background:#e9ecef}
    .newspaper-theme .nav-button.active{background:#1a1a1a;color:#fdfdfd}

    /* Dark */
    .dark-theme{background:#2d2d30;color:#fff}
    .dark-theme .nav-button{background:#3c3c3c;border:1px solid #4a4a4a;color:#ccc}
    .dark-theme .nav-button:hover{background:#4a4a4a}
    .dark-theme .nav-button.active{background:#fff;color:#2d2d30}

    /* Shared */
    .nav-container{margin-bottom:2rem}
    .nav-button{padding:.5rem 1rem;margin:.5rem .5rem .5rem 0;border-radius:.375rem;transition:all .2s;cursor:pointer}
    #library-switcher,#topic-switcher{padding:.5rem;border-radius:.375rem;margin-bottom:1rem;width:100%;border:1px solid #ccc}
    .nav-buttons-wrapper{display:flex;flex-wrap:wrap;align-items:center;width:100%}
    .flex-break{flex-basis:100%;height:0}
  </style>
</head>
<body class="font-newspaper newspaper-theme">  
  <script id="embedded-content" type="application/json">
{
    "golden-age-of-piracy": {
        "display_order": 10,
        "title": "The Golden Age of Piracy: Myth and Reality",
        "description": "An exploration of the brief, violent, and surprisingly democratic world of pirates in the Caribbean during the early 18th century, separating Hollywood fiction from the historical record.",
        "categories": {
            "republic-of-nassau": {
                "display_order": 10,
                "name": "The Pirate Republic of Nassau",
                "display_name": "Republic of Nassau",
                "introduction": "For a few short years, the neglected British port of Nassau on the island of New Providence became the heart of a lawless pirate stronghold, a place where the outcasts of the world could find freedom and fortune.",
                "paragraphs": [
                    {
                        "heading": "An Ideal Location",
                        "content": "Nassau was perfectly situated for piracy. Its harbor was too shallow for the massive warships of the Royal Navy, but deep enough for the pirates' fast, nimble sloops. Located astride the busy shipping lanes, it provided an ideal base from which to strike at the treasure-laden Spanish galleons and merchant vessels crisscrossing the Caribbean. After being abandoned by the British during the War of Spanish Succession, the port fell into lawlessness, creating a power vacuum that pirates were all too eager to fill."
                    },
                    {
                        "heading": "The 'Flying Gang'",
                        "content": "The pirate settlement was established around 1713 by a group of captains known as the <strong>'Flying Gang,'</strong> including Benjamin Hornigold, Henry Jennings, and 'Black Sam' Bellamy. They declared Nassau a 'Pirate Republic,' free from the laws of any nation. Word spread quickly through the ports of the Americas and Europe, and soon hundreds, then thousands, of pirates, smugglers, and disreputable merchants flocked to the island, turning the ramshackle port into a bustling, boisterous pirate den."
                    },
                    {
                        "heading": "A Lawless Paradise",
                        "content": "Life in Nassau was a constant party, fueled by stolen rum and treasure. For the common sailor, it was a world turned upside down. On naval or merchant ships, they faced brutal discipline, poor pay, and terrible conditions. In Nassau, they were free men. They could vote for their captains, receive a fair share of the plunder, and live without fear of the whip. This democratic spirit was the true treasure of the Pirate Republic, offering a form of social and economic freedom unimaginable in the 'civilized' world."
                    }
                ]
            },
            "life-at-sea": {
                "display_order": 20,
                "name": "Life Aboard a Pirate Ship: The Code and the Crew",
                "display_name": "Life at Sea",
                "introduction": "The romantic image of a pirate's life clashes sharply with the harsh reality. While it offered more freedom than naval service, life at sea was a mixture of democratic principles, brutal violence, and the constant threat of death.",
                "paragraphs": [
                    {
                        "heading": "The Pirate Code",
                        "content": "Before any voyage, a crew would draw up their own set of rules, known as the <strong>Articles of Agreement</strong> or the Pirate Code. Every man had to sign or make his mark on the articles. This code established rules for discipline, the division of plunder, and compensation for injuries—a lost arm or eye would merit a larger share of the treasure. The captain was elected and could be removed by a majority vote. While he had absolute authority during battle, at all other times, the ship was run by the Quartermaster, who represented the crew's interests."
                    },
                    {
                        "heading": "A Motley Crew",
                        "content": "A pirate ship was one of the most multicultural places on Earth in the 18th century. Crews were made up of sailors from across Europe, the Americas, and Africa. Many were former Royal Navy sailors who had deserted, escaped indentured servants, or liberated slaves. For escaped slaves, piracy was one of the only avenues to a life of freedom and equality. On a pirate ship, a man was judged by his skills and courage, not the color of his skin or his country of origin."
                    },
                    {
                        "heading": "The Jolly Roger",
                        "content": "The infamous skull and crossbones flag, the <strong>Jolly Roger</strong>, was a tool of psychological warfare. Its purpose was not just to inspire fear, but to send a clear message. When the black flag was raised, it meant that if the target ship surrendered without a fight, the crew would be shown mercy, or 'quarter.' However, if the pirates were forced to raise the red flag, it signaled 'no quarter'—no mercy would be given, and everyone aboard the captured vessel would be killed. This system encouraged most merchant ships to surrender immediately, saving the pirates from a costly and dangerous fight."
                    }
                ]
            },
            "legendary-captains": {
                "display_order": 30,
                "name": "Legendary Captains: Blackbeard and 'Calico Jack'",
                "display_name": "Legendary Captains",
                "introduction": "The Golden Age produced dozens of infamous captains, but none captured the public imagination like the terrifying Blackbeard and the flamboyant 'Calico Jack' Rackham.",
                "paragraphs": [
                    {
                        "heading": "Edward Teach, 'Blackbeard'",
                        "content": "The most feared pirate of his day was Edward Teach, better known as <strong>Blackbeard</strong>. He cultivated a demonic image, weaving hemp fuses into his long black beard and lighting them during battle to surround his head in a cloud of smoke. His reputation for cruelty was his greatest weapon, though historical records show he preferred intimidation over violence and often treated his captives well. His flagship, the <strong>Queen Anne's Revenge</strong>, was one of the most powerful pirate vessels of its time. Blackbeard's reign of terror culminated in a week-long blockade of Charleston, South Carolina, where he held the entire city ransom."
                    },
                    {
                        "heading": "John 'Calico Jack' Rackham",
                        "content": "<strong>'Calico Jack' Rackham</strong> was more famous for his style than his success. He earned his nickname from his taste for brightly colored calico clothing. While not a particularly skilled or successful pirate, his story became legendary for two reasons. First, he created one of the most famous Jolly Roger designs: a skull with two crossed cutlasses. Second, and more importantly, his crew included the two most famous female pirates in history: Anne Bonny and Mary Read."
                    },
                    {
                        "heading": "Capture and Fate",
                        "content": "Both captains met violent ends. Blackbeard was killed in a bloody, close-quarters battle with Lieutenant Robert Maynard of the Royal Navy off the coast of North Carolina in 1718. His head was severed and hung from the bowsprit of Maynard's sloop. Calico Jack's end was less dramatic; his crew was captured in a drunken stupor by pirate hunters in 1720. He was tried and hanged in Jamaica, his body tarred and displayed in a cage at the entrance to the harbor as a warning to other pirates."
                    }
                ]
            },
            "women-of-piracy": {
                "display_order": 40,
                "name": "The Fierce Women of Piracy: Anne Bonny & Mary Read",
                "display_name": "Women Pirates",
                "introduction": "In a world dominated by men, two women carved out their own legends as pirates, proving they could be as ruthless, skilled, and courageous as any man on the sea.",
                "paragraphs": [
                    {
                        "heading": "Anne Bonny: The Rebel",
                        "content": "<strong>Anne Bonny</strong> was the Irish-born illegitimate daughter of a wealthy lawyer. Known for her fiery temper, she eloped with a small-time sailor to escape an arranged marriage and ended up in the pirate haven of Nassau. There, she left her husband and fell in with 'Calico Jack' Rackham, becoming his lover and a member of his crew. She did not disguise herself as a man but fought openly alongside the crew, earning their respect as a capable and dangerous pirate."
                    },
                    {
                        "heading": "Mary Read: The Soldier",
                        "content": "<strong>Mary Read</strong> had a very different path. Raised as a boy by her mother to secure an inheritance, she spent years living as a man, even serving in the British Army. Her ship was captured by pirates, and she was forced to join them. She kept her identity a secret until she met Anne Bonny aboard Calico Jack's ship. According to legend, the two became close friends, and Mary's identity was revealed to the rest of the crew. She too proved to be an excellent fighter."
                    },
                    {
                        "heading": "Capture and Trial",
                        "content": "When Calico Jack's ship was captured, only Anne Bonny, Mary Read, and one other man were reportedly sober enough to put up a fight. At their trial, the entire crew was sentenced to hang. However, both women revealed they were pregnant, a tactic known as <strong>'pleading the belly,'</strong> which delayed their executions. Mary Read died in prison from a fever shortly after the trial. Anne Bonny's fate is a mystery; there is no record of her execution or release, and some stories claim her wealthy father ransomed her. Her last recorded words were to a captive Calico Jack: 'Had you fought like a man, you need not have been hang'd like a dog.'"
                    }
                ]
            },
            "war-on-piracy": {
                "display_order": 50,
                "name": "The War on Piracy: The Fall of an Era",
                "display_name": "The War on Piracy",
                "introduction": "The Golden Age of Piracy was a brief but spectacular explosion of lawlessness. Within a decade, the great European powers, tired of the disruptions to their colonial trade, would bring the full force of their naval might to bear, extinguishing the Pirate Republic for good.",
                "paragraphs": [
                    {
                        "heading": "The King's Pardon",
                        "content": "By 1717, piracy was crippling trade in the West Indies. In response, King George I issued a proclamation: any pirate who surrendered to a British governor by September 1718 would receive a full pardon for all crimes. This was a brilliant move, designed to divide the pirate crews. Many, including Benjamin Hornigold, accepted the pardon. The hard-liners, like Charles Vane and Blackbeard, refused, but the offer sowed dissent and weakened the pirates' unity."
                    },
                    {
                        "heading": "Woodes Rogers: Scourge of Pirates",
                        "content": "The man tasked with delivering the pardons and destroying those who refused was Captain <strong>Woodes Rogers</strong>, a famed privateer himself. He was appointed Governor of the Bahamas and arrived in Nassau in 1718 with a small fleet. He offered the pardon, blockaded the harbor, and began hunting down those who resisted. Rogers's combination of legal authority and intimate knowledge of pirate tactics was devastatingly effective. He famously adopted the motto <strong>'Expulsis Piratis, Restituta Commercia'</strong> (Pirates Expelled, Commerce Restored), which remains the motto of the Bahamas to this day."
                    },
                    {
                        "heading": "The End of the Golden Age",
                        "content": "Between 1718 and 1726, the war on piracy was relentless. Captains were hunted down, crews were killed or captured, and public executions became common spectacles in ports like Jamaica and Virginia. The capture and execution of major figures like Blackbeard, Stede Bonnet, and Calico Jack sent a clear message. With their main base in Nassau gone and the Royal Navy patrolling the seas, the pirates' power was broken. By 1730, the Golden Age was over, a brief, fiery chapter in maritime history brought to a decisive close."
                    }
                ]
            }
        }
    }
}
  </script>

  <div class="fixed top-4 right-4 z-50">
    <button id="theme-switcher-btn" class="p-2 rounded-full" aria-label="toggle theme">
      <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 100-10 5 5 0 000 10z"/></svg>
      <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
    </button>
  </div>

  <main id="app-container" class="prose dark:prose-invert mx-auto max-w-prose p-8"></main>

  <script>
    /* ---------- state ---------- */
    let masterLibrary=null,sortedLibraryIds=null,currentLibraryId=null
    let libraryData=null,sortedTopicIds=null,currentTopicId=null,currentArticleId=null
    const app=document.getElementById('app-container')

    /* ---------- helpers ---------- */
    const looksLikeTopic=o=>o&&typeof o==='object'&&('categories'in o||'title'in o)

    /* ---------- rendering ---------- */
    const buildLibrarySwitch=()=>!sortedLibraryIds||sortedLibraryIds.length<2?'':`
      <div class="nav-container">
        <select id="library-switcher" class="nav-button">
          ${sortedLibraryIds.map(id=>{
            const label=id.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase())
            return `<option value="${id}" ${id===currentLibraryId?'selected':''}>${label}</option>`
          }).join('')}
        </select>
      </div>`

    const buildTopicSwitch=()=>`
      <div class="nav-container">
        <select id="topic-switcher" class="nav-button">
          ${sortedTopicIds.map(tid=>{
            const t=libraryData[tid];return `<option value="${tid}" ${tid===currentTopicId?'selected':''}>${t.title}</option>`
          }).join('')}
        </select>
      </div>`

    const buildNav=(cats,keys)=>{
      let html='<div class="nav-container"><h3>Select Article:</h3><div class="nav-buttons-wrapper">'
      keys.forEach(k=>{
        const a=cats[k]
        html+=`<button class="nav-button article-btn ${k===currentArticleId?'active':''}" data-article-id="${k}">${a.display_name}</button>`
        if(a.breakAfter)html+='<div class="flex-break"></div>'
      })
      return html+'</div></div>'
    }

    function render(){
      if(!libraryData)return
      const firstKey = Object.keys(libraryData)[0];
      const rootData = libraryData[firstKey];

      document.title = rootData.title || 'Adaptive Reader';
      
      sortedTopicIds = Object.keys(rootData.categories || {}).sort((a, b) => (rootData.categories[a].display_order || 0) - (rootData.categories[b].display_order || 0));

      if(!currentTopicId || !rootData.categories[currentTopicId]) {
          currentTopicId = sortedTopicIds[0];
      }
      const topic = rootData.categories[currentTopicId];
      if (!topic) {
        app.innerHTML = '<h1>Error</h1><p>Content could not be loaded.</p>';
        return;
      }

      const artKeys = Object.keys(topic.paragraphs||{}).map((p, i) => `p${i}`); // Compatibility fix if paragraphs don't have IDs
      
      app.innerHTML = `<h1>${rootData.title}</h1>` +
        buildNav(rootData.categories, sortedTopicIds) + // Use sortedTopicIds for the nav buttons
        `<h2>${topic.name||topic.display_name||''}</h2>` +
        `${topic.introduction?`<p>${topic.introduction}</p>`:''}` +
        (topic.paragraphs||[]).map(p => `<h3>${p.heading}</h3><p>${p.content}</p>`).join('');

      document.querySelectorAll('.nav-button[data-article-id]').forEach(btn => {
        // Clear existing active states
        btn.classList.remove('active');
        // Add active state to the current topic button
        if (btn.dataset.articleId === currentTopicId) {
            btn.classList.add('active');
        }
        btn.onclick = e => {
            currentTopicId = e.target.dataset.articleId;
            render();
        };
      });
    }


    /* ---------- data load ---------- */
    async function init(){
      let raw=null
      try{
        // This part is simplified as we are only using embedded data
        const embedded=document.getElementById('embedded-content').textContent.trim()
        if(!embedded)throw new Error('no data');raw=JSON.parse(embedded)
      } catch(err) {
        console.error("Failed to load or parse data:", err);
        app.innerHTML='<h1>Error</h1><p>Could not load content.</p>';
        return;
      }

      // Assuming the structure is always { "topic-key": { ... } }
      libraryData = raw;
      const rootKey = Object.keys(libraryData)[0];
      if (!rootKey || !libraryData[rootKey].categories) {
          throw new Error('Invalid data structure');
      }

      const categoryKeys = Object.keys(libraryData[rootKey].categories);
      sortedTopicIds = categoryKeys.sort((a,b) => (libraryData[rootKey].categories[a].display_order || 0) - (libraryData[rootKey].categories[b].display_order || 0));
      currentTopicId = sortedTopicIds[0]; // Set initial topic
      
      render()
    }

    /* ---------- theme ---------- */
    const themeBtn=document.getElementById('theme-switcher-btn')
    function applyTheme(t){
      const dark=t==='dark'
      document.documentElement.classList.toggle('dark',dark)
      document.body.classList.toggle('dark-theme',dark)
      document.body.classList.toggle('font-dark-theme',dark)
      document.body.classList.toggle('newspaper-theme',!dark)
      document.body.classList.toggle('font-newspaper',!dark)
      document.getElementById('sun-icon').classList.toggle('hidden',dark)
      document.getElementById('moon-icon').classList.toggle('hidden',!dark)
    }
    themeBtn.onclick=()=>{const t=document.documentElement.classList.contains('dark')?'light':'dark';localStorage.setItem('theme',t);applyTheme(t)}

    /* ---------- boot ---------- */
    document.addEventListener('DOMContentLoaded',()=>{
      applyTheme(localStorage.getItem('theme')||'light')
      init().catch(err=>{console.error(err);app.innerHTML='<h1>Error</h1><p>Could not load content.</p>'})
    })
  </script>
</body>
</html>
