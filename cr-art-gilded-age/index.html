<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Casebook of Collective Intelligence</title>

  <!-- Prepaint bootstrap: set dark + theme class before paint to avoid flicker -->
  <script>
  (function () {
    const root = document.documentElement;
    try {
      const savedTheme = localStorage.getItem('theme');       // 'light' | 'dark' | null
      const savedColor = localStorage.getItem('colorScheme'); // 'slate' | 'emerald' | future
      const isDark = savedTheme !== 'light';                  // default to dark if unset
      root.classList.toggle('dark', isDark);
      // Apply colored theme classes ONLY in dark mode; light is always neutral slate
      root.classList.toggle('theme-emerald', isDark && savedColor === 'emerald');
    } catch (_) {}
  })();
  </script>

  <!-- Tailwind (with Typography) -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- Google Font (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <style>
  :root { color-scheme: light dark; }
  html { scroll-behavior: smooth; }
  .font-newspaper { font-family: 'Lora', serif; }
  :where(h2,h3,h4){ scroll-margin-top: 84px; }
  mark { background: #fde68a; padding: .1em .2em; border-radius: .2rem; }
  @media (max-width: 380px){ .prose { font-size: .96rem; } }

  /* ---------- Semantic surfaces (read from CSS variables) ---------- */
.hero {
  /* give the header an explicit base fill so gradient blends to the right hue */
  background-color: var(--hero-base);
  background:
    radial-gradient(50% 120% at 10% 10%, var(--hero-r1), transparent 60%),
    radial-gradient(80% 140% at 90% 10%, var(--hero-r2), transparent 70%),
    linear-gradient(180deg, var(--hero-wash), transparent 35%);
}
.border-var { border-color: var(--border) !important; }
.surface { border-width: 1px; border-style: solid; border-color: var(--border); }
.hr-var { border-color: var(--border); }
.subtitle { color: var(--subtitle-fg); }
.timeline-fg { color: var(--timeline-fg); }
.footer-note { color: var(--footer-fg); }
.active-link { color: var(--active); font-weight: 700; }

.input-surface {
  border: 1px solid var(--input-border);
  background-color: var(--input-bg);
}
.btn-surface { border: 1px solid var(--btn-border); }
.btn-surface:hover { background: var(--btn-hover-bg); }
.toc-link:hover { background: var(--hover-bg); }

/* ---------- Slate (default) variables ---------- */
:root{
  /* accents / inks */
  --active: rgb(59,130,246);                      /* sky-500 */
  --subtitle-fg: rgb(71,85,105);                  /* slate-600 */
  --timeline-fg: rgb(100,116,139);                /* slate-500 */
  --footer-fg: rgb(100,116,139);                  /* slate-500 */

  /* surfaces */
  --border: rgb(226,232,240);                     /* slate-200 */
  --hover-bg: rgb(248,250,252);                   /* slate-50 */
  --btn-border: rgb(203,213,225);                 /* slate-300 */
  --btn-hover-bg: rgb(248,250,252);               /* slate-50 */
  --input-border: rgba(203,213,225,0.7);          /* slate-300/70 */
  --input-bg: rgba(255,255,255,0.7);              /* white/70 */

  /* hero base & gradient (light) */
  --hero-base: transparent;                       /* keep light header airy */
  --hero-r1: rgba(49,46,129,.12);                 /* indigo-700 */
  --hero-r2: rgba(234,88,12,.12);                 /* orange-600 hint */
  --hero-wash: rgba(14,165,233,.08);              /* sky-500 wash */
}
.dark{
  --subtitle-fg: rgb(203,213,225);                /* slate-300 */
  --timeline-fg: rgb(148,163,184);                /* slate-400 */
  --footer-fg: rgb(148,163,184);                  /* slate-400 */

  --border: rgb(30,41,59);                        /* slate-800 */
  --hover-bg: rgb(15,23,42);                      /* slate-900 */
  --btn-border: rgb(51,65,85);                    /* slate-700 */
  --btn-hover-bg: rgb(15,23,42);                  /* slate-900 */
  --input-border: rgba(51,65,85,0.7);             /* slate-700/70 */
  --input-bg: rgba(2,6,23,0.6);                   /* slate-950/60 */

  /* hero base & gradient (dark) */
  --hero-base: rgb(2,6,23);                       /* slate-950 */
  --hero-r1: rgba(49,46,129,.12);
  --hero-r2: rgba(234,88,12,.12);
  --hero-wash: rgba(14,165,233,.08);
}

/* ---------- Emerald theme overrides (light & dark) ---------- */
.theme-emerald{
  --active: #10b981;                              /* emerald-500 */

  --border: rgb(187,247,208);                     /* emerald-200 */
  --hover-bg: rgb(240,253,244);                   /* emerald-50 */
  --btn-border: rgb(187,247,208);                 /* emerald-200 */
  --btn-hover-bg: rgb(240,253,244);               /* emerald-50 */
  --input-border: rgba(110,231,183,0.7);          /* emerald-300/70 */
  --input-bg: rgba(255,255,255,0.7);              /* white/70 */

  /* keep subtitles/timeline neutral for readability over hero */
  --subtitle-fg: rgb(71,85,105);                  /* slate-600 */
  --timeline-fg: rgb(71,85,105);                  /* slate-600 */
  --footer-fg: rgb(16,185,129);                   /* emerald-500 */

  /* hero base & gradient (emerald light) */
  --hero-base: transparent;
  --hero-r1: rgba(16,185,129,.14);                /* emerald-500 */
  --hero-r2: rgba(163,230,53,.12);                /* lime-400 */
  --hero-wash: rgba(5,150,105,.10);               /* emerald-600 wash */
}
.dark.theme-emerald{
  /* ↑ Give borders enough contrast on dark emerald surfaces */
  --border: rgba(110,231,183,0.55);                /* emerald-300 @ 55% */
  --hover-bg: rgb(6,78,59);                        /* emerald-900 */
  --btn-border: rgba(110,231,183,0.45);            /* slightly softer than borders */
  --btn-hover-bg: rgb(6,78,59);                    /* emerald-900 */
  --input-border: rgba(110,231,183,0.55);          /* match border contrast */
  --input-bg: rgba(6,95,70,0.60);                  /* emerald-900/60 */

  /* text accents for readability */
  --footer-fg: rgb(110,231,183);                   /* emerald-300/400 */
  --subtitle-fg: rgb(226,252,236);                 /* emerald-100 */
  --timeline-fg: rgb(187,247,208);                 /* emerald-200 */

  /* hero base & gradient (unchanged, stays emerald) */
  --hero-base: rgb(2,44,34);                       /* emerald-950 (#022c22) */
  --hero-r1: rgba(16,185,129,.14);
  --hero-r2: rgba(163,230,53,.12);
  --hero-wash: rgba(5,150,105,.10);
}

/* ===== Mobile FAB quick settings ===== */
#fabPanel.show { display:block; animation: fadeUp .14s ease-out; }
@keyframes fadeUp { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)} }
  </style>

</head>

<body class="bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]">

  <!-- Header -->
  <header id="top" class="hero border-b border-var">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between gap-4">
      <div>
        <h1 id="docTitle" class="text-2xl sm:text-3xl font-bold font-newspaper tracking-tight">Loading...</h1>
        <p id="docSubtitle" class="subtitle text-sm sm:text-base"></p>
      </div>
      <div class="flex items-center gap-2">
        <label for="search" class="sr-only">Search</label>
        <input id="search" type="search" placeholder="Search…" class="hidden md:block w-56 rounded-xl input-surface px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400" />
        <button id="clearSearch" type="button" class="hidden md:inline-flex text-xs px-2 py-2 rounded-lg btn-surface">Clear</button>

        <!-- Header controls: hidden on small screens -->
        <button id="colorSchemeToggle" type="button" class="hidden sm:inline-flex items-center justify-center rounded-xl btn-surface px-3 py-2 text-sm" title="Change color scheme">
          <span class="inline md:hidden">Colors</span>
          <svg aria-hidden="true" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/>
            <circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/>
            <circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/>
            <circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/>
            <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 7.012 17.461 2 12 2z"/>
          </svg>
        </button>
        <button id="themeToggle" type="button" class="hidden sm:inline-flex items-center justify-center rounded-xl btn-surface px-3 py-2 text-sm" title="Toggle dark mode" aria-pressed="false">
          <span class="inline md:hidden">Theme</span>
          <svg aria-hidden="true" class="w-5 h-5 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg aria-hidden="true" class="w-5 h-5 dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </button>
      </div>
    </div>

    <!-- Timeline -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6" id="timelineWrap" hidden>
      <nav aria-label="Journey timeline" id="timelineNav" class="timeline-fg">
        <ol id="timeline" class="grid grid-cols-3 sm:grid-cols-6 items-center gap-x-2 gap-y-1 text-[11px] sm:text-sm"></ol>
        <div id="timelineCoda" class="mt-2 text-[11px] sm:text-xs"></div>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-[260px_minmax(0,1fr)] gap-8">
    <!-- Sidebar -->
    <aside class="lg:sticky lg:top-4 h-max">
      <nav aria-label="On this page" class="rounded-2xl surface p-4">
        <h2 class="text-sm font-semibold mb-2">Sections</h2>
        <ol id="toc" class="space-y-1 text-sm"></ol>
        <hr class="my-4 hr-var" />
        <button id="expandAll" type="button" class="w-full text-xs px-3 py-2 rounded-lg btn-surface">Expand All</button>
        <button id="collapseAll" type="button" class="mt-2 w-full text-xs px-3 py-2 rounded-lg btn-surface">Collapse All</button>
      </nav>
    </aside>

    <section id="content" class="prose prose-slate dark:prose-invert max-w-none">
      <!-- Content is generated by script from JSON -->
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 text-xs footer-note">
    Threaded Reader — a single-file template
  </footer>

  <!-- Mobile quick settings FAB + Panel -->
  <button id="fab" class="fixed z-40 top-4 right-4 sm:hidden rounded-full shadow-lg px-4 py-3 text-sm btn-surface backdrop-blur">
    ⚙️
  </button>
  <div id="fabPanel" class="bg-white dark:bg-slate-800 sm:hidden fixed z-40 top-20 right-4 w-56 rounded-xl surface p-3 hidden">
    <div class="text-xs mb-2 opacity-80">Quick settings</div>
    <button id="fabTheme" class="w-full text-sm px-3 py-2 rounded-lg btn-surface mb-2">Toggle Theme</button>
    <button id="fabColor" class="w-full text-sm px-3 py-2 rounded-lg btn-surface">Cycle Colors</button>
  </div>

  <script id="embedded-json" type="application/json">
    {
      "title": "The Casebook of Collective Intelligence",
      "description": "Deep-dive analyses of real-world events, showing the principles of collective intelligence (and its failures) in action.",
      "articles": [
        {
          "title": "The Search for the USS Scorpion",
          "introduction": "In 1968, the nuclear submarine USS Scorpion vanished in the Atlantic. After conventional search methods failed, a maverick Navy officer named John Craven used a radical technique—aggregating the independent guesses of a diverse group of experts—to pinpoint the wreck in a stunning demonstration of the wisdom of crowds.",
          "threads": [
            {
              "title": "The Enormous Haystack",
              "content": "<p>When the USS Scorpion failed to return to port, the U.S. Navy faced a terrifying problem. The submarine could be anywhere within a massive 20-mile-wide search area. Traditional 'search theory' was failing, yielding no results. The pressure was immense, as the wreck could provide vital clues about the disaster and the Soviets were also likely searching for the advanced technology.</p>"
            },
            {
              "title": "Enter John Craven",
              "content": "<p>Dr. John Craven, the Chief Scientist of the Navy's Special Projects Office, was tasked with finding the Scorpion. Recognizing the limits of formal search algorithms with so little data, he decided to turn to a different source of information: the collective intuition of a wide range of experts. He believed that even if no single person had the right answer, their combined knowledge might contain a hidden signal.</p>"
            },
            {
              "title": "The Bayesian Method",
              "content": "<p>Craven employed a technique based on Bayes's theorem, a statistical method for updating probabilities as new evidence becomes available. He decided to treat the hunches and educated guesses of his experts as valuable data points. He assembled a diverse team: submarine specialists, salvage experts, mathematicians, and deep-sea acousticians. He didn't ask them to agree; he asked each one for their individual best guess on what happened and where the wreck might lie, along with a confidence level.</p>"
            },
            {
              "title": "Plotting the Probabilities",
              "content": "<p>Craven secretly collected each expert's scenario and location guess. He then created a grid over the search area and, using their individual inputs, calculated a collective probability for each square on the grid. The process created a 'probability map' of the ocean floor, with one specific location emerging as the 'hottest' spot—the point of highest aggregate probability, even though no single expert had chosen that exact location.</p>"
            },
            {
              "title": "The Discovery",
              "content": "<p>Craven directed the search ship, the USNS Mizar, to this point of highest collective probability. On October 29, 1968, five months after it disappeared, the Mizar photographed the wreckage of the Scorpion. It was found resting on the seabed more than 10,000 feet deep, astonishingly just 220 yards from where Craven's 'crowd' of experts had predicted it would be.</p>"
            },
            {
              "title": "Wisdom in Action",
              "content": "<p>The search for the Scorpion is a perfect case study of collective intelligence principles. Craven assembled a <mark>diverse</mark> group, ensuring a wide range of knowledge. He enforced <mark>independence</mark> by having them submit their guesses secretly. Finally, he used a sophisticated Bayesian method for <mark>aggregation</mark>. The result was not a compromise, but a new piece of information—a location more accurate than any single member of the group could produce alone.</p>"
            }
          ]
        },
        {
          "title": "The Challenger Disaster",
          "introduction": "The tragic explosion of the Space Shuttle Challenger on January 28, 1986, is a harrowing case study in the failure of collective intelligence. Despite clear warnings from a wise minority of engineers, a hierarchical and schedule-driven culture created intense pressure for consensus, silencing dissent and leading to a catastrophic decision.",
          "threads": [
            {
              "title": "The Technical Flaw: O-Rings and Cold",
              "content": "<p>The technical cause of the disaster was the failure of rubber O-rings in the solid rocket boosters. These seals were not designed to operate in the unusually cold temperatures present on launch day in Florida. The cold made the rubber less resilient, preventing it from properly sealing a joint. Hot gas leaked through the gap, leading to the catastrophic structural failure of the external fuel tank and the orbiter's destruction.</p>"
            },
            {
              "title": "The Engineers' Warning",
              "content": "<p>The night before the launch, engineers at Morton Thiokol, the contractor for the rocket boosters, were alarmed by the cold forecast. Led by engineer Roger Boisjoly, they held a teleconference with NASA officials, presenting data that showed O-ring performance was compromised by cold. They argued passionately and unanimously that the launch was unsafe and should be postponed. Their expert judgment was clear: do not launch.</p>"
            },
            {
              "title": "Groupthink and Pressure for Conformity",
              "content": "<p>The NASA officials, under immense pressure to maintain the launch schedule, were unreceptive. The culture at NASA at the time exhibited classic symptoms of groupthink. There was an <mark>illusion of invulnerability</mark> (a belief that NASA's successes made them immune to failure) and direct <mark>pressure on dissenters</mark>. A NASA manager famously exclaimed his dismay that Thiokol was trying to establish a new launch criterion 'the night before a launch.' The Thiokol managers were told to take off their 'engineering hats' and put on their 'management hats'—a clear demand to prioritize business concerns over technical safety.</p>"
            },
            {
              "title": "The Flawed Aggregation",
              "content": "<p>The crucial failure occurred in how the decision was aggregated. Instead of the engineers needing to prove the launch was safe, the burden of proof was reversed: NASA officials demanded that the engineers prove it was <mark>100% unsafe</mark>. This is an impossible standard. Unable to provide absolute proof of failure, the Thiokol managers were pressured into overriding their own engineers and approving the launch. The clear signal from the knowledgeable minority was ignored in favor of a management-driven consensus.</p>"
            },
            {
              "title": "The Feynman Demonstration",
              "content": "<p>During the subsequent presidential commission investigating the disaster, physicist Richard Feynman famously demonstrated the O-ring problem in a televised hearing. He simply clamped a piece of the O-ring material and submerged it in a glass of ice water. When he removed it, it was no longer resilient, providing a simple, dramatic, and undeniable explanation of the technical failure that the management culture had refused to heed.</p>"
            },
            {
              "title": "Lessons in Silence",
              "content": "<p>The Challenger disaster is a powerful lesson in how organizational structure and culture can destroy collective intelligence. A wise crowd needs mechanisms to protect and amplify dissenting and minority opinions, especially when they come from those with the most direct, local knowledge. Without psychological safety, a hierarchy can easily produce a 'madness of the managers,' silencing the wisdom of the crowd below.</p>"
            }
          ]
        },
        {
          "title": "The Goldcorp Challenge",
          "introduction": "In 2000, the mining company Goldcorp was struggling. Its Red Lake Mine in Ontario was underperforming, and its own geologists couldn't find new gold deposits. In a move of desperation and genius, CEO Rob McEwen decided to bet the company's future on the wisdom of a global crowd.",
          "threads": [
            {
              "title": "A Company in Crisis",
              "content": "<p>Goldcorp was in a bind. The company's stock price was stagnant, and its own team of highly paid, expert geologists had run out of ideas for where to drill next at the Red Lake property. The traditional, top-down model of expertise had failed them. The company needed a new perspective, but it was unclear where to find it.</p>"
            },
            {
              "title": "The Linux Inspiration",
              "content": "<p>At a technology conference, CEO Rob McEwen heard about the success of the open-source software Linux, which was built and improved by a global, volunteer community. He was struck by the idea that a decentralized crowd could create something so complex and valuable. This sparked a radical thought: what if the same principle could be applied to geology?</p>"
            },
            {
              "title": "The Radical Idea",
              "content": "<p>McEwen proposed something unheard of in the secretive mining industry. He decided to take all of Goldcorp's proprietary geological data—decades of maps, surveys, and drilling results—and post it online for the entire world to see. He then launched the 'Goldcorp Challenge,' offering a total of $575,000 in prize money to anyone who could analyze the data and tell him where to find the next six million ounces of gold.</p>"
            },
            {
              "title": "Internal Resistance",
              "content": "<p>The idea was met with shock and fierce resistance from his own team. His geologists felt it was a betrayal, akin to giving away the company's 'crown jewels' for free. They believed their specialized knowledge was the company's primary asset. The board was skeptical, but McEwen's conviction and the company's dire situation pushed the plan forward.</p>"
            },
            {
              "title": "The Global Response",
              "content": "<p>The challenge went viral. Submissions poured in from over 1,400 individuals and teams in 50 countries. The participants were a <mark>highly diverse crowd</mark>: geologists, computer scientists, mathematicians, students, and military officers. They applied techniques the Goldcorp experts had never considered, from advanced computer graphics to complex mathematical modeling.</p>"
            },
            {
              "title": "The Results",
              "content": "<p>The outcome was a spectacular success. The global crowd identified 110 targets on the property, 50% of which were previously unknown to the company. Over 80% of these new targets yielded significant gold deposits. The challenge led to the discovery of over 8 million ounces of gold, turning Goldcorp from a struggling junior miner into a multi-billion dollar powerhouse. The $575,000 prize had generated billions in value.</p>"
            },
            {
              "title": "Decentralized Wisdom",
              "content": "<p>The Goldcorp Challenge is a landmark case study in the power of <mark>decentralization</mark> and cognitive diversity. It proved that for a complex cognition problem, a large, diverse, and well-incentivized crowd could dramatically outperform a small, homogenous group of internal experts. Goldcorp's success showed that in the information age, a company's most valuable asset might not be its private data, but its ability to harness the collective intelligence of the wider world.</p>"
            }
          ]
        },
        {
          "title": "Google Flu Trends",
          "introduction": "Launched in 2008, Google Flu Trends (GFT) was hailed as a revolutionary tool for public health. By analyzing flu-related search queries, it promised to predict outbreaks weeks faster than the CDC. After initial success, however, it began to fail spectacularly, offering a powerful cautionary tale about the hidden pitfalls of data-driven collective intelligence.",
          "threads": [
            {
              "title": "The Promise of Big Data",
              "content": "<p>The premise behind GFT was brilliant. The traditional method for tracking influenza, relying on reports from doctors' offices, had a significant time lag. Google hypothesized that the aggregated search queries of millions of people ('fever,' 'flu symptoms,' etc.) could act as a real-time sensor for outbreaks. For several years, it seemed to work, with GFT's predictions closely mirroring the CDC's data, but with a crucial two-week head start.</p>"
            },
            {
              "title": "The Great Overestimation",
              "content": "<p>The system's credibility collapsed during the 2012-2013 flu season. Week after week, GFT's predictions were wildly off, at one point estimating more than double the number of flu cases that the CDC later confirmed. The high-profile failure turned GFT from a poster child of 'Big Data' into a symbol of its hubris. The project was eventually quietly shut down.</p>"
            },
            {
              "title": "What Went Wrong? Algorithmic Drift",
              "content": "<p>One major problem was that the system lacked <mark>independence</mark> from its own creator. Google's engineers were constantly tweaking the search algorithm to improve user experience—for example, by adding recommended search terms when a user typed 'fever.' These changes, made for perfectly good reasons, contaminated the data GFT relied on. The tool was trying to measure a phenomenon using an instrument that was itself constantly changing, a problem known as algorithmic drift.</p>"
            },
            {
              "title": "The Core Flaw: Lack of True Diversity",
              "content": "<p>The most fundamental flaw was GFT's lack of <mark>cognitive diversity</mark>. While it processed a massive amount of data, it was all of the *same type*: search queries. This made it brittle. The CDC, by contrast, uses a diverse set of data streams: reports from outpatient clinics, virologic test results from labs, hospitalization records, and mortality data. When a media scare caused people to search for 'flu' even if they weren't sick, GFT's single source of information was corrupted, while the CDC's more diverse system remained stable.</p>"
            },
            {
              "title": "Hubris of the Algorithm",
              "content": "<p>The story of Google Flu Trends is a crucial lesson in the limits of algorithmic wisdom. It demonstrates that the size of a dataset ('Big Data') cannot substitute for the genuine diversity of its sources. A system that relies on a single, homogenous source of information, no matter how large, is vulnerable to systemic errors and biases. True collective intelligence requires aggregating information from multiple, independent, and varied perspectives, a principle that applies as much to algorithms as it does to human crowds.</p>"
            }
          ]
        },
        {
          "title": "The Netflix Prize",
          "introduction": "In 2006, Netflix announced a $1 million prize for any team that could improve its movie recommendation algorithm by 10%. The three-year competition that followed became a landmark event in data science and a perfect illustration of how a well-structured problem can harness global collective intelligence to achieve a breakthrough.",
          "threads": [
            {
              "title": "The Problem to Solve",
              "content": "<p>Netflix's business model depended on its ability to recommend movies its users would love. Its internal algorithm, Cinematch, was good, but the company knew it could be better. The problem of 'collaborative filtering'—predicting a user's taste based on the ratings of other, similar users—is incredibly complex. By launching the prize, Netflix acknowledged that the solution might lie outside its own walls and incentivized a global 'crowd' of problem-solvers to tackle the challenge.</p>"
            },
            {
              "title": "A Global Competition",
              "content": "<p>The response was massive. More than 40,000 teams from 186 countries registered to compete. The participants ranged from university computer science departments and corporate research labs to amateur hobbyists. This created an enormous pool of <mark>cognitive diversity</mark>, with thousands of different statistical techniques and machine learning approaches being applied to the same dataset simultaneously.</p>"
            },
            {
              "title": "The Power of Ensembles",
              "content": "<p>A crucial pattern emerged early on. The top-performing teams were not those with a single, elegant, 'perfect' algorithm. Instead, they were the ones who created 'ensembles' by blending the predictions of many different, individually weaker models. One model might be good at predicting ratings for blockbuster movies, while another might excel at obscure foreign films. By combining their strengths, the ensemble model was more accurate than any of its components. This was a direct, mathematical demonstration of the wisdom of crowds.</p>"
            },
            {
              "title": "BellKor's Pragmatic Chaos",
              "content": "<p>The team that eventually won, 'BellKor's Pragmatic Chaos,' was itself a testament to this principle. It began as a team from AT&T Labs ('BellKor') which held the top spot for much of the competition. To get the final edge, they merged with two other top teams ('BigChaos' and 'Pragmatic Theory'). Their final, winning solution was not a single, elegant formula but a complex, multi-stage blend of over 100 different predictive models. It was a triumph of carefully aggregated diversity.</p>"
            },
            {
              "title": "Wisdom as a Blend",
              "content": "<p>The Netflix Prize is a perfect metaphor for how collective intelligence works on complex problems. The winning solution wasn't a single 'eureka' moment from a lone genius. It was the result of a process of <mark>aggregation</mark> at multiple levels: aggregating different models into an ensemble, and aggregating different teams into a super-team. It proved that for certain problems, the path to a smarter solution lies in finding clever ways to combine and weight the partial insights of a diverse and independent crowd.</p>"
            }
          ]
        }
      ]
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ===== Utilities =====
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
      const slug = s => s.toLowerCase().replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-');

      // ===== Read Metadata from JSON =====
      let jsonData = {};
      try {
        jsonData = JSON.parse(document.getElementById('embedded-json').textContent);
      } catch (e) {
        console.error("Error parsing embedded JSON:", e);
        document.getElementById('docTitle').textContent = 'Error Loading Content';
        return;
      }
      const docTitle = jsonData.title || 'Untitled Document';
      const docSubtitle = jsonData.description || '';
      const timelineStepsData = jsonData.timeline_steps;
      const timelineLabelsData = jsonData.timeline_labels;
      
      // ===== Populate Header from Metadata =====
      document.getElementById('docTitle').textContent = docTitle;
      document.getElementById('docSubtitle').textContent = docSubtitle;
      document.title = docTitle;

      // ===== Build Content from JSON =====
      const contentSection = document.getElementById('content');
      let contentHtml = '';
      if (jsonData.articles) {
        jsonData.articles.forEach(article => {
          contentHtml += `<article id="${slug(article.title)}">`;
          contentHtml += `<h2>${article.title}</h2>`;
          if (article.introduction) {
            contentHtml += `<p class="lead">${article.introduction}</p>`;
          }
          if (article.threads) {
            article.threads.forEach(thread => {
              contentHtml += `<details open>`;
              contentHtml += `<summary><h3>${thread.title}</h3></summary>`;
              if (thread.content) {
                contentHtml += `<div class="pl-4 border-l-2 border-var">${thread.content}</div>`;
              }
              contentHtml += `</details>`;
            });
          }
          contentHtml += `</article>`;
        });
      }
      contentSection.innerHTML = contentHtml;

      // ===== Theme packs =====
      const THEME_PACKS = {
        slate: {
          proseClass: 'prose-slate',
          bodyClass: 'bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100 pb-[env(safe-area-inset-bottom)]'
        },
        emerald: {
          proseClass: 'prose-emerald',
          bodyClass: 'bg-white text-emerald-900 dark:bg-emerald-950 dark:text-emerald-100 pb-[env(safe-area-inset-bottom)]'
        }
      };
      const availableThemes = Object.keys(THEME_PACKS);

      function applyTheme(themeKey){
        const root = document.documentElement;
        const isDark = root.classList.contains('dark');
        const pack = THEME_PACKS[themeKey] || THEME_PACKS.slate;
        root.classList.toggle('theme-emerald', isDark && themeKey === 'emerald');
        document.body.className = isDark ? pack.bodyClass : THEME_PACKS.slate.bodyClass;
        contentSection.className = `prose ${pack.proseClass} dark:prose-invert max-w-none`;
        try { localStorage.setItem('colorScheme', themeKey); } catch(_){}
      }

      let currentThemeIndex = 0;
      try {
        const saved = localStorage.getItem('colorScheme');
        if (saved && THEME_PACKS[saved]) currentThemeIndex = availableThemes.indexOf(saved);
      } catch(_) {}
      
      const colorBtn = document.getElementById('colorSchemeToggle');
      colorBtn?.addEventListener('click', () => {
        const root = document.documentElement;
        if (!root.classList.contains('dark')) {
          root.classList.add('dark');
          try { localStorage.setItem('theme','dark'); } catch(_){}
          document.getElementById('themeToggle')?.setAttribute('aria-pressed','true');
          applyTheme(availableThemes[currentThemeIndex]); // apply color when switching to dark
          return;
        }
        currentThemeIndex = (currentThemeIndex + 1) % availableThemes.length;
        const newTheme = availableThemes[currentThemeIndex];
        applyTheme(newTheme);
        buildTOC();
      });

      const themeBtn = document.getElementById('themeToggle');
      if (themeBtn) {
        themeBtn.setAttribute('aria-pressed', String(document.documentElement.classList.contains('dark')));
      }
      themeBtn?.addEventListener('click', () => {
        const root = document.documentElement;
        const isDark = root.classList.toggle('dark');
        try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(_){}
        themeBtn.setAttribute('aria-pressed', String(isDark));

        if (!isDark) {
          root.classList.remove('theme-emerald');
          applyTheme('slate');
        } else {
          let saved = 'slate';
          try { const s = localStorage.getItem('colorScheme'); if (s) saved = s; } catch(_){}
          applyTheme(saved);
        }
        buildTOC();
      });

      // ===== Expand/Collapse, TOC, Timeline, Search =====
      const getDetails = () => document.querySelectorAll('#content details');
      const expandBtn = document.getElementById('expandAll');
      const collapseBtn = document.getElementById('collapseAll');

      if (getDetails().length === 0) {
        if(expandBtn) expandBtn.hidden = true;
        if(collapseBtn) collapseBtn.hidden = true;
      } else {
        expandBtn?.addEventListener('click', () => { getDetails().forEach(d => d.open = true); });
        collapseBtn?.addEventListener('click', () => { getDetails().forEach(d => d.open = false); });
      }

      (function addBackToTopLinks(){
        $$('#content > article').forEach((article, index, arr) => {
          if (index === arr.length - 1) return;
          const wrapper = document.createElement('div');
          wrapper.className = 'mt-6 flex justify-end';
          wrapper.innerHTML = `<a href="#top" class="text-sm underline decoration-dotted">Back to top</a>`;
          article.appendChild(wrapper);
        });
      })();

      function buildTOC(){
        const toc = document.getElementById('toc');
        if (!toc) return;
        const headings = $$('#content h2, #content h3');
        const items = headings.map(h => {
          const parentArticle = h.closest('article');
          const parentSlug = parentArticle ? parentArticle.id : '';
          if (!h.id) h.id = parentSlug + '-' + slug(h.textContent);
          return { id: h.id, text: h.textContent.trim(), level: h.tagName.toLowerCase() };
        });

        toc.innerHTML = items.map(({id, text, level}) => {
          const pad = level === 'h3' ? ' pl-4' : '';
          return `<li><a href="#${id}" class="toc-link block px-2 py-1.5 rounded${pad}">${text}</a></li>`;
        }).join('');

        const links = $$('#toc a');
        const sections = items.map(i => document.getElementById(i.id));
        const obs = new IntersectionObserver(entries => {
          entries.forEach(e => {
            if (e.isIntersecting) {
              links.forEach(a => a.classList.remove('active-link'));
              const id = '#' + e.target.id;
              const active = links.find(a => a.getAttribute('href') === id);
              active?.classList.add('active-link');
            }
          });
        }, { rootMargin: '-40% 0px -55% 0px', threshold: 0.01 });
        sections.forEach(sec => sec && obs.observe(sec));
      }
      
      (function buildTimeline(){
        const wrap = document.getElementById('timelineWrap');
        const list = document.getElementById('timeline');
        const coda = document.getElementById('timelineCoda');

        if (!timelineStepsData || !wrap || !list) { if(wrap) wrap.hidden = true; return; }
        const steps = timelineStepsData.split(',').map(s => s.trim());
        const labels = timelineLabelsData ? timelineLabelsData.split(',').map(s => s.trim()) : [];
        if (!steps.length) { wrap.hidden = true; return; }
        wrap.hidden = false;

        const mkStep = (id, label) => (
          `<li class="flex items-center gap-2"><span class="inline-block w-[14px] h-[14px] rounded-full border-2 border-current bg-current"></span><a href="#${id}" class="hover:underline">${label}</a></li>`
        );
        const segments = [];
        steps.forEach((id, idx) => {
          const el = $$('#content h2, #content h3').find(h => slug(h.textContent) === id);
          if (el && !el.id) el.id = id;
          const label = labels[idx] || (el?.textContent || id.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
          segments.push(mkStep(id, label));
          if (idx !== steps.length - 1) segments.push('<li class="h-[2px] bg-current opacity-35"></li>');
        });
        list.innerHTML = segments.join('');
      })();

      (function searchHL(){
        const input = document.getElementById('search');
        const clearBtn = document.getElementById('clearSearch');
        if (!input || !contentSection) return;
        let originalHTML = '';
        function restore(){ 
          if (originalHTML) {
            contentSection.innerHTML = originalHTML; 
            buildTOC(); // Rebuild TOC to reattach observers
          }
        }
        function highlight(term){
          if (!originalHTML) originalHTML = contentSection.innerHTML;
          restore();
          if (!term) return;
          const esc = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          const re = new RegExp(`(${esc})(?![^<]*>)`, 'gi');
          contentSection.innerHTML = contentSection.innerHTML.replace(re, '<mark>$1</mark>');
          buildTOC();
        }
        let t; 
        input.addEventListener('input', (e) => { 
          clearTimeout(t); 
          t = setTimeout(() => highlight(e.target.value.trim()), 120); 
        });
        clearBtn?.addEventListener('click', () => { 
          if (input) input.value=''; 
          restore(); 
        });
      })();

      buildTOC();
      try {
        const saved = localStorage.getItem('colorScheme');
        applyTheme(saved && THEME_PACKS[saved] ? saved : 'slate');
      } catch(_){
        applyTheme('slate');
      }

      // ===== Mobile FAB wiring =====
      const fab = document.getElementById('fab');
      const fabPanel = document.getElementById('fabPanel');
      const fabTheme = document.getElementById('fabTheme');
      const fabColor = document.getElementById('fabColor');

      fab?.addEventListener('click', () => fabPanel.classList.toggle('show'));
      document.addEventListener('click', (e)=>{
        if (fabPanel && !fabPanel.contains(e.target) && fab && !fab.contains(e.target)) fabPanel.classList.remove('show');
      });
      fabTheme?.addEventListener('click', () => document.getElementById('themeToggle')?.click());
      fabColor?.addEventListener('click', () => document.getElementById('colorSchemeToggle')?.click());
    });
  </script>
</body>
</html>
