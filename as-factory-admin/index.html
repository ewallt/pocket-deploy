<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* DARK COMMAND CENTER THEME */
        :root{
            --bg:#0b1020; --panel:#111833; --ink:#e6ecff; --muted:#a7b0cc;
            --brand:#8bb9ff; --accent:#c0ffe1; --border:#26325b; --chip:#1a2347;
            --bad:#ff6b6b; --shadow:0 8px 28px rgba(0,0,0,.35);
            --radius:14px;
        }

        body { 
            background-color: var(--bg); 
            color: var(--ink); 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: radial-gradient(1200px 600px at 10% -5%, rgba(139,185,255,.20), transparent 55%),
                        radial-gradient(1000px 400px at 95% 10%, rgba(192,255,225,.18), transparent 60%), var(--bg);
        }

        .terminal { 
            border: 1px solid var(--border); 
            padding: 2.5rem; 
            width: 600px; 
            background: var(--panel); 
            border-radius: var(--radius); 
            box-shadow: var(--shadow); 
        }

        h1 { color: var(--ink); margin-bottom: 0.5rem; }
        p { color: var(--muted); margin-bottom: 2rem; }

        /* Input Styling */
        input[type="text"] { 
            background: var(--bg); 
            border: 1px solid var(--border); 
            color: var(--ink); 
            width: 100%; 
            outline: none; 
            padding: 1rem; 
            font-size: 1.1rem; 
            border-radius: 8px;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--brand); }

        /* Button Styling */
        button { 
            margin-top: 1rem; 
            width: 100%; 
            border: none; 
            background: var(--brand); 
            color: #0b1020; 
            padding: 0.75rem; 
            cursor: pointer; 
            transition: opacity 0.2s; 
            font-weight: bold;
            border-radius: 8px;
        }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Logs & List */
        .log { 
            margin-top: 1.5rem; 
            font-size: 0.85rem; 
            color: var(--muted); 
            height: 100px; 
            overflow-y: auto; 
            background: rgba(0,0,0,0.2); 
            padding: 1rem; 
            border-radius: 6px; 
            font-family: monospace;
            border: 1px solid var(--border);
        }
        
        .app-list { margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1rem; }
        
        .app-item {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0.75rem; 
            background: rgba(255,255,255,0.03); 
            border-radius: 8px; 
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
        }
        .app-item:hover { border-color: var(--brand); }
        
        .app-link { color: var(--brand); text-decoration: none; font-weight: 500; }
        .app-link:hover { text-decoration: underline; }

        .del-btn {
            background: transparent;
            color: var(--muted);
            font-size: 0.8rem;
            width: auto;
            margin: 0;
            padding: 4px 8px;
            border: 1px solid var(--border);
        }
        .del-btn:hover { color: var(--bad); border-color: var(--bad); opacity: 1; }
        
        /* Data Ops Styling */
        .data-ops { 
            margin-top: 2rem; 
            border-top: 1px dashed var(--border); 
            padding-top: 1rem; 
            display: flex; 
            gap: 1rem; 
        }
        .data-btn { 
            margin-top: 0; 
            background: var(--chip); 
            color: var(--muted); 
            font-size: 0.8rem; 
            border: 1px solid var(--border);
        }
        .data-btn:hover { background: var(--border); color: var(--ink); opacity: 1; }
    </style>
</head>
<body>

    <div class="terminal">
        <h1 class="text-3xl font-bold">Snapshot Architect v1.2</h1>
        <p>Initialize a new domain construct.</p>
        
        <form onsubmit="buildApp(event)">
            <input type="text" id="domainInput" placeholder="e.g. Chemistry, Cooking, Stoicism..." autocomplete="off">
            <button type="submit" id="buildBtn">Initialize Construct</button>
        </form>

        <div id="log" class="log">Ready for input...</div>

        <div class="app-list" id="appList"></div>

        <!-- Data Management Section -->
        <div class="data-ops">
            <button onclick="exportData()" class="data-btn">Export Database</button>
            <button onclick="document.getElementById('importFile').click()" class="data-btn">Restore Database</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(this)" accept=".json">
        </div>
    </div>

    <script>
        const API_KEY = ""; // Set API Key here
        const CONFIG_PREFIX = "as-config-";
        const DATA_PREFIX = "as-"; // Broad prefix for all app data

        // --- 1. The Architect Logic ---
        async function buildApp(e) {
            e.preventDefault();
            const domain = document.getElementById('domainInput').value.trim();
            if(!domain) return;

            log(`Contacting Intelligence for domain: ${domain}...`);
            document.getElementById('buildBtn').disabled = true;
            document.getElementById('buildBtn').innerText = "Architecting...";

            const prompt = `
                Role: Senior Software Architect & UX Designer.
                Task: Create a configuration for a "Snapshot Web App" based on the domain: "${domain}".
                
                Requirements:
                1. Define a visual theme (colors).
                2. Define an AI Persona (role).
                3. Define terminology (titles, nouns).
                4. Define 4 distinct "Snapshot Sections" for analysis (Label, Icon, Instruction).

                Output: STRICT JSON.
                {
                    "slug": "short-slug (e.g. chemistry)",
                    "theme": { 
                        "brand": "Hex Color (e.g. #00ff00)", 
                        "bg_gradient_1": "Hex Color (subtle)", 
                        "bg_gradient_2": "Hex Color (subtle)" 
                    },
                    "text": {
                        "roomTitle": "Entry Page Title (e.g. The Lab)",
                        "hubTitle": "Dashboard Title (e.g. Element Index)",
                        "viewerTitle": "Analysis Page Title (e.g. Compound Analyzer)",
                        "unitNoun": "Singular Unit (e.g. Molecule)",
                        "inputPlaceholder": "Search placeholder (e.g. Enter Formula...)"
                    },
                    "ai": {
                        "role": "Persona Name",
                        "context": "Context instruction (e.g. Analyze chemically)",
                        "guardRails": "Denial criteria (e.g. Must be a chemical element)",
                        "sections": [
                            { "label": "Section 1", "icon": "Emoji", "instruction": "Prompt instruction" },
                            { "label": "Section 2", "icon": "Emoji", "instruction": "Prompt instruction" },
                            { "label": "Section 3", "icon": "Emoji", "instruction": "Prompt instruction" },
                            { "label": "Section 4", "icon": "Emoji", "instruction": "Prompt instruction" }
                        ]
                    }
                }
            `;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    }
                );

                const data = await response.json();
                const config = JSON.parse(data.candidates[0].content.parts[0].text);
                
                // SAVE CONFIG
                localStorage.setItem(CONFIG_PREFIX + config.slug, JSON.stringify(config));
                
                log(`Success! App "${config.slug}" constructed.`);
                renderApps();
                document.getElementById('domainInput').value = '';

            } catch(e) {
                log(`Error: ${e.message}`);
            } finally {
                document.getElementById('buildBtn').disabled = false;
                document.getElementById('buildBtn').innerText = "Initialize Construct";
            }
        }

        // --- 2. List Management ---
        function renderApps() {
            const list = document.getElementById('appList');
            list.innerHTML = '<div class="text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider">Installed Constructs</div>';
            
            Object.keys(localStorage).forEach(key => {
                if(key.startsWith(CONFIG_PREFIX)) {
                    const config = JSON.parse(localStorage.getItem(key));
                    const div = document.createElement('div');
                    div.className = 'app-item';
                    div.innerHTML = `
                        <a href="../as-factory-room/index.html?factory=${config.slug}" class="app-link" target="_blank">
                            ${config.text.roomTitle} (${config.slug})
                        </a>
                        <button onclick="deleteApp('${key}')" class="del-btn">Remove</button>
                    `;
                    list.appendChild(div);
                }
            });
        }

        function deleteApp(key) {
            if(confirm("Uninstall this construct?")) {
                localStorage.removeItem(key);
                renderApps();
            }
        }

        // --- 3. Data Persistence (Export/Import) ---
        function exportData() {
            const dump = {};
            let count = 0;
            // Gather all keys belonging to the Snapshot Factory ecosystem
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith(DATA_PREFIX)) {
                    dump[key] = localStorage.getItem(key);
                    count++;
                }
            });

            if (count === 0) { log("Database empty. Nothing to export."); return; }

            const blob = new Blob([JSON.stringify(dump, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `snapshot_factory_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            log(`Exported ${count} records.`);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dump = JSON.parse(e.target.result);
                    const count = Object.keys(dump).length;
                    
                    if(confirm(`Overwrite current database with ${count} records? This cannot be undone.`)) {
                        // 1. Clear existing Factory data
                        Object.keys(localStorage).forEach(key => {
                            if (key.startsWith(DATA_PREFIX)) localStorage.removeItem(key);
                        });

                        // 2. Restore data
                        Object.entries(dump).forEach(([key, val]) => {
                            localStorage.setItem(key, val);
                        });

                        log(`Restored ${count} records successfully.`);
                        renderApps();
                    }
                } catch (err) {
                    log("Error: Invalid JSON file.");
                    console.error(err);
                }
                input.value = ''; // Reset input
            };
            reader.readAsText(file);
        }

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += `<div>> ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        // Init
        renderApps();
    </script>
</body>
</html>
