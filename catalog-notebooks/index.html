<!DOCTYPE html>
<html lang="en" class="theme-newspaper">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notebook Catalog — By Subject</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --border:#e5e7eb; --text:#0f172a; --muted:#475569; --accent:#2563eb;
      --chip-bg:#eef2ff; --chip-text:#3730a3; --chip-border:#c7d2fe; --chip-on:#1d4ed8; --chip-on-bg:#dbeafe;
    }
    body{background:var(--bg); color:var(--text);}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:12px;}
    .chip{
      display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .7rem; border-radius:999px;
      border:1px solid var(--chip-border); background:var(--chip-bg); color:var(--chip-text);
      font-size:.85rem; line-height:1; cursor:pointer; user-select:none;
    }
    .chip[aria-pressed="true"]{ background:var(--chip-on-bg); color:#0b1f4f; border-color:var(--chip-on);}
    .badge{
      display:inline-block; font-size:.72rem; padding:.15rem .45rem; border-radius:999px; border:1px solid var(--border); color:var(--muted);
    }
    .link{color:var(--accent); text-decoration:underline;}
    .grid{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:1rem;}
    @media(min-width:640px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media(min-width:1024px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
    .card{padding:1rem; border:1px solid var(--border); border-radius:10px; background:#fff; transition:box-shadow .15s, transform .15s;}
    .card:hover{ box-shadow:0 8px 22px rgba(2,6,23,.06); transform:translateY(-1px); }
    .muted{color:var(--muted);}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;}
  </style>
</head>
<body class="antialiased">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-2">
    <h1 class="text-2xl font-bold">Notebook Catalog</h1>
    <p class="muted mt-1 text-sm">Filter by <strong>subject</strong> or search by title/id. Tap a card to open the notebook.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <section class="panel p-4 sm:p-5 mb-4">
      <div class="flex flex-col sm:flex-row sm:items-center gap-3">
        <div class="flex-1">
          <label for="q" class="sr-only">Search</label>
          <input id="q" type="search" inputmode="search" placeholder="Search notebooks… (title or id)"
                 class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="text-sm muted shrink-0" id="counts">0 shown</div>
      </div>
      <div id="chips" class="mt-3 flex flex-wrap gap-2"></div>
    </section>

    <section id="results" class="grid"></section>

    <!-- Inline fallback -->
    <script id="notebooks-data" type="application/json">
      <!-- Paste the notebooks.json array here if you don’t want to host it separately →

[
  {
    "id": "ntbk-ww2-overy",
    "title": "WWII — Why the Allies Won (Notes)",
    "subject": "History",
    "tags": ["WWII","Overy","strategy"],
    "lm_id": "notebooklm-12345",
    "created": "2024-08-21",
    "updated": "2025-01-03",
    "cover": "",
    "app": { "id": "dashboard-ww2-why", "type": "dashboard", "url": "https://ewallt.github.io/pocket-deploy/dashboard-ww2-why/" },
    "sources": [
      { "title": "Overy — Why the Allies Won", "url": "" }
    ],
    "notes": ""
  },
  {
    "id": "ntbk-cruciform-life",
    "title": "The Cruciform Life — Notes",
    "subject": "Theology",
    "tags": ["cruciform","ethics"],
    "lm_id": "notebooklm-67890",
    "created": "2024-07-02",
    "updated": "2025-01-04",
    "cover": "",
    "app": { "id": "ar-cruciform-academic", "type": "ar", "url": "https://ewallt.github.io/pocket-deploy/ar-cruciform-academic/" },
    "sources": [
      { "title": "Key article A", "url": "" },
      { "title": "Key article B", "url": "" }
    ],
    "notes": ""
  }
]


    </script>
  </main>

  <script>
  (function(){
    const state = { data: [], search: "", activeSubjects: new Set() };

    function esc(s){return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

    // Subject labels
    const SUBJECT_LABEL = {
      "Theology":"Theology","History":"History","Psychology":"Psychology","Philosophy":"Philosophy",
      "Math/Physics":"Math/Physics","Art":"Art","Science":"Science","Interactive":"Interactive","Misc":"Misc","Geography":"Geography","Warfare":"Warfare"
    };

    // Data loading
    async function loadData(){
      const candidates=["./notebooks.json","../notebooks.json","/notebooks.json"];
      for(const url of candidates){
        try{
          const res=await fetch(url,{cache:"no-store"});
          if(res.ok){ const j=await res.json(); if(Array.isArray(j)) return j; }
        }catch(_){}
      }
      const island=document.getElementById("notebooks-data");
      if(island && island.textContent.trim()){
        try{ const j=JSON.parse(island.textContent); if(Array.isArray(j)) return j; }catch(_){}
      }
      throw new Error("Unable to load notebooks.json");
    }

    const chipsEl=document.getElementById("chips");
    const resultsEl=document.getElementById("results");
    const countsEl=document.getElementById("counts");
    const qEl=document.getElementById("q");

    function buildSubjectChips(data){
      chipsEl.innerHTML="";
      const allBtn=document.createElement("button");
      allBtn.className="chip";
      allBtn.dataset.subject="";
      allBtn.setAttribute("aria-pressed", state.activeSubjects.size===0 ? "true":"false");
      allBtn.innerHTML=`<span>All</span><span class="badge">${data.length}</span>`;
      chipsEl.appendChild(allBtn);

      const counts={};
      for(const item of data){ const s=item.subject||"Misc"; counts[s]=(counts[s]||0)+1; }

      for(const s of Object.keys(SUBJECT_LABEL)){
        if(!counts[s]) continue;
        const btn=document.createElement("button");
        btn.className="chip";
        btn.dataset.subject=s;
        btn.setAttribute("aria-pressed", state.activeSubjects.has(s)? "true":"false");
        btn.innerHTML=`<span>${SUBJECT_LABEL[s]}</span><span class="badge">${counts[s]}</span>`;
        chipsEl.appendChild(btn);
      }
    }

    function apply(){
      const q=(state.search||"").toLowerCase().trim();
      const filtered = state.data.filter(item=>{
        const subj=item.subject||"Misc";
        const ok = state.activeSubjects.size===0 || state.activeSubjects.has(subj);
        if(!ok) return false;
        if(!q) return true;
        return (item.title||"").toLowerCase().includes(q) || (item.id||"").toLowerCase().includes(q);
      });

      filtered.sort((a,b)=>{
        const sa=a.subject||"Misc";
        const sb=b.subject||"Misc";
        if(sa!==sb) return sa.localeCompare(sb);
        return (a.title||"").localeCompare(b.title||"");
      });

      resultsEl.innerHTML="";
      for(const nb of filtered){
        const card=document.createElement("a");
        card.href=nb.url; card.target="_blank"; card.rel="noopener"; card.className="card block";
        card.innerHTML=`
          <div class="flex items-start justify-between gap-3">
            <h3 class="text-base font-semibold leading-tight">${esc(nb.title||nb.id)}</h3>
            <div class="flex gap-2 items-center">
              <span class="badge">${esc(nb.subject||"Misc")}</span>
              <span class="badge">Notebook</span>
            </div>
          </div>
          <p class="muted mt-1 text-sm">${esc(nb.id||"")}</p>
          <p class="mt-2 text-sm"><span class="link">Open</span> →</p>
        `;
        resultsEl.appendChild(card);
      }
      countsEl.textContent=`${filtered.length} shown`;

      chipsEl.querySelectorAll(".chip").forEach(ch=>{
        const s=ch.dataset.subject;
        const on = s ? state.activeSubjects.has(s) : (state.activeSubjects.size===0);
        ch.setAttribute("aria-pressed", on ? "true":"false");
      });
    }

    chipsEl.addEventListener("click",(e)=>{
      const btn=e.target.closest(".chip"); if(!btn) return;
      const s=btn.dataset.subject;
      if(!s){ state.activeSubjects.clear(); }
      else{ state.activeSubjects.has(s) ? state.activeSubjects.delete(s) : state.activeSubjects.add(s); }
      apply();
    });

    qEl.addEventListener("input", ()=>{
      state.search = qEl.value || "";
      apply();
    });

    (async function init(){
      try{
        state.data = await loadData();
        qEl.value = state.search;
        buildSubjectChips(state.data);
        apply();
      }catch(err){
        resultsEl.innerHTML = `
          <div class="panel p-6">
            <h3 class="text-lg font-semibold">Couldn’t load <code>notebooks.json</code></h3>
            <p class="muted mt-1">Place this file at the repo root and refresh, or paste it in the inline data-island above.</p>
          </div>`;
      }
    })();
  })();
  </script>
</body>
</html>

