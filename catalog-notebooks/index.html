<!DOCTYPE html>
<html lang="en" class="theme-newspaper">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NotebookLM — Notebooks Catalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --border:#e5e7eb; --text:#0f172a; --muted:#475569; --accent:#2563eb;
      --chip-bg:#eef2ff; --chip-text:#3730a3; --chip-border:#c7d2fe; --chip-on:#1d4ed8; --chip-on-bg:#dbeafe;
    }
    body{background:var(--bg); color:var(--text);}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:12px;}
    .chip{
      display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .7rem; border-radius:999px;
      border:1px solid var(--chip-border); background:var(--chip-bg); color:var(--chip-text);
      font-size:.85rem; line-height:1; cursor:pointer; user-select:none;
    }
    .chip[aria-pressed="true"]{ background:var(--chip-on-bg); color:#0b1f4f; border-color:var(--chip-on);}
    .badge{ display:inline-block; font-size:.72rem; padding:.15rem .45rem; border-radius:999px; border:1px solid var(--border); color:var(--muted);}
    .link{color:var(--accent); text-decoration:underline;}
    .grid{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:1rem;}
    @media(min-width:640px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media(min-width:1024px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
    .card{padding:1rem; border:1px solid var(--border); border-radius:10px; background:#fff; transition:box-shadow .15s, transform .15s;}
    .card:hover{ box-shadow:0 8px 22px rgba(2,6,23,.06); transform:translateY(-1px); }
    .muted{color:var(--muted);}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;}
  </style>
</head>
<body class="antialiased">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-2">
    <h1 class="text-2xl font-bold">NotebookLM — Notebooks Catalog</h1>
    <p class="muted mt-1 text-sm">Filter by <strong>subject</strong> or search by title/id. Tap a card to open the notebook or linked app.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <section class="panel p-4 sm:p-5 mb-4">
      <div class="flex flex-col sm:flex-row sm:items-center gap-3">
        <div class="flex-1">
          <label for="q" class="sr-only">Search</label>
          <input id="q" type="search" inputmode="search" placeholder="Search notebooks… (title or id)"
                 class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="text-sm muted shrink-0" id="counts">0 shown</div>
      </div>
      <div id="chips" class="mt-3 flex flex-wrap gap-2"></div>
    </section>

    <section id="results" class="grid"></section>

    <!-- Strict JSON data-island (keep plain quotes, no comments, no trailing commas) -->
    <script id="notebooks-data" type="application/json">[
      {
        "id": "nb-conan-obrien",
        "title": "Conan O'Brien: Interviews & Commentary",
        "subject": "Media & Culture",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-001",
        "share_url": "#",
        "app_url": null,
        "app_ids": [],
        "sources": [
          {"title": "Conan podcast transcripts", "url": "#", "note": "Primary quotes", "quality": "high"}
        ],
        "notes": "Add share link later."
      },
      {
        "id": "nb-pale-blue-eye",
        "title": "The Pale Blue Eye — Research Notes",
        "subject": "Literature",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-002",
        "share_url": "#",
        "app_url": null,
        "app_ids": [],
        "sources": [
          {"title": "Novel excerpts", "url": "#", "note": "Marked passages", "quality": "medium"}
        ],
        "notes": "Tie to future reading app."
      },
      {
        "id": "nb-rbf",
        "title": "Righteousness by Faith — Sourcebook",
        "subject": "Theology",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-003",
        "share_url": "#",
        "app_url": "https://centrality-of-the-cross.onrender.com",
        "app_ids": ["centrality-cross"],
        "sources": [
          {"title": "Waggoner/Wieland essays", "url": "#", "note": "Core materials", "quality": "high"}
        ],
        "notes": "Used by several theology apps."
      },
      {
        "id": "nb-hinge-factors",
        "title": "Hinge Factors of History",
        "subject": "History",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-004",
        "share_url": "#",
        "app_url": "https://ww2-ae29.onrender.com",
        "app_ids": ["ww2-ae29"],
        "sources": [
          {"title": "WWII turning points", "url": "#", "note": "Battle summaries", "quality": "high"}
        ],
        "notes": "Feeds WW2 apps."
      },
      {
        "id": "nb-math-physics",
        "title": "Math & Physics — Concept Map",
        "subject": "Math/Physics",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-005",
        "share_url": "#",
        "app_url": "https://math-physics.onrender.com",
        "app_ids": ["math-physics", "physics-revolution"],
        "sources": [
          {"title": "Field notes", "url": "#", "note": "Key derivations", "quality": "medium"}
        ],
        "notes": "Supports multiple web apps."
      },
      {
        "id": "nb-city-neighborhoods",
        "title": "City Neighborhoods — Comparative Notes",
        "subject": "Geography",
        "platform": "NotebookLM",
        "notebook_id": "placeholder-006",
        "share_url": "#",
        "app_url": "https://city-neighborhoods.onrender.com",
        "app_ids": ["city-neighborhoods"],
        "sources": [],
        "notes": "Add maps & datasets later."
      }
    ]</script>

    <!-- Ultra-safe JS fallback (if JSON.parse fails for any reason) -->
    <script>
      // eslint-disable-next-line no-var
      var NOTEBOOKS_FALLBACK = [
        {"id":"nb-fallback-1","title":"Fallback Example","subject":"Misc","platform":"NotebookLM","notebook_id":"fallback","share_url":"#","app_url":null,"app_ids":[],"sources":[],"notes":"Only shown if JSON parse fails."}
      ];
    </script>
  </main>

  <script>
  (function(){
    const state = { data: [], search: "", activeSubjects: new Set() }; // empty set = All
    const SUBJECT_ORDER = ["Theology","History","Math/Physics","Media & Culture","Literature","Geography","Misc"];
    const SUBJECT_LABELS = new Set(SUBJECT_ORDER);

    // DOM refs
    const chipsEl = document.getElementById("chips");
    const resultsEl = document.getElementById("results");
    const countsEl = document.getElementById("counts");
    const qEl = document.getElementById("q");

    // Helpers
    function esc(s){return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

    function buildChips(data){
      chipsEl.innerHTML = "";
      const allBtn = document.createElement("button");
      allBtn.className = "chip";
      allBtn.dataset.subject = "";
      allBtn.setAttribute("aria-pressed", state.activeSubjects.size===0 ? "true":"false");
      allBtn.innerHTML = `<span>All</span><span class="badge">${data.length}</span>`;
      chipsEl.appendChild(allBtn);

      const counts = {};
      for(const nb of data){
        const s = nb.subject && SUBJECT_LABELS.has(nb.subject) ? nb.subject : "Misc";
        counts[s] = (counts[s]||0)+1;
      }
      const order = SUBJECT_ORDER.filter(s => counts[s]);
      for(const s of order){
        const btn = document.createElement("button");
        btn.className = "chip";
        btn.dataset.subject = s;
        btn.setAttribute("aria-pressed", state.activeSubjects.has(s)? "true":"false");
        btn.innerHTML = `<span>${s}</span><span class="badge">${counts[s]||0}</span>`;
        chipsEl.appendChild(btn);
      }
    }

    function apply(){
      const q = (state.search||"").toLowerCase().trim();
      const filtered = state.data.filter(nb=>{
        const subj = nb.subject && SUBJECT_LABELS.has(nb.subject) ? nb.subject : "Misc";
        const ok = state.activeSubjects.size===0 || state.activeSubjects.has(subj);
        if(!ok) return false;
        if(!q) return true;
        return (nb.title||"").toLowerCase().includes(q) || (nb.id||"").toLowerCase().includes(q);
      });

      // sort by subject order then title
      filtered.sort((a,b)=>{
        const sa = SUBJECT_ORDER.indexOf(a.subject||"Misc");
        const sb = SUBJECT_ORDER.indexOf(b.subject||"Misc");
        if(sa!==sb) return sa - sb;
        return (a.title||"").localeCompare(b.title||"");
      });

      resultsEl.innerHTML = "";
      for(const nb of filtered){
        const subj = nb.subject || "Misc";
        const appHref = nb.app_url || nb.share_url || "#";
        const hasApp = !!nb.app_url;

        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <h3 class="text-base font-semibold leading-tight">${esc(nb.title||nb.id)}</h3>
            <div class="flex gap-2 items-center">
              <span class="badge">${esc(subj)}</span>
              <span class="badge">NotebookLM</span>
            </div>
          </div>
          <p class="muted mt-1 text-sm">${esc(nb.id||"")}</p>
          <div class="mt-2 text-sm">
            <a href="${esc(nb.share_url||'#')}" target="_blank" rel="noopener" class="link">Open Notebook</a>
            ${hasApp ? ` &middot; <a href="${esc(nb.app_url)}" target="_blank" rel="noopener" class="link">Open App</a>` : ``}
          </div>
          ${Array.isArray(nb.sources)&&nb.sources.length
            ? `<details class="mt-2">
                 <summary class="text-sm cursor-pointer">Sources (${nb.sources.length})</summary>
                 <ul class="mt-2 list-disc pl-5 text-sm">
                   ${nb.sources.map(s=>`<li><a class="link" target="_blank" rel="noopener" href="${esc(s.url||'#')}">${esc(s.title||'Source')}</a>${s.note?` — ${esc(s.note)}`:''}${s.quality?` <span class="badge">${esc(s.quality)}</span>`:''}</li>`).join("")}
                 </ul>
               </details>` : ``}
        `;
        resultsEl.appendChild(card);
      }
      countsEl.textContent = `${filtered.length} shown`;

      chipsEl.querySelectorAll(".chip").forEach(ch=>{
        const s = ch.dataset.subject;
        const on = s ? state.activeSubjects.has(s) : (state.activeSubjects.size===0);
        ch.setAttribute("aria-pressed", on ? "true":"false");
      });
    }

    // Events
    chipsEl.addEventListener("click",(e)=>{
      const btn = e.target.closest(".chip"); if(!btn) return;
      const s = btn.dataset.subject;
      if(!s){ state.activeSubjects.clear(); }
      else{
        state.activeSubjects.has(s) ? state.activeSubjects.delete(s) : state.activeSubjects.add(s);
      }
      apply();
    });
    qEl.addEventListener("input", ()=>{
      state.search = qEl.value || "";
      apply();
    });

    // Init: parse JSON safely; if it fails, use NOTEBOOKS_FALLBACK
    (function init(){
      const island = document.getElementById("notebooks-data");
      let parsed = [];
      if(island){
        const raw = island.textContent; // textContent avoids HTML entity noise
        try{
          // Trim to avoid stray whitespace/BOM
          parsed = JSON.parse(raw.trim());
        }catch(err){
          console.warn("JSON parse failed; using fallback:", err);
          // eslint-disable-next-line no-undef
          parsed = Array.isArray(NOTEBOOKS_FALLBACK) ? NOTEBOOKS_FALLBACK : [];
        }
      }
      state.data = Array.isArray(parsed) ? parsed : [];
      buildChips(state.data);
      apply();
    })();
  })();
  </script>
</body>
</html>
