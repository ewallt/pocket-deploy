<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notebooks Catalog — By Subject</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --border:#e5e7eb; --text:#0f172a; --muted:#475569; --accent:#2563eb;
      --chip-bg:#eef2ff; --chip-text:#3730a3; --chip-border:#c7d2fe; --chip-on:#1d4ed8; --chip-on-bg:#dbeafe;
    }
    body{background:var(--bg); color:var(--text);}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:12px;}
    .chip{display:inline-flex; align-items:center; gap:.5rem; padding:.35rem .7rem; border-radius:999px;
      border:1px solid var(--chip-border); background:var(--chip-bg); color:var(--chip-text);
      font-size:.85rem; line-height:1; cursor:pointer; user-select:none;}
    .chip[aria-pressed="true"]{ background:var(--chip-on-bg); color:#0b1f4f; border-color:var(--chip-on);}
    .badge{display:inline-block; font-size:.72rem; padding:.15rem .45rem; border-radius:999px; border:1px solid var(--border); color:var(--muted);}
    .grid{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:1rem;}
    @media(min-width:640px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media(min-width:1024px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
    .card{padding:1rem; border:1px solid var(--border); border-radius:10px; background:#fff; transition:box-shadow .15s, transform .15s;}
    .card:hover{ box-shadow:0 8px 22px rgba(2,6,23,.06); transform:translateY(-1px); }
    .muted{color:var(--muted);}
    .need-link{background-image:linear-gradient(90deg,#fff 0 60%, #fef3c7 60%); border-color:#fde68a;}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;}
  </style>
</head>
<body class="antialiased">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-2">
    <h1 class="text-2xl font-bold">Notebooks Catalog</h1>
    <p class="muted mt-1 text-sm">Filter by subject or search by title/id. Tap a card to open the notebook.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <section class="panel p-4 sm:p-5 mb-4">
      <div class="flex flex-col sm:flex-row sm:items-center gap-3">
        <div class="flex-1">
          <label for="q" class="sr-only">Search</label>
          <input id="q" type="search" inputmode="search" placeholder="Search notebooks… (title or id)"
                 class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div class="text-sm muted shrink-0" id="counts">0 shown</div>
      </div>
      <div id="chips" class="mt-3 flex flex-wrap gap-2"></div>
    </section>

    <section id="results" class="grid"></section>

    <!-- INLINE DATA ONLY (no external fetch) -->
    <script id="notebooks-data" type="application/json">
    [
      {"title":"Jungian Archetypes: Exploring the Collective Unconscious","subject":"Psychology"},
      {"title":"Christian Approaches to God, Christ, and Salvation","subject":"Theology"},
      {"title":"Girard’s Scapegoat Theory and Mimetic Desire","subject":"Theology"},
      {"title":"The Power of the Cross and Christian Freedom","subject":"Theology"},
      {"title":"Common Sense: Thomas Paine’s Argument for American Independence","subject":"History"},
      {"title":"The Fight for the Income Tax","subject":"History"},
      {"title":"Origins of the Cold War","subject":"History"},
      {"title":"The Joy of the Spirit: Promise, Redemption, and Victory","subject":"Theology"},
      {"title":"Understanding Autism Spectrum Disorder","subject":"Psychology"},
      {"title":"Industrial Progress and Development: A Global Perspective","subject":"History"},
      {"title":"Roman Innovations: From Cityscapes to Frontier Defenses","subject":"History"},
      {"title":"Nineteenth-Century Britain: Society, Economy, and Empire","subject":"History"},
      {"title":"Moltmann’s Theology of the Crucified God","subject":"Theology"},
      {"title":"Relational Dynamics in Personality Disorders and Abuse","subject":"Psychology"},
      {"title":"Personality Disorders and Intimate Partner Violence","subject":"Psychology"},
      {"title":"Moltmann’s Theology: Hope, Suffering, and Liberation","subject":"Theology"},
      {"title":"The Euphrates, Babylon, and the End Times","subject":"Theology"},
      {"title":"Behold Your God: Understanding His Character and Actions","subject":"Theology"},
      {"title":"Studies in the Sanctuary and Temple","subject":"Theology"},
      {"title":"Airpower Doctrine and Strategic Bombing Debates","subject":"History"},
      {"title":"Sudden Traffic Jams: Emergence to Impact","subject":"Science"},
      {"title":"The Everlasting Covenant and Justification by Faith","subject":"Theology"},
      {"title":"The Nonviolent Atonement: A Theological Odyssey","subject":"Theology"},
      {"title":"Challenging Violent Conceptions of God and Atonement","subject":"Theology"},
      {"title":"Movements in Modern Art","subject":"Art"},
      {"title":"Theology of Peace, Justice, and Reconciliation","subject":"Theology"},
      {"title":"N.T. Wright’s Theology: A Critical Overview","subject":"Theology"},
      {"title":"The Renaissance Chronicles","subject":"History"},
      {"title":"The Global Rivalry: Cold War Conflicts and Ideologies","subject":"History"},
      {"title":"Great Thinkers and Ideas","subject":"Philosophy"},
      {"title":"Scientific Revolution","subject":"History"},
      {"title":"A Nobel Prize for Climate","subject":"Science"},
      {"title":"Moral Vision and Faith in the New Testament","subject":"Theology","id":"64b953b5-5e31-4da4-badb-950084223ed0"},
      {"title":"Idea Pathogens: Cultural Epidemiology and Epistemic Health","subject":"Rationality"},
      {"title":"Conversations About God: Atonement, Sin, and Grace","subject":"Theology"},
      {"title":"Ellen G. White’s Writings and Seventh-day Adventist Beliefs","subject":"Theology"},
      {"title":"Sin, not God, destroys","subject":"Theology"},
      {"title":"Decision Hygiene: Reducing Noise in Judgments","subject":"Rationality"},
      {"title":"Why the Allies Won World War II","subject":"History"},
      {"title":"The Divine Democracy: God’s Rule by Love","subject":"Theology"},
      {"title":"Chrysostom on God’s Patient Cultivation and the Unmasking Cross","subject":"Theology"},
      {"title":"The Golden Mouth’s Clock: God’s Patient Judgment","subject":"Theology"},
      {"title":"Divine Governance: Love, Truth, and Free Will","subject":"Theology"}
    ]
    </script>
  </main>

  <script>
  (function(){
    const SUBJECT_LABEL = {
      Theology:"Theology", History:"History", Psychology:"Psychology",
      Philosophy:"Philosophy", Science:"Science", Art:"Art",
      Rationality:"Rationality", Misc:"Misc"
    };
    const uuidRe = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;

    const LS_STATE = "notebooks_catalog_subject_state_v1";
    const LS_LINKS = "notebooks_catalog_links_v1"; // key -> urlOrId

    function esc(s){return String(s||"").replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
    function slugify(s){return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");}

    function withDerivedId(item){return (item.id && item.id.trim()) ? item : {...item, id: slugify(item.title||"notebook")};}
    function normalizeSubject(s){return SUBJECT_LABEL[s] ? s : "Misc";}

    function loadDataInline(){
      const el=document.getElementById("notebooks-data");
      const txt=(el && el.textContent)||"[]";
      let j=[]; try{ j=JSON.parse(txt);}catch(_){}
      return j.map(r=>({ ...withDerivedId(r), subject: normalizeSubject(r.subject) }));
    }

    function loadState(){
      let st={search:"", activeSubjects:[]};
      try{ st = JSON.parse(localStorage.getItem(LS_STATE)||"{}") || st; }catch(_){}
      return {search: st.search||"", active: new Set(st.activeSubjects||[])};
    }
    function saveState(search, activeSet){
      localStorage.setItem(LS_STATE, JSON.stringify({search, activeSubjects:[...activeSet]}));
    }
    function loadLinks(){ try{ return JSON.parse(localStorage.getItem(LS_LINKS)||"{}"); }catch(_){ return {}; } }
    function saveLink(key, urlOrId){
      if(!urlOrId) return;
      urlOrId=String(urlOrId).trim();
      if(!/^https?:\/\//i.test(urlOrId) && !uuidRe.test(urlOrId)) return;
      const m=loadLinks(); m[key]=urlOrId;
      localStorage.setItem(LS_LINKS, JSON.stringify(m));
    }

    function computeHref(nb, savedMap){
      if(nb.url && /^https?:\/\//i.test(nb.url)) return nb.url;
      const key=(nb.title||"")+"||"+(nb.id||"");
      const saved=savedMap[key];
      if(saved){
        if(/^https?:\/\//i.test(saved)) return saved;
        if(uuidRe.test(saved)) return "https://notebooklm.google.com/notebook/"+saved;
      }
      if(nb.id && uuidRe.test(nb.id)) return "https://notebooklm.google.com/notebook/"+nb.id;
      return "";
    }

    // DOM refs
    const chipsEl=document.getElementById("chips");
    const resultsEl=document.getElementById("results");
    const countsEl=document.getElementById("counts");
    const qEl=document.getElementById("q");

    // build chips
    function buildSubjectChips(data, active){
      chipsEl.innerHTML="";
      const counts={};
      data.forEach(d=>{counts[d.subject]=(counts[d.subject]||0)+1;});
      const total=data.length;

      const all=document.createElement("button");
      all.className="chip"; all.dataset.subject="";
      all.setAttribute("aria-pressed", active.size===0?"true":"false");
      all.innerHTML=`<span>All</span><span class="badge">${total}</span>`;
      chipsEl.appendChild(all);

      ["Theology","History","Psychology","Rationality","Science","Art","Philosophy","Misc"].forEach(s=>{
        if(!counts[s]) return;
        const btn=document.createElement("button");
        btn.className="chip"; btn.dataset.subject=s;
        btn.setAttribute("aria-pressed", active.has(s)?"true":"false");
        btn.innerHTML=`<span>${s}</span><span class="badge">${counts[s]}</span>`;
        chipsEl.appendChild(btn);
      });
    }

    function openSafe(url){
      // fallback for iOS
      const w=window.open(url,"_blank","noopener,noreferrer");
      if(!w) location.href=url;
    }

    // render
    const data = loadDataInline();
    const st = loadState();
    qEl.value = st.search;
    buildSubjectChips(data, st.active);

    function apply(){
      const savedMap=loadLinks();
      const q=(qEl.value||"").toLowerCase().trim();
      const filtered = data.filter(d=>{
        if(st.active.size && !st.active.has(d.subject)) return false;
        if(!q) return true;
        return (d.title||"").toLowerCase().includes(q) || (d.id||"").toLowerCase().includes(q);
      }).sort((a,b)=> (a.subject.localeCompare(b.subject)) || (a.title||"").localeCompare(b.title||""));

      resultsEl.innerHTML="";
      filtered.forEach(nb=>{
        const key=(nb.title||"")+"||"+(nb.id||"");
        const href=computeHref(nb, savedMap);
        const missing=!href;
        const card=document.createElement("div");
        card.className="card"+(missing?" need-link":"");

        card.innerHTML=`
          <div class="flex items-start justify-between gap-3">
            <h3 class="text-base font-semibold leading-tight">${esc(nb.title||nb.id)}</h3>
            <span class="badge">${nb.subject}</span>
          </div>
          <p class="muted mt-1 text-sm">${esc(nb.id||"")}</p>
          <button class="mt-2 text-sm underline text-blue-600">${missing?"Add link":"Open"} →</button>
        `;

        const btn=card.querySelector("button");
        btn.addEventListener("click",(e)=>{
          e.stopPropagation();
          if(missing){
            const val=prompt("Paste the NotebookLM URL or the notebook ID (UUID):");
            if(val && val.trim()){
              saveLink(key, val.trim());
              apply();
            }
          }else{
            openSafe(href);
          }
        });
        card.addEventListener("click",()=>{ btn.click(); });

        resultsEl.appendChild(card);
      });

      countsEl.textContent = `${filtered.length} shown`;

      // refresh chip states
      chipsEl.querySelectorAll(".chip").forEach(ch=>{
        const s=ch.dataset.subject;
        ch.setAttribute("aria-pressed", s ? (st.active.has(s)?"true":"false") : (st.active.size===0?"true":"false"));
      });
    }

    // events
    chipsEl.addEventListener("click",(e)=>{
      const b=e.target.closest(".chip"); if(!b) return;
      const s=b.dataset.subject;
      if(!s) st.active.clear();
      else st.active.has(s) ? st.active.delete(s) : st.active.add(s);
      saveState(qEl.value, st.active);
      apply();
    });
    qEl.addEventListener("input", ()=>{
      saveState(qEl.value, st.active);
      apply();
    });

    // initial paint
    apply();
  })();
  </script>
</body>
</html>

