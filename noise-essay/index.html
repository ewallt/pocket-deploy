<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Course Template</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com/3.4.1?plugins=typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Default Theme: Newspaper */
        :root {
            --bg-gradient: #fdfdf8;
            --text: #1c1c1c;
            --accent-text: #8c1c13;
            --nav-bg: #f1f1eb;
            --nav-border: #dcdcd3;
            --nav-text: #1c1c1c;
            --nav-hover-bg: #e5e5dd;
            --nav-active-bg: #dcdcd3;
            --nav-active-text: #1c1c1c;
            --prose-text: var(--text);
            --prose-headings: var(--accent-text);
            --prose-links: var(--accent-text);
            --prose-bold: var(--text);
            font-family: 'Merriweather', serif;
        }

        .theme-emerald-paper, .theme-cyber-blue, .theme-emerald-gold {
            font-family: 'Lato', sans-serif;
        }
        
        body {
            background: var(--bg-gradient);
            color: var(--text);
            min-height: 100vh;
        }

        .ui-bg { background-color: var(--nav-bg); }
        .ui-border { border-color: var(--nav-border); }
        .text-primary { color: var(--text); }
        .text-accent { color: var(--accent-text); }

        .tab-button {
            background-color: var(--nav-bg);
            color: var(--nav-text);
            border-bottom: 3px solid transparent;
        }
        .tab-button:hover, .tab-button:focus-visible {
            background-color: var(--nav-hover-bg);
        }
        .tab-button.tab-active {
            background-color: var(--nav-active-bg);
            color: var(--nav-active-text);
            border-bottom-color: var(--accent-text);
        }

        .settings-button { background-color: var(--nav-hover-bg); }
        .settings-button:hover { opacity: 0.8; }
        *:focus-visible { outline: 3px solid var(--accent-text); outline-offset: 2px; }

        .prose { color: var(--prose-text); }
        .prose h2, .prose h3, .prose a, .prose strong { color: var(--prose-headings); }
        .prose p.lead { color: var(--prose-text); }
    </style>
</head>
<body class="transition-colors duration-300">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <header id="app-header" class="ui-bg border ui-border rounded-lg shadow-lg p-6 mb-6"></header>
        <nav id="app-tabs" class="ui-bg border ui-border rounded-lg shadow-lg mb-6" role="tablist" aria-label="Main navigation"></nav>
        <main id="app-panels" class="ui-bg border ui-border rounded-lg shadow-lg p-6 md:p-8"></main>
        
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="settings-title">
            <div class="ui-bg border ui-border rounded-lg p-6 max-w-md w-full shadow-2xl">
                <h2 id="settings-title" class="text-xl font-bold text-accent mb-4">Display Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="themeSelect" class="block text-primary font-semibold mb-2">Theme</label>
                        <select id="themeSelect" class="w-full px-3 py-2 rounded ui-bg border ui-border text-primary">
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button id="closeSettings" class="px-4 py-2 rounded text-primary hover:opacity-80">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 
    ============================================================
    vvvvvvvvvvvvvv PASTE YOUR JSON CONTENT BELOW vvvvvvvvvvvvvv
    ============================================================
    -->
    <script type="application/json" id="app-data">
{
  "decision-hygiene-essay": {
    "title": "Decision Hygiene: A System for Reducing Judgment Inconsistency",
    "description": "An analysis of how organizations can measure, reduce, and manage judgment inconsistency to build fairer and more effective systems.",
    "categories": {
      "unit-1-architecture-of-error": {
        "display_order": 10,
        "name": "Part I: The Architecture of Error",
        "display_name": "Part I",
        "paragraphs": [
          {
            "heading": "Two Forms of Judgment Error",
            "content": "Imagine a hospital where five experienced physicians independently evaluate the same set of patient cases for admission urgency. If all five consistently rate cases as more urgent than necessary, that’s bias—a systematic push in one direction. But if their ratings scatter widely around each case, with one physician rating a case as critical while another sees it as routine, that’s noise—inconsistent scatter in multiple directions. Both forms of error are costly, but they behave differently. Bias you can debate: “Are we too conservative in our lending?” Noise you must measure: “How much do our loan officers disagree on identical applications?” Organizations often focus on bias because it’s visible in aggregate statistics. Noise hides because each individual decision looks reasonable in isolation. Only when you line up multiple judgments on the same cases does the scatter become apparent."
          },
          {
            "heading": "The Reliability-Validity Hierarchy",
            "content": "Consider a recruiting firm evaluating candidates for software engineering roles. Validity asks whether their assessments predict actual job performance. Reliability asks whether different recruiters would make the same assessment of the same candidate. Here’s the crucial insight: an unreliable system cannot be valid for individuals, even if it’s unbiased on average. If two equally qualified recruiters would rate the same candidate as 3/5 and 5/5 respectively, then that candidate’s outcome depends on luck of assignment rather than merit. The system might hire the right percentage of candidates overall (unbiased), but specific candidates face a lottery. This is why Decision Hygiene prioritizes reliability—consistent assessment across evaluators and occasions—as the foundation for any valid judgment system."
          },
          {
            "heading": "Three Components of Noise",
            "content": "Noise isn’t monolithic; it has structure. Understanding this structure enables targeted interventions. Level noise appears when some judges are systematically harsher or more lenient than others. In a university grading system, Professor Chen might average 85% across all essays while Professor Kumar averages 75% for comparable work. Students’ grades depend partly on which section they register for. Pattern noise emerges from idiosyncratic disagreement. Two loan officers might have the same average approval rate but disagree case by case because they weight different factors—one prioritizes credit history, another cash flow patterns. Even with identical average stringency, their decisions diverge. Occasion noise reflects within-person inconsistency. The same radiologist reviewing the same scan six months apart might give different diagnoses, influenced by fatigue, recent cases, or even the weather. One study found judges give harsher sentences before lunch when blood sugar is low. Total system noise is the combination of these three components. A mortgage underwriting department might have loan officers who differ in baseline stringency (level), disagree on which applications are risky (pattern), and change their own standards from Monday to Friday (occasion). Each component calls for different remedies: calibration training for level differences, structured assessment protocols for pattern differences, and workflow standardization for occasion differences."
          }
        ]
      },
      "unit-2-measurement-system": {
        "display_order": 20,
        "name": "Part II: The Measurement System",
        "display_name": "Part II",
        "paragraphs": [
          {
            "heading": "Noise Audits: Making the Invisible Visible",
            "content": "A technology company wants to understand inconsistency in their technical interview process. They conduct a noise audit: ten senior engineers independently evaluate the same twenty recorded technical interviews, scoring candidates on problem-solving, code quality, communication, and overall hire recommendation. The audit reveals striking disparities. For the same candidate, problem-solving scores range from 2 to 5 (on a 5-point scale). Overall hire recommendations split 6-4 on half the candidates. When the company decomposes the noise, they find that level differences account for 30% (some interviewers are systematically tougher), pattern noise for 50% (interviewers weight different skills), and occasion noise for 20% (test-retest reliability is only 0.7). This measurement transforms a vague concern (“our interviews feel inconsistent”) into an actionable map. The company now knows that standardizing how different skills are weighted would provide the largest improvement, while calibration sessions could address the level differences."
          },
          {
            "heading": "Designing Effective Audits",
            "content": "The quality of a noise audit depends on several design choices. Case selection must represent real decisions—a mix of clear, borderline, and difficult cases. Independence is paramount: evaluators work separately, without discussion or visibility into others’ ratings. The audit should include duplicates (the same case presented twice with different identifiers) to measure occasion noise. Consider a medical clinic auditing triage decisions. They select 40 recent cases spanning the full range of urgency, remove identifying information, and have each of eight nurses independently assign triage levels. By including five duplicate cases, they can measure whether individual nurses are self-consistent. The resulting data reveals not just overall variability but also which types of cases generate the most disagreement."
          },
          {
            "heading": "From Measurement to Understanding",
            "content": "Raw dispersion metrics mean little to decision makers. A standard deviation of 1.2 points on a 5-point scale is abstract; knowing that the same loan application could receive interest rates varying by 2.5 percentage points makes the problem concrete. Similarly, reporting that criminal sentencing has an interquartile range of 18 months translates statistical noise into human consequences. Decomposition adds another layer of insight. A venture capital firm auditing their investment decisions discovers high pattern noise—partners agree on average quality but diverge completely on specific deals. This finding suggests that creating a common evaluation framework would help more than general calibration training. By contrast, if level noise dominated, the firm would focus on aligning partners’ overall risk tolerance."
          }
        ]
      },
      "unit-3-intervention-logic": {
        "display_order": 30,
        "name": "Part III: The Intervention Logic",
        "display_name": "Part III",
        "paragraphs": [
          {
            "heading": "Structuring Judgments Through Decomposition",
            "content": "Unstructured holistic judgment invites noise because evaluators notice different cues and weight them differently. The solution is to decompose complex judgments into Independent Mediating Assessments (IMAs)—specific sub-judgments that are evaluated separately before being combined. A medical diagnosis system might decompose “severity of condition” into: Symptom intensity (with behavioral anchors: 1 = mild discomfort, 3 = moderate limitation of daily activities, 5 = severe impairment), Symptom duration (1 = less than 48 hours, 3 = 3-7 days, 5 = more than two weeks), Risk factors present (scored by counting from a defined list), and Response to initial treatment (1 = complete resolution, 3 = partial improvement, 5 = no change or worsening). Each dimension has clear behavioral anchors rather than vague adjectives. Evaluators score each independently before making any overall assessment. This structure ensures that disagreement becomes diagnostic—you can identify whether doctors disagree on symptom interpretation or risk factor weighting."
          },
          {
            "heading": "The Power of Aggregation",
            "content": "When multiple independent judgments are combined, random errors tend to cancel out while signal reinforces. This mathematical fact drives one of Decision Hygiene’s most powerful tools: aggregation of independent assessments. A software company reviewing code changes could have three engineers independently evaluate each pull request on security, performance, and maintainability. The median of their scores will typically be more accurate than any individual assessment because each engineer’s unique blind spots and pet concerns get diluted in the aggregate. The key word is “independent.” If engineers discuss before rating, if they can see each other’s scores, or if they’re primed by a senior’s opinion, the aggregation loses its error-canceling power. This is why Decision Hygiene protocols sequence work as: independent assessment → aggregation → discussion only if needed."
          },
          {
            "heading": "Mechanical Rules and Algorithms",
            "content": "For decisions with sufficient historical data, simple mechanical rules often outperform holistic expert judgment. A credit union might develop a scorecard that weights five factors: debt-to-income ratio (30%), payment history (25%), employment stability (20%), cash reserves (15%), and loan purpose (10%). The same inputs always produce the same output, eliminating occasion noise entirely. These rules need not be complex. Research consistently shows that simple linear models with 4-7 variables match or beat expert predictions in domains from medical diagnosis to criminal recidivism. The advantage isn’t that algorithms are smarter; it’s that they’re perfectly consistent. They don’t have bad days, don’t get anchored by recent cases, and don’t drift over time."
          },
          {
            "heading": "Calibration and Feedback Loops",
            "content": "A financial advisory firm implements quarterly calibration sessions. All advisors independently rate the same set of ten client scenarios for risk tolerance. After rating, they see the distribution of responses and discuss only where they applied rating anchors differently, not their personal philosophies about risk. Over time, these sessions create convergence. Advisors learn that “moderate risk tolerance” means willing to accept 15-20% portfolio volatility, not whatever feels moderate to them personally. They discover that colleague Martinez consistently rates risk tolerance one point lower than the team median and can adjust accordingly. The calibration isn’t about right or wrong answers; it’s about common language and consistent application."
          }
        ]
      },
      "unit-4-organizational-design": {
        "display_order": 40,
        "name": "Part IV: Organizational Design for Sustained Reliability",
        "display_name": "Part IV",
        "paragraphs": [
          {
            "heading": "Roles and Accountability Structures",
            "content": "Decision Hygiene requires clear organizational roles. The Decision Owner is accountable for outcomes—did loans perform as expected? The Decision Steward maintains the judgment system—are assessments consistent? These roles must be separate because owners focused on results rarely have bandwidth to maintain measurement and calibration systems. A hospital’s surgical scheduling committee illustrates this division. The Chief of Surgery (Decision Owner) is accountable for patient outcomes and OR utilization. The Quality Improvement Director (Decision Steward) owns the scheduling priority rubric, runs monthly calibration sessions, and audits decision consistency. This separation ensures that someone is explicitly responsible for reliability, not just results."
          },
          {
            "heading": "Incentive Alignment",
            "content": "What gets measured gets managed, but what gets rewarded gets done. If a customer service team is evaluated solely on tickets closed, they’ll optimize for speed over consistency. Adding reliability metrics to performance scorecards—agreement rates on test cases, stability in quality audits—creates incentives for consistency alongside productivity. Consider an insurance claims department that adds “decision consistency score” to its quarterly reviews, weighted at 20% alongside traditional metrics like processing time and customer satisfaction. Adjusters who maintain high agreement rates with peer consensus on standardized test cases receive recognition and advancement priority. Within two quarters, overall claims variance drops by 35% without any decrease in processing speed."
          },
          {
            "heading": "Building Institutional Memory",
            "content": "Organizations lose hard-won consistency gains when experienced staff leave or new policies arrive. Version control and documentation preserve these gains. Every rubric, scale, and aggregation rule should have a version number, change log, and rationale document. When a consulting firm updates their project evaluation framework from v2.3 to v2.4, they document: what changed (added a “stakeholder alignment” dimension), why (post-mortem analysis showed this predicted project success), expected impact (reduce false positives by 20%), and rollback criteria (if agreement drops below 0.7). This discipline transforms organizational learning from oral tradition to engineered system."
          },
          {
            "heading": "The Rhythm of Reliability",
            "content": "Reliability requires regular maintenance, not one-time fixes. Organizations should establish a “reliability rhythm”: Weekly: Spot checks on 3-5 recent decisions. Monthly: Calibration session on standardized cases. Quarterly: Noise audit on larger sample. Annually: Full system review and update. A law firm reviewing contract risk might spot-check five assessments each Monday, run a 30-minute calibration session on the first Friday of each month, conduct a 50-case noise audit each quarter, and annually review whether their risk dimensions still predict actual disputes."
          }
        ]
      },
      "unit-5-integration-implementation": {
        "display_order": 50,
        "name": "Part V: Integration and Implementation",
        "display_name": "Part V",
        "paragraphs": [
          {
            "heading": "The Implementation Sequence",
            "content": "Decision Hygiene follows a logical implementation sequence, where each phase enables the next: 1. Measure baseline noise through an audit to understand the current state. 2. Design structured assessments with IMAs and behavioral anchors. 3. Pilot the new system with a subset of decisions while maintaining controls. 4. Monitor and refine based on measured variance reduction. 5. Scale and sustain through organizational routines and incentives. A telehealth company implementing Decision Hygiene for patient triage follows this sequence over twelve weeks. Weeks 1-2: audit reveals 40% disagreement rate on urgency classifications. Weeks 3-4: design structured assessment with five IMAs. Weeks 5-8: pilot with half of nurses while maintaining old system for comparison. Weeks 9-10: refine based on results showing 60% noise reduction. Weeks 11-12: roll out system-wide with sustainability plan."
          },
          {
            "heading": "Managing Resistance and Change",
            "content": "Professionals often resist Decision Hygiene, viewing structure as an attack on expertise. The key is framing: structure doesn’t replace judgment; it channels judgment toward the decisions that matter while removing unwanted variability from decisions that should be consistent. An architecture firm implementing structured design reviews addresses resistance by emphasizing that creativity remains unstructured—the generation of design options—while evaluation becomes more consistent. Architects still exercise full creative freedom in designing solutions, but they evaluate those solutions using common criteria with defined scales. This preserves professional autonomy where variation adds value while adding consistency where variation is error."
          },
          {
            "heading": "Balancing Consistency and Flexibility",
            "content": "Not all variability is noise. A mental health clinic must balance consistency in diagnosis with flexibility in treatment approach. The solution is to be explicit about where consistency matters and where customization is valuable. The clinic might require structured assessment for diagnosis (using validated symptom checklists and severity scales) while preserving therapist discretion in treatment modality selection. They can measure whether two clinicians would assign the same diagnosis (should be highly consistent) separately from whether they would recommend the same treatment approach (may legitimately vary based on therapist expertise and patient preference)."
          }
        ]
      }
    }
  }
}
    </script>
    <!-- 
    ============================================================
    ^^^^^^^^^^^^^^ PASTE YOUR JSON CONTENT ABOVE ^^^^^^^^^^^^^^
    ============================================================
    -->

    <script defer>
    document.addEventListener('DOMContentLoaded', () => {

        const THEMES = {
          'newspaper': { 
            name: 'Newspaper', 
            type: 'classic', 
            isDark: false 
          },
          'emerald-paper': {
            name: 'Emerald Paper', 
            type: 'variable', 
            isDark: false,
            vars: {
              '--bg-gradient': '#f7fbf9', '--text': '#1e2b28', '--accent-text': '#0f7f6d', '--nav-bg': '#e7f3ef',
              '--nav-border': '#86c8ba', '--nav-text': '#1e2b28', '--nav-hover-bg': '#d7ece6', '--nav-active-bg': '#bfe3d9',
              '--nav-active-text': '#1e2b28', '--prose-text': '#1e2b28', '--prose-headings': '#0f7f6d'
            }
          },
          'cyber-blue': {
            name: 'Cyber Night', 
            type: 'variable', 
            isDark: true,
            vars: {
              '--bg-gradient': 'rgb(2, 6, 23)',
              '--text': 'rgb(203, 213, 225)',
              '--accent-text': 'rgb(203, 213, 225)',
              '--nav-bg': 'rgb(30, 41, 59)',
              '--nav-border': 'rgb(51, 65, 85)',
              '--nav-text': 'rgb(203, 213, 225)',
              '--nav-hover-bg': 'rgb(15, 23, 42)',
              '--nav-active-bg': 'rgb(51, 65, 85)',
              '--nav-active-text': '#FFFFFF',
              '--prose-text': 'rgb(203, 213, 225)',
              '--prose-headings': '#FFFFFF'
            }
          },
          'emerald-gold': {
            name: 'Emerald/Gold', 
            type: 'variable', 
            isDark: true,
            vars: {
              '--bg-gradient': 'linear-gradient(135deg,#022c22 0%,#064e3b 60%,#065f46 100%)', '--text': '#ecfdf5',
              '--accent-text': '#f0c475', '--nav-bg': '#064e3b', '--nav-border': '#d4a24c', '--nav-text': '#ecfdf5',
              '--nav-hover-bg': '#065f46', '--nav-active-bg': '#0b3d31', '--nav-active-text': '#f0c475',
              '--prose-text': '#a7f3d0', '--prose-headings': '#f0c475'
            }
          }
        };

        const app = {
            root: document.documentElement,
            header: document.getElementById('app-header'),
            tabs: document.getElementById('app-tabs'),
            panels: document.getElementById('app-panels'),
            settings: {
                modal: document.getElementById('settingsModal'),
                closeBtn: document.getElementById('closeSettings'),
                themeSelect: document.getElementById('themeSelect')
            }
        };

        const state = { activeTab: null, theme: 'newspaper' };

        const loadState = () => {
            state.theme = localStorage.getItem('appTheme') || 'newspaper';
            state.activeTab = localStorage.getItem('activeTab');
        };

        const saveState = () => {
            localStorage.setItem('appTheme', state.theme);
            localStorage.setItem('activeTab', state.activeTab);
        };

        const applyTheme = (themeKey) => {
            const theme = THEMES[themeKey];
            if (!theme) return;

            app.root.className = '';
            app.root.style.cssText = '';

            if (theme.type === 'variable' && theme.vars) {
                for (const [key, value] of Object.entries(theme.vars)) {
                    app.root.style.setProperty(key, value);
                }
                app.root.classList.add(`theme-${themeKey}`);
            }

            state.theme = themeKey;
            if (app.settings.themeSelect.value !== themeKey) {
                app.settings.themeSelect.value = themeKey;
            }
            saveState();
        };

        const populateThemeSelector = () => {
            app.settings.themeSelect.innerHTML = Object.entries(THEMES).map(([key, theme]) => 
                `<option value="${key}">${theme.name}</option>`
            ).join('');
        };

        const loadAndTransformData = () => {
            try {
                const dataNode = document.getElementById('app-data');
                if (!dataNode.textContent.trim()) {
                    console.error("JSON data is empty.");
                    return null;
                }
                const rawData = JSON.parse(dataNode.textContent);
                
                const topLevelKey = Object.keys(rawData)[0];
                if (!topLevelKey) {
                    console.error("JSON data is missing a top-level key.");
                    return null;
                }
                const course = rawData[topLevelKey];
                
                const units = Object.entries(course.categories).map(([id, unitData]) => ({ id, ...unitData }))
                    .sort((a, b) => a.display_order - b.display_order);
                return { meta: { title: course.title, description: course.description }, units };
            } catch (e) {
                console.error("Failed to load or transform app data:", e);
                app.panels.innerHTML = `<div class="p-4 text-red-500 bg-red-100 rounded"><strong>Error:</strong> Could not load content. Please ensure the JSON is correctly formatted and pasted into the data island.</div>`;
                return null;
            }
        };
        
        const data = loadAndTransformData();
        
        if (!data) return;

        const renderHeader = () => {
            document.title = data.meta.title || "Interactive Course";
            
            app.header.innerHTML = `
                <div class="flex justify-between items-start gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-accent">${data.meta.title}</h1>
                        <p class="mt-2 text-primary/80">${data.meta.description}</p>
                    </div>
                    <button id="settingsBtn" class="flex-shrink-0 p-3 rounded-lg settings-button transition-opacity" aria-label="Display Settings">
                        <span class="text-2xl text-accent">⚙️</span>
                    </button>
                </div>`;
        };
        
        const renderTabs = () => {
            app.tabs.innerHTML = `<div class="flex flex-wrap">${
                data.units.map(unit => `
                    <button role="tab" aria-selected="false" aria-controls="${unit.id}-panel" id="${unit.id}-tab"
                            class="px-5 py-3 font-semibold transition-colors tab-button">
                        ${unit.display_name}
                    </button>`
                ).join('')
            }</div>`;
        };

        const renderPanels = () => {
            app.panels.innerHTML = data.units.map(unit => {
                const introHTML = unit.introduction ? `<p class="lead">${unit.introduction}</p>` : '';
                const paragraphsHTML = (unit.paragraphs || []).map(p => `
                    <h3>${p.heading}</h3>
                    <p>${p.content}</p>
                `).join('');
                const proseClasses = THEMES[state.theme].isDark ? 'prose prose-lg max-w-none prose-invert' : 'prose prose-lg max-w-none';
                return `
                    <div role="tabpanel" id="${unit.id}-panel" aria-labelledby="${unit.id}-tab" hidden>
                        <div class="${proseClasses}">
                            <h2>${unit.name}</h2>
                            ${introHTML}
                            ${paragraphsHTML}
                        </div>
                    </div>`;
            }).join('');
        };

        const switchTab = (tabId) => {
            if (!data.units.some(u => u.id === tabId)) {
                tabId = data.units[0]?.id;
            }
            if (!tabId) return;

            app.tabs.querySelectorAll('[role="tab"]').forEach(tab => {
                const isActive = tab.id === `${tabId}-tab`;
                tab.setAttribute('aria-selected', isActive);
                tab.classList.toggle('tab-active', isActive);
            });

            app.panels.querySelectorAll('[role="tabpanel"]').forEach(panel => {
                panel.hidden = panel.id !== `${tabId}-panel`;
            });
            
            state.activeTab = tabId;
            saveState();
        };

        const setupEventListeners = () => {
            app.tabs.addEventListener('click', e => {
                const tab = e.target.closest('[role="tab"]');
                if (tab) switchTab(tab.id.replace('-tab', ''));
            });

            app.header.addEventListener('click', e => {
                if (e.target.closest('#settingsBtn')) {
                    app.settings.modal.classList.remove('hidden');
                    app.settings.themeSelect.focus();
                }
            });
            
            const closeModal = () => {
                app.settings.modal.classList.add('hidden');
                document.getElementById('settingsBtn')?.focus();
            };
            app.settings.closeBtn.addEventListener('click', closeModal);
            app.settings.modal.addEventListener('keydown', e => {
                if (e.key === 'Escape') closeModal();
            });

            app.settings.themeSelect.addEventListener('change', (e) => {
                applyTheme(e.target.value);
                renderPanels();
                const activePanel = document.getElementById(`${state.activeTab}-panel`);
                if(activePanel) activePanel.hidden = false;
            });
        };

        const init = () => {
            loadState();
            populateThemeSelector();
            applyTheme(state.theme);
            renderHeader();
            renderTabs();
            renderPanels();
            setupEventListeners();
            switchTab(state.activeTab || data.units[0]?.id);
        };

        init();
    });
    </script>
</body>
</html>

