<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waterloo Knowledge Base Explorer</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg,#2c3e50 0%,#34495e 100%);
            --accent-1: #e74c3c;
            --accent-2: #c03b2b;
            --btn-gradient: linear-gradient(45deg,#e74c3c,#c0392b);
            --accent-1-rgb: 231, 76, 60;
            --accent-warning: #ffc107;
            --accent-warning-rgb: 255, 193, 7;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 2rem;
            text-align: center;
            border-bottom: 3px solid var(--accent-1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 15px rgba(var(--accent-1-rgb), 0.3));
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* --- FINAL BUTTON RULES START --- */

        /* Base style for ALL buttons */
        .tab-button, #settings-btn, .sector-button {
            padding: 12px 24px;
            background: var(--ui-background);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Specific settings for the icon */
        #settings-btn {
            font-size: 1.2rem;
            padding: 10px 15px;
        }

        /* HOVER state for buttons */
        .tab-button:hover, .sector-button:hover, #settings-btn:hover {
            background: var(--btn-gradient);
            transform: translateY(-2px);
        }

        /* ACTIVE state for selected buttons */
        .tab-button.active, .sector-button.active {
            background: var(--btn-gradient);
            border-color: var(--accent-2);
            transform: translateY(-2px);
            color: var(--btn-text-active);
        }

        /* LOGIC-DRIVEN TEXT COLOR FOR HOVER AND ACTIVE STATES */
        .btn-light-text:hover, .btn-light-text.active {
             color: var(--text-primary);
        }
        .btn-dark-text:hover, .btn-dark-text.active {
             color: var(--btn-text-active);
        }
        
        /* --- FINAL BUTTON RULES END --- */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: #2c3e50;
            padding: 2rem;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
            position: relative;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 {
            color: var(--accent-1);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        
        .modal-content label {
            font-size: 1.1rem;
            margin-right: 10px;
        }

        #theme-select {
            background-color: var(--ui-background);
            color: var(--text-primary);
            border: 1px solid var(--accent-2);
            border-radius: 5px;
            padding: 8px;
            font-size: 1rem;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--text-primary);
            text-decoration: none;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .section-title {
            color: var(--accent-1);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-1);
        }

        .subsection {
            margin: 1.5rem 0;
        }

        .subsection h3 {
            color: var(--accent-1);
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
        }

        .subsection h4 {
            color: var(--accent-2);
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem 0;
        }

        .sector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .sector-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-1);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sector-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
        }

        .sector-name {
            color: var(--accent-1);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .casualties-highlight {
            background: rgba(var(--accent-warning-rgb), 0.15);
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid var(--accent-warning);
            margin: 1rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

           .stat-card {
            background: var(--ui-background-accent);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-1);
            display: block;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* --- TIMELINE STYLES START --- */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin-top: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent-1);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.05rem;
            top: 5px;
            width: 12px;
            height: 12px;
            background: var(--accent-1);
            border-radius: 50%;
            border: 2px solid var(--ui-background);
        }

        .timeline-time {
            color: var(--accent-1);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        /* --- TIMELINE STYLES END --- */


        .search-box {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .search-box::placeholder {
            color: var(--text-secondary);
        }

        .highlight {
            background: rgba(var(--accent-1-rgb), 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .interactive-map {
            background: var(--container-background-subtle);
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sector-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .sector-detail {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .sector-detail.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            .container {
                padding: 1rem;
            }
            .sector-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script>
    // Self-executing function to manage all theme logic.
    (function() {
        const DEFAULT_THEME_NAME = 'cyber-blue';
    
        let THEMES = {
            'cyber-blue': {
                '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
                '--accent-1': '#a8b8d0', '--accent-1-rgb': '168, 184, 208',
                '--accent-2': '#8899b3',
                '--btn-gradient': 'linear-gradient(45deg,#1a1a3a,#2e2e5e)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'teal-matrix': {
                '--bg-gradient': 'linear-gradient(135deg,#0a231c 0%,#1a3a31 50%,#2e5e50 100%)',
                '--accent-1': '#ace0d5', '--accent-1-rgb': '172, 224, 213',
                '--accent-2': '#92b3a9',
                '--btn-gradient': 'linear-gradient(45deg,#1a3a31,#2e5e50)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#345e55',
                '--ui-background-accent': 'rgba(52, 94, 85, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'red-alert': {
                '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#e74c3c',
                '--accent-2': '#c03b2b',
                '--btn-gradient': 'linear-gradient(45deg,#e74c3c,#c0392b)',
                '--accent-1-rgb': '231, 76, 60',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--btn-text-active': '#ffffff'
            },
            'scorched-gold': {
                '--bg-gradient': 'linear-gradient(135deg,#0a231f 0%,#193a33 50%,#2e5e54 100%)',
                '--ui-background': '#345e56',
                '--ui-background-accent': 'rgba(52, 94, 86, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#f0c475',
                '--accent-2': '#d4a24c',
                '--btn-gradient': 'linear-gradient(45deg,#f0c475,#d4a24c)',
                '--accent-1-rgb': '240, 196, 117',
                '--btn-text-active': '#2a1d15',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57'
            }
        };

        function finalizeThemes(themes) {
            for (const themeName in themes) {
                const theme = themes[themeName];
                const gradient = theme['--btn-gradient'];

                if (gradient.includes('#d') || gradient.includes('#e') || gradient.includes('#f')) {
                    theme.hover_style = 'btn-dark-text'; 
                } else {
                    theme.hover_style = 'btn-light-text';
                }
            }
            return themes;
        }

        THEMES = finalizeThemes(THEMES);
    
        function applyTheme(name) {
            const theme = THEMES[name];
            if (theme) {
                const root = document.documentElement;
                for (const [key, value] of Object.entries(theme)) {
                    if(key !== 'hover_style') {
                        root.style.setProperty(key, value);
                    }
                }

                const buttons = document.querySelectorAll('.tab-button, .sector-button, #settings-btn');
                buttons.forEach(button => {
                    button.classList.remove('btn-light-text', 'btn-dark-text');
                    if (theme.hover_style) {
                        button.classList.add(theme.hover_style);
                    }
                });
            }
        }
    
        window.setTheme = function(name) {
            applyTheme(name);
            localStorage.setItem('waterloo-theme', name);
        }
    
        const availableThemeNames = Object.keys(THEMES);
        const savedTheme = localStorage.getItem('waterloo-theme');
        let themeToLoad = DEFAULT_THEME_NAME;

        if (savedTheme && availableThemeNames.includes(savedTheme)) {
            themeToLoad = savedTheme;
        }
        
        applyTheme(themeToLoad);
    
        document.addEventListener('DOMContentLoaded', () => {
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                themeSelect.innerHTML = '';
                availableThemeNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    themeSelect.appendChild(option);
                });
                themeSelect.value = themeToLoad;
            }
        });
    })();
    </script>
</head>
<body>
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="close-btn">&times;</button>
            <h3>Display Settings</h3>
            <label for="theme-select">Theme:</label>
            <select id="theme-select" onchange="setTheme(this.value)"></select>
        </div>
    </div>

    <div class="header">
        <h1>The Battle of Waterloo</h1>
        <p>June 18, 1815 • The End of an Era • Knowledge Base Explorer</p>
    </div>

    <div class="nav-tabs">
        <button class="tab-button active" data-tab="overview">Overview</button>
        <button class="tab-button" data-tab="prelude">Prelude & Armies</button>
        <button class="tab-button" data-tab="sectors">Key Sectors</button>
        <button class="tab-button" data-tab="prussians">The Prussian Arrival</button>
        <button class="tab-button" data-tab="casualties">Casualties & Aftermath</button>
        <button class="tab-button" data-tab="search">Search Knowledge</button>
        <button id="settings-btn" title="Settings">⚙️</button>
    </div>

    <div class="container">
        <div id="overview" class="tab-content active">
             <div class="section-card">
                <h2 class="section-title">The Battle of Waterloo: A Titan's Last Stand</h2>
                <p style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 2rem;">
                    On June 18, 1815, near the village of Waterloo in present-day Belgium, the fate of Europe was decided. The French army under Emperor Napoleon Bonaparte met the forces of the Seventh Coalition, commanded by the Duke of Wellington and Gebhard von Blücher. The battle marked the final, bloody end to the Napoleonic Wars and the emperor's reign.
                </p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">~72,000</span>
                        <div class="stat-label">French Army Strength</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~68,000</span>
                        <div class="stat-label">Anglo-Allied Army Strength</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~50,000</span>
                        <div class="stat-label">Arriving Prussian Strength</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">&gt;45,000</span>
                        <div class="stat-label">Total Casualties (All Armies)</div>
                    </div>
                </div>

                <div class="interactive-map">
                    <h3 style="color: var(--accent-1); margin-bottom: 1rem;">Key Sectors of the Battlefield</h3>
                    <p>Click on each sector to learn more about the specific engagements:</p>
                    <div class="sector-buttons">
                        <button class="sector-button" data-sector="hougoumont">Château d'Hougoumont</button>
                        <button class="sector-button" data-sector="haye-sainte">La Haye Sainte</button>
                        <button class="sector-button" data-sector="french-assaults">French Center Assaults</button>
                        <button class="sector-button" data-sector="plancenoit">Plancenoit</button>
                    </div>

                    <div id="hougoumont-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">Château d'Hougoumont</h4>
                        <p><strong>Forces:</strong> British Coldstream Guards & Nassauers vs. Jérôme Bonaparte's Division</p>
                        <p><strong>Significance:</strong> A brutal, day-long struggle for a fortified farmhouse on the Allied right flank. Wellington called the closing of the North Gate the decisive moment of the battle.</p>
                    </div>
                    <div id="haye-sainte-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">La Haye Sainte</h4>
                        <p><strong>Forces:</strong> King's German Legion vs. elements of d'Erlon's I Corps</p>
                        <p><strong>Significance:</strong> This central farmhouse fell to the French late in the day, allowing them to bring artillery forward and threaten the Allied center, creating a crisis for Wellington.</p>
                    </div>
                    <div id="french-assaults-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">French Center Assaults</h4>
                        <p><strong>Forces:</strong> d'Erlon's I Corps & Kellermann's Cavalry vs. Picton's Division & the Union/Household Brigades</p>
                        <p><strong>Significance:</strong> Massive infantry and cavalry attacks against the Allied center were repulsed at great cost, including the disastrous charge of the British heavy cavalry.</p>
                    </div>
                    <div id="plancenoit-detail" class="sector-detail">
                        <h4 style="color: var(--accent-1);">The Village of Plancenoit</h4>
                        <p><strong>Forces:</strong> Prussian IV Corps (Bülow) vs. French Young Guard & VI Corps (Lobau)</p>
                        <p><strong>Significance:</strong> A desperate battle for control of the village on Napoleon's right flank, drawing in his vital reserves (the Imperial Guard) and preventing them from being used in the final assault on Wellington.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="prelude" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Hundred Days: Prelude to Battle</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">Napoleon's Return</h3>
                        <p>After escaping from his exile on the island of Elba, Napoleon Bonaparte returned to France in March 1815, raising an army and reclaiming his title as Emperor. The Great Powers of Europe, assembled at the Congress of Vienna, declared him an outlaw and formed the Seventh Coalition to depose him once and for all.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">The Commanders</h3>
                        <p><strong>French:</strong> Emperor Napoleon Bonaparte</p>
                        <p><strong>Anglo-Allied:</strong> Arthur Wellesley, Duke of Wellington</p>
                        <p><strong>Prussian:</strong> Gebhard von Blücher, Prince of Wahlstatt</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">Strategic Situation</h3>
                        <p>Napoleon's only hope was to strike first, dividing the Allied and Prussian armies in Belgium before they could unite with much larger Austrian and Russian forces. His strategy was to defeat them in detail, forcing a swift peace.</p>
                    </div>
                </div>
                <div class="subsection">
                    <h3 class="section-title">Timeline to Waterloo</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-time">June 15, 1815</div>
                            <h4>Napoleon Crosses the Sambre</h4>
                            <p>The French Armée du Nord crosses the river Sambre at Charleroi, surprising the Coalition and driving a wedge between Wellington's and Blücher's armies.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">June 16, 1815</div>
                            <h4>The Twin Battles</h4>
                            <p>Napoleon defeats Blücher's Prussians at the Battle of Ligny, while Marshal Ney engages Wellington at the Battle of Quatre Bras, preventing him from aiding the Prussians.</p>
                        </div>
                         <div class="timeline-item">
                            <div class="timeline-time">June 17, 1815</div>
                            <h4>The Retreat in the Rain</h4>
                            <p>Wellington retreats north to a defensive ridge he had scouted near Waterloo. A torrential thunderstorm turns the fields to mud, delaying Napoleon's pursuit and forcing a late start to the battle on the 18th.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sectors" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">The Main Battle - June 18, 1815</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <div class="sector-name">Château d'Hougoumont</div>
                        <p>The battle began around 11:30 AM with a diversionary attack on this fortified farmhouse. It became a battle-within-a-battle, sucking in thousands of French troops for the entire day and never falling.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">d'Erlon's Corps Attacks</div>
                        <p>Around 1:30 PM, the main French infantry attack began. 16,000 men from d'Erlon's I Corps advanced on Wellington's left-center, but were shattered by a counter-charge from British heavy cavalry.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">The Great Cavalry Charges</div>
                        <p>Mistaking Allied movement for a retreat, Marshal Ney led massive, unsupported cavalry charges against the Allied center. The Allied infantry formed squares and, with artillery support, repelled charge after charge.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">The Fall of La Haye Sainte</div>
                        <p>Around 6:00 PM, the crucial central farmhouse of La Haye Sainte finally fell to the French after its defenders ran out of ammunition. This was the moment of greatest crisis for Wellington's army.</p>
                    </div>
                    <div class="sector-card">
                        <div class="sector-name">The Guard Attacks</div>
                        <p>Around 7:30 PM, Napoleon committed his last reserve: the elite Imperial Guard. Their final, desperate assault was repulsed by Allied Guards and Dutch troops. The sight of the Guard retreating broke the morale of the French army.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="prussians" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">"Night or the Prussians Must Come"</h2>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">Bülow's IV Corps Attacks Plancenoit</h3>
                        <p>The first Prussian forces under von Bülow arrived around 4:30 PM and began attacking the village of Plancenoit on Napoleon's eastern flank. This fight drew off Napoleon's key reserves, including units of the Imperial Guard, which were desperately needed for the main assault on Wellington.</p>
                    </div>
                    <div class="sector-card">
                        <h3 class="sector-name">Zieten's I Corps Arrives</h3>
                        <p>Later in the evening, as Wellington's line was near breaking, Zieten's Prussian corps arrived and directly reinforced the battered Allied left flank. This arrival secured the line and allowed Wellington to move his own reserves to counter the Imperial Guard's final attack.</p>
                    </div>
                </div>
                <div class="subsection">
                    <h3>Strategic Impact</h3>
                    <p style="font-size: 1.1rem; line-height: 1.7;">
                        The Prussian arrival was absolutely decisive. By engaging Napoleon's flank and absorbing his reserves, they prevented the Emperor from delivering a knockout blow to Wellington's army. Their reinforcement of the Allied line in the final hour sealed the French army's fate and turned a potential stalemate into a catastrophic rout.
                    </p>
                </div>
            </div>
        </div>

        <div id="casualties" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Casualties & Aftermath</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">~25,000</span>
                        <div class="stat-label">French Casualties (K/W/C)</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">~15,000</span>
                        <div class="stat-label">Anglo-Allied Casualties (K/W/C)</div>
                    </div>
                     <div class="stat-card">
                        <span class="stat-number">~7,000</span>
                        <div class="stat-label">Prussian Casualties (K/W/C)</div>
                    </div>
                </div>
                <div class="sector-grid">
                    <div class="sector-card">
                        <h3 class="sector-name">The Rout of the Armée du Nord</h3>
                        <p>As the Imperial Guard retreated, the entire French army dissolved into a panicked rout, pursued relentlessly through the night by the Prussian cavalry.</p>
                    </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Napoleon's Second Abdication</h3>
                         <p>Napoleon fled to Paris, but with his army destroyed, his political support vanished. He abdicated for the second and final time on June 22, 1815.</p>
                    </div>
                     <div class="sector-card">
                        <h3 class="sector-name">Exile and the End of an Era</h3>
                         <p>Surrendering to the British, Napoleon was exiled to the remote South Atlantic island of Saint Helena, where he died in 1821. The battle ushered in a long period of relative peace in Europe, often called the "Concert of Europe."</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="search" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">Search the Knowledge Base</h2>
                <input type="text" id="searchInput" class="search-box" placeholder="Search for people, places, units, or any topic...">
                
                <div id="searchResults">
                    <p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">
                        Enter a search term above to explore the Waterloo knowledge base.<br>
                        Try searching for: "Napoleon", "Wellington", "Imperial Guard", "Ney", "Hougoumont", etc.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Knowledge base for searching
        const knowledgeBase = {
            "Napoleon": "Napoleon Bonaparte, former Emperor of the French, returned from exile to lead the Armée du Nord. Waterloo was his final battle.",
            "Wellington": "Arthur Wellesley, the 1st Duke of Wellington, commanded the multi-national Anglo-Allied army. He famously chose the battlefield for its defensive advantages, particularly the reverse slope.",
            "Blücher": "Gebhard von Blücher, commander of the Prussian army. Despite being defeated two days earlier at Ligny, the 72-year-old Field Marshal rallied his troops to march to Wellington's aid.",
            "Ney": "Marshal Michel Ney, known as the 'Bravest of the Brave,' commanded the French left wing. At Waterloo, he led the massive but ill-fated cavalry charges against the Allied center.",
            "Hougoumont": "A fortified farmhouse on the Allied right flank. Wellington considered the successful defense of Hougoumont, particularly the closing of its north gate, to be the key to winning the battle.",
            "La Haye Sainte": "A farmhouse in the center of the Allied line. Its capture by the French late in the day created a severe crisis for Wellington, as it allowed French artillery to hammer his center at close range.",
            "Plancenoit": "A village on Napoleon's right flank. The struggle for Plancenoit between the arriving Prussians and the French Young Guard was a critical side-battle that absorbed Napoleon's vital reserves.",
            "Imperial Guard": "Napoleon's elite veteran force. Their final assault on the Allied line was the battle's climax. When they were repulsed and seen retreating, the morale of the French army collapsed.",
            "Grognards": "French for 'Grumblers,' this was the nickname for the veterans of the Old Guard, the most elite soldiers in Napoleon's army.",
            "d'Erlon": "Jean-Baptiste Drouet, Comte d'Erlon, commanded the French I Corps. His massive infantry assault on the Allied left-center was decisively broken by a charge from the British Heavy Cavalry.",
            "Uxbridge": "The Earl of Uxbridge commanded the British cavalry. He led the successful but reckless charge of the Heavy Cavalry and lost his leg to one of the last cannon shots of the day.",
            "Picton": "General Sir Thomas Picton commanded the British 5th Division. A famously aggressive veteran of the Peninsular War, he was killed while leading a counter-attack against d'Erlon's corps.",
            "Reverse Slope": "Wellington's signature defensive tactic. He placed the bulk of his troops on the reverse side of a ridge, protecting them from the worst effects of French artillery fire until they were needed.",
            "Infantry Square": "A tactical formation used by infantry to resist cavalry charges. The Anglo-Allied army formed dozens of squares to successfully repel Marshal Ney's cavalry attacks.",
            "The Hundred Days": "The period between Napoleon's return from exile on March 20, 1815, and the second restoration of King Louis XVIII on July 8, 1815. The Waterloo Campaign was the military culmination of this period.",
            "Ligny": "The Battle of Ligny was fought on June 16, 1815, two days before Waterloo. It was Napoleon's last victory, where he defeated Blücher's Prussian army.",
            "Quatre Bras": "Fought on the same day as Ligny, the Battle of Quatre Bras was an engagement where Wellington's forces held off Marshal Ney, preventing him from assisting Napoleon at Ligny."
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeSectorButtons();
            initializeSearch();
            initializeModal();
        });

        function initializeModal() {
            const modal = document.getElementById('settings-modal');
            const openBtn = document.getElementById('settings-btn');
            const closeBtn = document.getElementById('close-modal-btn');

            if (modal && openBtn && closeBtn) {
                openBtn.addEventListener('click', () => {
                    modal.classList.add('show');
                });

                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });

                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            }
        }

        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        }

        function showTab(tabName) {
            try {
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(content => {
                    if (content && content.classList) {
                        content.classList.remove('active');
                    }
                });

                const tabButtons = document.querySelectorAll('.tab-button');
                tabButtons.forEach(button => {
                    if (button && button.classList) {
                        button.classList.remove('active');
                    }
                });

                const targetTab = document.getElementById(tabName);
                if (targetTab && targetTab.classList) {
                    targetTab.classList.add('active');
                }

                const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
                if (activeButton && activeButton.classList) {
                    activeButton.classList.add('active');
                }
            } catch (error) {
                console.error('Error in showTab:', error);
            }
        }

        function initializeSectorButtons() {
            const sectorButtons = document.querySelectorAll('.sector-button');
            sectorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sectorName = this.getAttribute('data-sector');
                    showSectorDetail(sectorName, this);
                });
            });
        }

        function showSectorDetail(sector, clickedButton) {
            try {
                const details = document.querySelectorAll('.sector-detail');
                details.forEach(detail => detail.classList.remove('show'));

                const buttons = document.querySelectorAll('.sector-button');
                buttons.forEach(button => button.classList.remove('active'));

                const targetDetail = document.getElementById(sector + '-detail');
                if (targetDetail) {
                    targetDetail.classList.add('show');
                    clickedButton.classList.add('active');
                }
            } catch (error) {
                console.error('Error in showSectorDetail:', error);
            }
        }

        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keyup', searchContent);
            }
        }

        function searchContent() {
            try {
                const searchInput = document.getElementById('searchInput');
                const resultsDiv = document.getElementById('searchResults');
                
                if (!searchInput || !resultsDiv) return;
                
                const searchTerm = searchInput.value.toLowerCase();

                if (searchTerm.length < 2) {
                    resultsDiv.innerHTML = '<p style="text-align: center; color: var(--text-secondary); font-style: italic; margin: 2rem 0;">Enter a search term above to explore the Waterloo knowledge base.<br>Try searching for: "Napoleon", "Wellington", "Imperial Guard", "Ney", "Hougoumont", etc.</p>';
                    return;
                }

                let results = [];
                
                for (const key in knowledgeBase) {
                    if (knowledgeBase.hasOwnProperty(key)) {
                        const value = knowledgeBase[key];
                        if (key.toLowerCase().includes(searchTerm) || value.toLowerCase().includes(searchTerm)) {
                            results.push({
                                title: key,
                                content: value,
                                relevance: key.toLowerCase().startsWith(searchTerm) ? 2 : 1
                            });
                        }
                    }
                }

                results.sort((a, b) => b.relevance - a.relevance);

                if (results.length === 0) {
                    resultsDiv.innerHTML = `<div class="section-card"><h3 style="color: var(--accent-1);">No results found for "${searchInput.value}"</h3><p>Try searching for commander names, key locations, units, or tactics.</p></div>`;
                    return;
                }

                let resultHTML = `<h3 style="color: var(--accent-1); margin-bottom: 1.5rem;">Search Results for "${searchInput.value}"</h3>`;
                
                for (let i = 0; i < results.length; i++) {
                    const result = results[i];
                    const highlightedContent = result.content.replace(new RegExp(searchTerm, 'gi'), '<span class="highlight">$&</span>');
                    
                    resultHTML += `<div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid var(--accent-1);"><h4 style="color: var(--accent-1); margin-bottom: 0.8rem;">${result.title}</h4><p style="line-height: 1.6;">${highlightedContent}</p></div>`;
                }

                resultsDiv.innerHTML = resultHTML;
            } catch (error) {
                console.error('Error in searchContent:', error);
            }
        }
    </script>
</body>
</html>
