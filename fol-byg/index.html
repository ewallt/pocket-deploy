<!DOCTYPE html>
<html lang="en" class="theme-newspaper">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Folio — Template (CR JSON compatible)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Custom Properties for Theming */
    /* Default Theme: Newspaper (light, serif) */
    :root {
      --bg-gradient: #fdfdf8;
      --text: #1c1c1c;
      --accent-text: #8c1c13;
      --nav-bg: #f1f1eb;
      --nav-border: #dcdcd3;
      --nav-text: #1c1c1c;
      --nav-hover-bg: #e5e5dd;
      --nav-active-bg: #dcdcd3;
      --nav-active-text: #1c1c1c;
      --prose-text: var(--text);
      --prose-headings: var(--accent-text);
      --prose-links: var(--accent-text);
      --prose-bold: var(--text);
      font-family: 'Merriweather', serif;
      line-height: 1.6;
    }

    .theme-emerald-paper,
    .theme-cyber-blue,
    .theme-emerald-gold {
      font-family: 'Lato', sans-serif;
      line-height: 1.6;
    }

    .theme-emerald-paper {
      --bg-gradient: #f7fbf9;
      --text: #1e2b28;
      --accent-text: #0f7f6d;
      --nav-bg: #e7f3ef;
      --nav-border: #86c8ba;
      --nav-text: #1e2b28;
      --nav-hover-bg: #d7ece6;
      --nav-active-bg: #bfe3d9;
      --nav-active-text: #1e2b28;
      --prose-text: #1e2b28;
      --prose-headings: #0f7f6d;
    }

    .theme-cyber-blue {
      --bg-gradient: #0f172a;
      --text: #e5e7eb;
      --accent-text: #94a3b8;
      --nav-bg: #0f172a;
      --nav-border: #1f2937;
      --nav-text: #e5e7eb;
      --nav-hover-bg: #111827;
      --nav-active-bg: #1f2937;
      --nav-active-text: #e5e7eb;
      --prose-text: #d1d5db;
      --prose-headings: #cbd5e1;
    }

    .theme-emerald-gold {
      --bg-gradient: #064e3b;
      --text: #ecfdf5;
      --accent-text: #f0c475;
      --nav-bg: #064e3b;
      --nav-border: #d4a24c;
      --nav-text: #ecfdf5;
      --nav-hover-bg: #065f46;
      --nav-active-bg: #0b3d31;
      --nav-active-text: #f0c475;
      --prose-text: #a7f3d0;
      --prose-headings: #f0c475;
    }

    body { background-color: var(--bg-gradient); color: var(--text); min-height: 100vh; }
    .ui-bg { background-color: var(--nav-bg); }
    .ui-border { border-color: var(--nav-border); }
    .text-primary { color: var(--text); }
    .text-accent { color: var(--accent-text); }
    *:focus-visible { outline: 3px solid var(--accent-text); outline-offset: 2px; border-radius: 2px; }

    .prose { color: var(--prose-text); }
    .prose h2, .prose h3 { color: var(--prose-headings); }
    .prose a { color: var(--prose-links); text-decoration: underline; }
    .prose strong { color: var(--prose-bold); font-weight: bold; }
    .prose h2 { font-size: 1.875rem; line-height: 2.25rem; margin-top: 2rem; margin-bottom: 1rem; font-weight: 700; border-bottom: 1px solid var(--nav-border); padding-bottom: 0.5rem; }
    .prose h3 { font-size: 1.5rem; line-height: 2rem; margin-top: 1.5rem; margin-bottom: 0.75rem; font-weight: 700; }
    .prose p, .prose ul, .prose ol { margin-bottom: 1rem; }
    .prose ul { list-style-position: inside; }
    .prose li { margin-bottom: 0.5rem; }
    .prose blockquote { border-left: 4px solid var(--nav-border); padding-left: 1rem; margin: 1rem 0; font-style: italic; }
    .prose .note {
      font-size: 0.95rem;
      background-color: var(--nav-bg);
      border: 1px solid var(--nav-border);
      padding: 1rem;
      border-radius: 0.5rem;
    }

    .prose .cite { display: none; }
    .prose .cite:not(:empty) { display: inline; font-size: 0.75rem; color: var(--accent-text); vertical-align: super; line-height: 0; }

    body, .ui-bg, .ui-border, .prose, .prose h2, .prose h3, .prose a, .prose strong, .prose .cite {
      transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
    }

    .nav-link[aria-current="page"] {
      background-color: var(--nav-active-bg);
      color: var(--nav-active-text);
      font-weight: bold;
    }
  </style>
</head>
<body class="antialiased">

<!-- Data island for drop-in JSON (optional). If empty, falls back to content.json or window.__CONTENT__ -->
<script id="app-data" type="application/json">
{
  "behold-your-god-outline": {
    "title": "Behold Your God — Thematic Outline",
    "description": "A study scaffold for Fred T. Wright’s Behold Your God: core ideas and arguments organized chapter by chapter within six thematic blocks.",
    "categories": {
      "block-1-supreme-theme": {
        "display_order": 10,
        "name": "block-1-supreme-theme",
        "display_name": "Block 1 — The Supreme Theme (Chs. 1–5)",
        "paragraphs": [
          {
            "heading": "Ch. 1 — An All-Important Theme",
            "content": "**Core Idea:** Our concept of God governs everything in religion; knowing Him rightly is life eternal (John 17:3).\n\n**Arguments:**\n- Israel’s crown→cross reversal came from a false concept of God.\n- We’re prone to reject corrective light when it clashes with preconceptions.\n- True prayer pleads for deliverance from falsehood.\n- Eternal life is relational knowledge of God (John 17:3)."
          },
          {
            "heading": "Ch. 2 — This Is Eternal Life",
            "content": "**Core Idea:** Knowing God in Christ is itself life eternal and transformative.\n\n**Arguments:**\n- John 17:3 = life eternal = knowing God.\n- Grace and power flow through the knowledge of Him (2 Pet 1:2–4).\n- Misrepresentations require patient unlearning.\n- Paul traces moral collapse to rejecting the knowledge of God (Rom 1)."
          },
          {
            "heading": "Ch. 3 — Avoid Speculative Theories",
            "content": "**Core Idea:** Remain within revelation; speculation outside God’s disclosure leads to distortion.\n\n**Arguments:**\n- Danger of seeking knowledge outside what God has revealed.\n- Deut 29:29: secret things belong to God; revealed things are sufficient.\n- God reveals as fast as we can bear (Eph 3).\n- Balance: avoid both speculation and neglect; Christ defines saving knowledge."
          },
          {
            "heading": "Ch. 4 — In Relation to the Great Controversy",
            "content": "**Core Idea:** God’s character is the central issue of the great controversy.\n\n**Arguments:**\n- Cannot study God’s character apart from the controversy theme.\n- Lucifer misrepresented God as arbitrary, sowing distrust.\n- His first success on earth came through misrepresenting God to Eve.\n- Prophets and Christ confirm: misapprehension of God = darkness; remedy = revelation.\n- The controversy ends only when misconceptions are removed and allegiance is freely given."
          },
          {
            "heading": "Ch. 5 — The Ending of the Great Controversy",
            "content": "**Core Idea:** The cross revealed God’s character; the final message (Rev 18) finishes the work by reproducing that character in His people.\n\n**Arguments:**\n- Even heavenly beings unsettled until Calvary clarified God’s justice and love.\n- At the cross, Satan unmasked; God wins by truth and love.\n- Humanity remains deceived; prophecy foretells a final illuminating message.\n- Rev 18:1: the final warning is a movement of people embodying God’s glory.\n- Glory = God’s character (Ex 33–34; Jn 1:14).\n- Christ returns when His character is perfectly reproduced in His people."
          }
        ]
      },
      "block-2-law-government": {
        "display_order": 20,
        "name": "block-2-law-government",
        "display_name": "Block 2 — God’s Law and Government (Chs. 6–10)",
        "paragraphs": [
          {
            "heading": "Ch. 6 — Isaiah’s Wonderful Prophecy",
            "content": "**Core Idea:** Isaiah foretold Christ’s mission as opening blind eyes and bringing light, not by force but by revelation.\n\n**Arguments:**\n- Jesus worked quietly, not crushing or coercing (Isa 42).\n- Darkness = misapprehension of God; light = revelation of His character.\n- Christ’s method: healing, teaching, revealing the Father.\n- Prophecy frames Messiah’s work as restoring knowledge of God."
          },
          {
            "heading": "Ch. 7 — Approaching the Study of God",
            "content": "**Core Idea:** Study of God requires reverence, humility, and openness to His revelation.\n\n**Arguments:**\n- The finite cannot define the infinite; speculation leads astray.\n- God has given enough for saving knowledge.\n- True study is transformative, not merely intellectual.\n- Method: careful, prayerful Scripture study letting the Bible interpret itself."
          },
          {
            "heading": "Ch. 8 — The Constitution of the Government of God",
            "content": "**Core Idea:** God’s law is the foundation of His government, maintained without force.\n\n**Arguments:**\n- Law = transcript of His character, immutable as He is.\n- Government rests on freedom; coercion is foreign.\n- God Himself abides by His law.\n- The law shows that God sustains life through love and truth."
          },
          {
            "heading": "Ch. 9 — A Perfect Law",
            "content": "**Core Idea:** The law perfectly expresses God’s will for all relationships.\n\n**Arguments:**\n- Wages of sin = death; wages of righteousness = life.\n- Law is a gift that guards harmony with reality.\n- Regulates man-to-God, man-to-man, and man-to-self relations.\n- Law reflects divine perfection and covers every sphere of life."
          },
          {
            "heading": "Ch. 10 — God’s Principles Under Test",
            "content": "**Core Idea:** Satan attacks God’s law and character to portray them as unjust.\n\n**Arguments:**\n- Lucifer cast God’s law as restrictive.\n- Law and character stand or fall together.\n- History shows repeated misrepresentation of God as harsh.\n- God permits His principles to be tested so truth is seen."
          }
        ]
      },
      "block-3-interpreting-god": {
        "display_order": 30,
        "name": "block-3-interpreting-god",
        "display_name": "Block 3 — Interpreting God’s Ways (Chs. 11–15)",
        "paragraphs": [
          {
            "heading": "Ch. 11 — A Summary",
            "content": "**Core Idea:** The first section’s key point is restated: knowing God’s character is life eternal, revealed supremely in Christ.\n\n**Arguments:**\n- Review: knowing God = life; misrepresentation = death.\n- Great controversy centers on God’s law and character.\n- Christ and the cross reveal God decisively.\n- Next step: resolving apparent contradictions."
          },
          {
            "heading": "Ch. 12 — Contrasting Statements",
            "content": "**Core Idea:** Scripture sometimes seems contradictory about God’s actions; these must be reconciled by principle.\n\n**Arguments:**\n- Some texts show God destroying, others restraining.\n- Superficial reading causes confusion.\n- Tensions are expected when finite minds read the infinite.\n- Careful interpretation, not dismissal, is needed."
          },
          {
            "heading": "Ch. 13 — Statements and Principles",
            "content": "**Core Idea:** Hermeneutics requires distinguishing statements from principles.\n\n**Arguments:**\n- Bible interprets itself; avoid private interpretation.\n- God’s ways are higher than man’s.\n- Terms must be defined by Scripture itself.\n- Example: William Miller’s comparison method.\n- Adventist pioneers reinforced this principle-based reading."
          },
          {
            "heading": "Ch. 14 — God Does Destroy: But How?",
            "content": "**Core Idea:** When Scripture says God destroys, it must harmonize with His love and freedom.\n\n**Arguments:**\n- Case studies: Saul, Jerusalem, serpents, Job.\n- Destruction comes as God withdraws protection, not as arbitrary force.\n- Satan is destroyer; God permits consequences.\n- Bible sometimes attributes to God what He only permits.\n- Pharaoh’s heart hardened = God allowed his choice.\n- Conclusion: God destroys by allowing sin’s results."
          },
          {
            "heading": "Ch. 15 — The Supreme Revelation",
            "content": "**Core Idea:** The cross is the ultimate revelation of how God deals with sin.\n\n**Arguments:**\n- Christ bore sin’s results (separation, death).\n- The cross demonstrates justice and love united.\n- Satan unmasked; God’s character revealed.\n- All interpretation must be cross-centered."
          }
        ]
      },
      "block-4-christ-ministry-law": {
        "display_order": 40,
        "name": "block-4-christ-ministry-law",
        "display_name": "Block 4 — Christ’s Ministry and the Law (Chs. 16–20)",
        "paragraphs": [
          {
            "heading": "Ch. 16 — Urged to Destroy",
            "content": "**Core Idea:** Christ’s responses to calls for destruction reveal God’s true way.\n\n**Arguments:**\n- Samaritan rejection: Jesus rebuked coercive spirit.\n- Fig tree: enacted parable of fruitlessness, not vindictiveness.\n- Temple cleansing: reform, not violence.\n- Judgments are revelatory and corrective, not forceful."
          },
          {
            "heading": "Ch. 17 — Magnifying the Law",
            "content": "**Core Idea:** Jesus magnified the law by revealing its spirit.\n\n**Arguments:**\n- God’s law = His character; cannot be annulled.\n- Christ emphasized love, exposing Pharisaic distortions.\n- Satan magnifies falsely by burdens and harshness.\n- Christ magnifies rightly by mercy and liberation.\n- Final conflict centers on law’s true character."
          },
          {
            "heading": "Ch. 18 — Go the Second Mile",
            "content": "**Core Idea:** Sermon on the Mount reveals the radical ethic of God’s kingdom.\n\n**Arguments:**\n- Law penetrates motives, not just acts.\n- Love extends even to enemies.\n- Going the second mile shows divine love’s freedom.\n- Love may withhold fellowship but not goodwill.\n- One law applies equally to all."
          },
          {
            "heading": "Ch. 19 — The Mystery of Iniquity",
            "content": "**Core Idea:** Evil masquerades as religion, distorting God’s character.\n\n**Arguments:**\n- Sin presents itself as righteousness.\n- Religious systems adopt coercion, mirroring Satan.\n- Counterfeit magnifies law falsely.\n- Christ reveals God’s true character, exposing deception."
          },
          {
            "heading": "Ch. 20 — The Mystery-Unfolding Cross",
            "content": "**Core Idea:** The cross unveils both sin’s depth and God’s response.\n\n**Arguments:**\n- Christ died by separation, not inflicted punishment.\n- Wicked punished by same principle: sin destroys.\n- The cross unmasks Satan and reveals God’s love.\n- Justice and mercy harmonized at Calvary."
          }
        ]
      },
      "block-5-way-of-cross": {
        "display_order": 50,
        "name": "block-5-way-of-cross",
        "display_name": "Block 5 — The Way of the Cross (Chs. 21–25)",
        "paragraphs": [
          {
            "heading": "Ch. 21 — The Way of the Cross",
            "content": "**Core Idea:** The cross is both revelation and pattern for believers.\n\n**Arguments:**\n- Cross = infinite revelation of God’s love.\n- Two crosses: God’s love vs. Satan’s coercion.\n- Cross reveals character, not just legal act.\n- Lucifer rejected self-denial.\n- Apostasy = counterfeit cross of force.\n- Discipleship = taking up the cross."
          },
          {
            "heading": "Ch. 22 — The Cross and Apostasy",
            "content": "**Core Idea:** Apostasy comes from rejecting the principle of the cross.\n\n**Arguments:**\n- History shows religion choosing force.\n- Systems adopt coercion, aligning with Satan.\n- Apostasy denies the cross as God’s way.\n- True discipleship = embracing cross life."
          },
          {
            "heading": "Ch. 23 — The Believer’s Identification with the Cross",
            "content": "**Core Idea:** Salvation means uniting with the cross in daily life.\n\n**Arguments:**\n- Paul: crucified with Christ.\n- Victory over sin through self-denial and love.\n- Believers become revelations of God’s character.\n- Essential for final conflict readiness."
          },
          {
            "heading": "Ch. 24 — The Cross in the Final Message",
            "content": "**Core Idea:** The last proclamation is the cross embodied in God’s people.\n\n**Arguments:**\n- Rev 18: earth lightened with glory = character.\n- Message is embodied, not just spoken.\n- Testimony unmasks Satan’s lies.\n- When Christ’s character is reproduced, controversy ends."
          },
          {
            "heading": "Ch. 25 — The Cross and Eternal Security",
            "content": "**Core Idea:** The cross secures the universe forever.\n\n**Arguments:**\n- Universe saw sin’s results at Calvary.\n- Justice and mercy harmonized.\n- All beings now trust God freely.\n- Loyalty ensures rebellion never rises again."
          }
        ]
      },
      "block-6-final-showdown": {
        "display_order": 60,
        "name": "block-6-final-showdown",
        "display_name": "Block 6 — Final Issues and Showdown (Chs. 26–39)",
        "paragraphs": [
          {
            "heading": "Ch. 26 — The Cross and Judgment",
            "content": "**Core Idea:** Judgment is revealed in the cross.\n\n**Arguments:**\n- Christ bore sin’s results, not divine vengeance.\n- Cross shows judgment = consequence.\n- Final judgment follows same principle."
          },
          {
            "heading": "Ch. 27 — The Cross and the Final Conflict",
            "content": "**Core Idea:** Last struggle = cross principle vs. coercion.\n\n**Arguments:**\n- Satan’s way = compulsion.\n- God’s way = persuasion.\n- Conflict centers on worship.\n- Overcoming by Lamb’s blood."
          },
          {
            "heading": "Ch. 28 — The Cross and God’s People",
            "content": "**Core Idea:** God’s remnant embody the cross.\n\n**Arguments:**\n- Reflect God’s character (Rev 14:12).\n- Witness is experiential.\n- Endurance proves God’s way works."
          },
          {
            "heading": "Ch. 29 — The Cross and the World",
            "content": "**Core Idea:** The cross is God’s last appeal to humanity.\n\n**Arguments:**\n- Loud cry = final call.\n- Choice between self-preservation vs. surrender.\n- World divided into two camps."
          },
          {
            "heading": "Ch. 30 — The Cross and the Universe",
            "content": "**Core Idea:** The cross secures universal loyalty.\n\n**Arguments:**\n- Angels watched the cross.\n- Satan and God unmasked.\n- Universe now trusts God."
          },
          {
            "heading": "Ch. 31 — The Cross and Freedom",
            "content": "**Core Idea:** The cross proves God’s government is based on freedom.\n\n**Arguments:**\n- Christ refused coercion.\n- Freedom essential to love.\n- Universe saw true rule."
          },
          {
            "heading": "Ch. 32 — The Cross and Love",
            "content": "**Core Idea:** Calvary = fullest revelation of love.\n\n**Arguments:**\n- Christ died for enemies.\n- Love is unconditional.\n- Love is government’s law."
          },
          {
            "heading": "Ch. 33 — The Cross and Truth",
            "content": "**Core Idea:** The cross discloses truth fully.\n\n**Arguments:**\n- Christ’s testimony unveiled truth.\n- Satan’s lies refuted.\n- Truth embodied in Christ."
          },
          {
            "heading": "Ch. 34 — The Cross and Power",
            "content": "**Core Idea:** True power = self-giving love.\n\n**Arguments:**\n- Human power = domination.\n- Christ’s weakness conquered.\n- Resurrection confirmed God’s way."
          },
          {
            "heading": "Ch. 35 — The Cross and Victory",
            "content": "**Core Idea:** Calvary secured decisive victory.\n\n**Arguments:**\n- Satan cast down (Jn 12).\n- Charges answered, character exposed.\n- Victory personal and cosmic."
          },
          {
            "heading": "Ch. 36 — The Cross and Security",
            "content": "**Core Idea:** The cross guarantees eternal safety.\n\n**Arguments:**\n- Sin’s results fully revealed.\n- God’s justice and mercy harmonized.\n- No reason to doubt remains."
          },
          {
            "heading": "Ch. 37 — The Cross and the End",
            "content": "**Core Idea:** End comes when cross is fully revealed.\n\n**Arguments:**\n- Gospel of kingdom must reach all.\n- Final choice closes probation.\n- Christ’s return concludes controversy."
          },
          {
            "heading": "Ch. 38 — The Cross and the New Earth",
            "content": "**Core Idea:** The new creation reflects cross principles.\n\n**Arguments:**\n- Eternal life ordered by love.\n- Redeemed study the cross forever.\n- History of sin is safeguard."
          },
          {
            "heading": "Ch. 39 — The Final Showdown",
            "content": "**Core Idea:** The controversy closes with God vindicated.\n\n**Arguments:**\n- Showdown = whose character we reflect.\n- Satan uses coercion; God’s people reflect love.\n- Universal acknowledgment of God’s justice."
          }
        ]
      }
    }
  }
}
</script>

<div class="relative min-h-screen md:flex">
  <div class="ui-bg flex justify-between md:hidden sticky top-0 z-20 border-b ui-border">
    <button id="mobile-menu-btn" aria-controls="nav-panel" aria-expanded="false" class="p-4 text-primary hover:bg-[var(--nav-hover-bg)]">
      <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <span class="sr-only">Open Menu</span>
    </button>
    <div class="p-2">
      <button id="theme-switcher-btn-mobile" aria-haspopup="dialog" aria-expanded="false" class="p-2 rounded-full hover:bg-[var(--nav-hover-bg)] text-primary">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.95 10.55a8 8 0 1 0-9.4 9.4 8 8 0 0 0 9.4-9.4ZM12 20a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-14a6 6 0 0 0 0 12V6Z"/></svg>
        <span class="sr-only">Open Theme Settings</span>
      </button>
    </div>
  </div>

  <nav id="nav-panel" class="ui-bg text-primary w-64 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out z-30 md:flex flex-col border-r ui-border">
    <div class="p-4 border-b ui-border">
      <h1 id="app-title" class="text-xl font-bold text-accent">Folio Title</h1>
      <p id="app-subtitle" class="text-sm"></p>
    </div>
    <ul id="nav-links" class="flex-grow p-2" role="menu"></ul>
    <div class="p-4 border-t ui-border hidden md:block">
      <button id="theme-switcher-btn-desktop" aria-haspopup="dialog" aria-expanded="false" class="w-full flex items-center justify-center p-2 rounded hover:bg-[var(--nav-hover-bg)] text-primary">
        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.95 10.55a8 8 0 1 0-9.4 9.4 8 8 0 0 0 9.4-9.4ZM12 20a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-14a6 6 0 0 0 0 12V6Z"/></svg>
        <span>Theme Settings</span>
      </button>
    </div>
  </nav>
  <div id="nav-overlay" class="fixed inset-0 bg-black/50 z-20 hidden md:hidden"></div>

  <main class="flex-1 p-6 sm:p-8 lg:p-12">
    <div class="max-w-4xl mx-auto prose" id="content-root">
      <!-- Panels generated from JSON will appear here -->
    </div>
  </main>
</div>

<div id="theme-modal" role="dialog" aria-modal="true" aria-labelledby="theme-modal-title" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden">
  <div id="theme-modal-content" class="ui-bg rounded-lg shadow-xl p-6 w-full max-w-sm border ui-border">
    <div class="flex justify-between items-center mb-4">
      <h2 id="theme-modal-title" class="text-lg font-bold text-primary">Display Settings</h2>
      <button id="theme-modal-close" class="p-1 rounded-full hover:bg-[var(--nav-hover-bg)] text-primary">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        <span class="sr-only">Close settings</span>
      </button>
    </div>
    <fieldset>
      <legend class="sr-only">Choose a theme</legend>
      <div class="space-y-2" id="theme-options">
        <label class="flex items-center p-3 rounded-md border ui-border hover:bg-[var(--nav-hover-bg)] cursor-pointer">
          <input type="radio" name="theme" value="theme-newspaper" class="h-4 w-4 mr-3">
          <span class="text-primary">Newspaper (Default)</span>
        </label>
        <label class="flex items-center p-3 rounded-md border ui-border hover:bg-[var(--nav-hover-bg)] cursor-pointer">
          <input type="radio" name="theme" value="theme-emerald-paper" class="h-4 w-4 mr-3">
          <span class="text-primary">Emerald Paper</span>
        </label>
        <label class="flex items-center p-3 rounded-md border ui-border hover:bg-[var(--nav-hover-bg)] cursor-pointer">
          <input type="radio" name="theme" value="theme-cyber-blue" class="h-4 w-4 mr-3">
          <span class="text-primary">Cyber Blue (Dark)</span>
        </label>
        <label class="flex items-center p-3 rounded-md border ui-border hover:bg-[var(--nav-hover-bg)] cursor-pointer">
          <input type="radio" name="theme" value="theme-emerald-gold" class="h-4 w-4 mr-3">
          <span class="text-primary">Emerald Gold (Dark)</span>
        </label>
      </div>
    </fieldset>
  </div>
</div>

<div class="p-4 text-center text-xs text-gray-500">
  <details>
    <summary>Developer Validation Checklist</summary>
    <ul class="text-left mt-2 max-w-md mx-auto list-disc list-inside">
      <li>[X] Single index.html file.</li>
      <li>[X] Tailwind via CDN; vanilla JS.</li>
      <li>[X] Fully responsive; keyboard & touch accessible.</li>
      <li>[X] Four themes via CSS variables; persisted in localStorage.</li>
      <li>[X] View state persisted without changing original UX.</li>
      <li>[X] Content supplied by JSON: data-island > content.json > window.__CONTENT__.</li>
    </ul>
  </details>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const state = {
    activeView: 'introduction',
    activeTheme: 'theme-newspaper',
    themeOpen: false,
    mobileNavOpen: false,
    storagePrefix: 'folio_ntw_'
  };

  const navLinks = document.getElementById('nav-links');
  const navPanel = document.getElementById('nav-panel');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const navOverlay = document.getElementById('nav-overlay');
  const themeBtns = [document.getElementById('theme-switcher-btn-desktop'), document.getElementById('theme-switcher-btn-mobile')];
  const themeModal = document.getElementById('theme-modal');
  const themeModalContent = document.getElementById('theme-modal-content');
  const themeModalCloseBtn = document.getElementById('theme-modal-close');
  const themeOptions = document.getElementById('theme-options');
  const htmlEl = document.documentElement;
  const contentRoot = document.getElementById('content-root');
  const appTitleEl = document.getElementById('app-title');
  const appSubtitleEl = document.getElementById('app-subtitle');

  let focusBeforeModal;

  async function loadContent() {
    const island = document.getElementById('app-data');
    if (island) {
      const raw = island.textContent.trim();
      if (raw && raw !== '{}' && raw.length > 2) {
        try { return JSON.parse(raw); } catch (e) { console.warn('Invalid JSON in data island:', e); }
      }
    }
    try {
      const res = await fetch('content.json', { cache: 'no-store' });
      if (res.ok) return await res.json();
    } catch (e) {}
    if (window.__CONTENT__) return window.__CONTENT__;
    if (window.__CR_APP__) return window.__CR_APP__;
    throw new Error('No content JSON found. Provide it via the #app-data script tag, a content.json file, or window.__CONTENT__.');
  }

  /* === allow {meta, sections,...} by converting to CR {categories} === */
  function sectionAppToCR(root) {
    const title = root.meta?.title || 'Untitled';
    const description = root.meta?.subtitle || '';
    const categories = {};
    (root.sections || []).forEach((s, idx) => {
      const slug = s.id || ('section-' + (idx + 1));
      const paragraphs = [];

      if (Array.isArray(s.bullets) && s.bullets.length) {
        const lis = s.bullets.map(b => `<li>${b}</li>`).join('');
        paragraphs.push({ heading: 'Key points', content: `<ul>${lis}</ul>` });
      }

      (s.items || []).forEach(it => {
        const heading = it.label || it.summary || '';
        const detail = (it.summary ? `<em>${it.summary}</em> ` : '') + (it.detail || '');
        paragraphs.push({ heading, content: detail });
      });

      categories[slug] = {
        display_order: s.display_order ?? (idx + 1),
        name: s.title || slug,
        display_name: s.title || slug,
        introduction: s.intro || '',
        paragraphs
      };
    });
    return { title, description, categories };
  }

  function normalizeFlexible(data) {
    if (data && typeof data === 'object' && data.categories) return data;
    if (data && typeof data === 'object' && (Array.isArray(data.sections) || data.meta)) {
      return sectionAppToCR(data);
    }
    const keys = data ? Object.keys(data) : [];
    if (!keys.length) throw new Error('Empty content.');
    const first = data[keys[0]];
    if (first?.categories) return first;
    if (first && (Array.isArray(first.sections) || first.meta)) return sectionAppToCR(first);
    throw new Error('Unsupported content shape. Expected {categories} or {sections}.');
  }
  /* === /transform === */

  function catArray(app) {
    return Object.entries(app.categories || {}).map(([slug, c]) => ({
      slug,
      display_order: c.display_order ?? 999,
      display_name: c.display_name || c.name || slug,
      introduction: c.introduction || '',
      paragraphs: Array.isArray(c.paragraphs) ? c.paragraphs : []
    })).sort((a, b) => (a.display_order - b.display_order) || a.display_name.localeCompare(b.display_name));
  }

  function renderApp(app) {
    appTitleEl.textContent = app.title || 'Untitled';
    appSubtitleEl.textContent = app.description || '';

    const cats = catArray(app);
    if (!cats.length) {
      contentRoot.innerHTML = '<div class="p-4 rounded border border-yellow-300 bg-yellow-50 text-yellow-800">No sections available.</div>';
      return;
    }

    const slugSet = new Set(cats.map(c => c.slug));

    navLinks.innerHTML = '';
    for (const c of cats) {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + c.slug;
      a.className = 'nav-link block p-2 rounded hover:bg-[var(--nav-hover-bg)]';
      a.role = 'menuitem';
      a.dataset.view = c.slug;
      a.textContent = c.display_name;
      li.appendChild(a);
      navLinks.appendChild(li);
    }

    contentRoot.innerHTML = '';
    for (const c of cats) {
      const art = document.createElement('article');
      art.id = c.slug;
      art.className = 'content-panel';
      const h2 = document.createElement('h2');
      h2.textContent = c.display_name;
      art.appendChild(h2);
      if (c.introduction) {
        const p = document.createElement('p');
        p.className = 'note';
        p.innerHTML = c.introduction;
        art.appendChild(p);
      }
      for (const p of c.paragraphs) {
        if (p.heading) {
          const h3 = document.createElement('h3');
          h3.textContent = p.heading;
          art.appendChild(h3);
        }
        if (p.content) {
          const para = document.createElement('p');
          para.innerHTML = p.content;
          art.appendChild(para);
        }
      }
      contentRoot.appendChild(art);
    }

    const savedView = localStorage.getItem(state.storagePrefix + 'view');
    const firstSlug = cats[0].slug;
    const requested = (location.hash || '').replace(/^#/, '') || savedView || firstSlug;
    const initial = slugSet.has(requested) ? requested : firstSlug;

    updateView(initial, false);

    // keep URL + back/forward in sync
    window.addEventListener('hashchange', () => {
      const h = (location.hash || '').replace(/^#/, '');
      updateView(slugSet.has(h) ? h : firstSlug);
    });
  }

  function updateView(viewId, save = true) {
    state.activeView = viewId;

    for (const panel of contentRoot.querySelectorAll('.content-panel')) {
      panel.classList.toggle('hidden', panel.id !== viewId);
    }

    for (const link of navLinks.querySelectorAll('a.nav-link')) {
      const isCurrent = link.dataset.view === viewId;
      link.setAttribute('aria-current', isCurrent ? 'page' : 'false');
    }

    const activeLink = navLinks.querySelector(`[data-view="${viewId}"]`);
    if (activeLink) {
      document.title = `${activeLink.textContent} | ${appTitleEl.textContent}`;
    }

    if (save) {
      localStorage.setItem(state.storagePrefix + 'view', viewId);
    }
  }

  function loadTheme() {
    const saved = localStorage.getItem(state.storagePrefix + 'theme');
    state.activeTheme = saved || 'theme-newspaper';
    applyTheme(state.activeTheme, false);
  }

  function applyTheme(themeClass, save = true) {
    state.activeTheme = themeClass;
    htmlEl.className = themeClass;
    themeOptions.querySelectorAll('input[name="theme"]').forEach(r => r.checked = (r.value === themeClass));
    if (save) localStorage.setItem(state.storagePrefix + 'theme', themeClass);
  }

  function toggleMobileNav(forceClose = false) {
    state.mobileNavOpen = forceClose ? false : !state.mobileNavOpen;
    if (state.mobileNavOpen) {
      navPanel.classList.remove('-translate-x-full');
      navOverlay.classList.remove('hidden');
      mobileMenuBtn.setAttribute('aria-expanded', 'true');
    } else {
      navPanel.classList.add('-translate-x-full');
      navOverlay.classList.add('hidden');
      mobileMenuBtn.setAttribute('aria-expanded', 'false');
    }
  }

  function openThemeModal() {
    focusBeforeModal = document.activeElement;
    themeModal.classList.remove('hidden');
    themeBtns.forEach(b => b.setAttribute('aria-expanded', 'true'));
    const first = themeModal.querySelector('input[name="theme"]');
    if (first) first.focus();
    state.themeOpen = true;
  }
  function closeThemeModal() {
    themeModal.classList.add('hidden');
    themeBtns.forEach(b => b.setAttribute('aria-expanded', 'false'));
    state.themeOpen = false;
    if (focusBeforeModal) focusBeforeModal.focus();
  }

  navLinks.addEventListener('click', (e) => {
    const a = e.target.closest('a.nav-link');
    if (!a) return;
    e.preventDefault();
    const viewId = a.dataset.view;
    updateView(viewId);
    if (state.mobileNavOpen) toggleMobileNav(true);
    window.scrollTo({ top: 0, behavior: 'smooth' });
    history.replaceState(null, '', '#' + viewId);
  });

  mobileMenuBtn.addEventListener('click', () => toggleMobileNav());
  navOverlay.addEventListener('click', () => toggleMobileNav(true));

  themeBtns.forEach(btn => btn.addEventListener('click', openThemeModal));
  themeModalCloseBtn.addEventListener('click', closeThemeModal);
  themeModal.addEventListener('click', (e) => { if (e.target === themeModal) closeThemeModal(); });
  themeOptions.addEventListener('change', (e) => {
    if (e.target.name === 'theme') applyTheme(e.target.value);
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (state.themeOpen) closeThemeModal();
      if (state.mobileNavOpen) toggleMobileNav(true);
    }
    if (state.themeOpen && e.key === 'Tab') {
      const focusables = Array.from(themeModalContent.querySelectorAll('button, input'));
      const first = focusables[0], last = focusables[focusables.length - 1];
      if (!first || !last) return;
      if (e.shiftKey && document.activeElement === first) { last.focus(); e.preventDefault(); }
      if (!e.shiftKey && document.activeElement === last) { first.focus(); e.preventDefault(); }
    }
  });

  (async function init(){
    try {
      const raw = await loadContent();
      const app = normalizeFlexible(raw);

      // safer per-project storage key (uses app.title when available)
      state.storagePrefix = 'folio_' + ((app.title || Object.keys(raw||{})[0] || 'app')
        .toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'')) + '_';

      renderApp(app);
      loadTheme();
    } catch (err) {
      document.body.innerHTML = '<div class="max-w-2xl mx-auto p-6 mt-8 rounded border border-red-300 bg-red-50 text-red-700">' +
        '<strong>Content error:</strong> ' + (err?.message || err) +
        '<div class="mt-2 text-sm">Provide JSON via #app-data, a content.json file, or window.__CONTENT__.</div>' +
        '</div>';
      console.error(err);
    }
  })();
});
</script>
</body>
</html>

