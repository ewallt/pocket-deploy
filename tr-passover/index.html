    <script>
    // Self-executing function to manage all theme logic.
    (function() {
        const DEFAULT_THEME_NAME = 'cyber-night';
    
        let THEMES = {
            'cyber-night': {
                '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
                '--accent-1': '#a8b8d0', '--accent-1-rgb': '168, 184, 208',
                '--accent-2': '#8899b3',
                '--btn-gradient': 'linear-gradient(45deg,#1a1a3a,#2e2e5e)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'teal-matrix': {
                '--bg-gradient': 'linear-gradient(135deg,#0a231c 0%,#1a3a31 50%,#2e5e50 100%)',
                '--accent-1': '#ace0d5', '--accent-1-rgb': '172, 224, 213',
                '--accent-2': '#92b3a9',
                '--btn-gradient': 'linear-gradient(45deg,#1a3a31,#2e5e50)',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--ui-background': '#345e55',
                '--ui-background-accent': 'rgba(52, 94, 85, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            },
            'red-alert': {
                '--bg-gradient': 'linear-gradient(135deg,#0a0a23 0%,#1a1a3a 50%,#2e2e5e 100%)',
                '--ui-background': '#34495e',
                '--ui-background-accent': 'rgba(52, 73, 94, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#e74c3c',
                '--accent-2': '#c03b2b',
                '--btn-gradient': 'linear-gradient(45deg,#e74c3c,#c0392b)',
                '--accent-1-rgb': '231, 76, 60',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--btn-text-active': '#ffffff'
            },
            'scorched-gold': {
                '--bg-gradient': 'linear-gradient(135deg,#0a231f 0%,#193a33 50%,#2e5e54 100%)',
                '--ui-background': '#345e56',
                '--ui-background-accent': 'rgba(52, 94, 86, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#f0c475',
                '--accent-2': '#d4a24c',
                '--btn-gradient': 'linear-gradient(45deg,#f0c475,#d4a24c)',
                '--accent-1-rgb': '240, 196, 117',
                '--btn-text-active': '#2a1d15',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57'
            },
            'crimson-emerald': {
                '--bg-gradient': 'linear-gradient(135deg,#0a230a 0%,#1a3a1a 50%,#2e5e2e 100%)',
                '--ui-background': '#345e49',
                '--ui-background-accent': 'rgba(52, 94, 73, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--accent-1': '#e04f7f',
                '--accent-2': '#c73363',
                '--btn-gradient': 'linear-gradient(45deg,#e04f7f,#c73363)',
                '--accent-1-rgb': '224, 79, 127',
                '--accent-warning': '#e8b339',
                '--accent-warning-rgb': '232, 179, 57',
                '--btn-text-active': '#ffffff'
            },
            'emerald-night': {
                '--bg-gradient': 'linear-gradient(135deg,#0a230a 0%,#1a3a1a 50%,#2e5e2e 100%)',
                '--accent-1': '#a8d0b8', '--accent-1-rgb': '168, 208, 184',
                '--accent-2': '#6a947a',
                '--btn-gradient': 'linear-gradient(45deg,#1a3a1a,#2e5e2e)',
                '--accent-warning': '#ffc107', '--accent-warning-rgb': '255, 193, 7',
                '--ui-background': '#345e49',
                '--ui-background-accent': 'rgba(52, 94, 73, 0.8)',
                '--container-background-subtle': 'rgba(0, 0, 0, 0.3)',
                '--btn-text-active': '#ecf0f1'
            }
        };

        // Automatically adds the correct hover text color variable to each theme
        function finalizeThemes(themes) {
            for (const themeName in themes) {
                const theme = themes[themeName];
                if (!theme['--btn-text-hover']) {
                    theme['--btn-text-hover'] = theme['--btn-text-active'];
                }
            }
            return themes;
        }

        THEMES = finalizeThemes(THEMES);
    
        function applyTheme(name) {
            const theme = THEMES[name];
            if (theme) {
                const root = document.documentElement;
                for (const [key, value] of Object.entries(theme)) {
                    root.style.setProperty(key, value);
                }
            }
        }
    
        window.setTheme = function(name) {
            applyTheme(name);
            localStorage.setItem('passover-theme', name); // Use a unique key for this app
        }
    
        const availableThemeNames = Object.keys(THEMES);
        const savedTheme = localStorage.getItem('passover-theme'); // Use a unique key for this app
        let themeToLoad = DEFAULT_THEME_NAME;

        if (savedTheme && availableThemeNames.includes(savedTheme)) {
            themeToLoad = savedTheme;
        }
        
        applyTheme(themeToLoad);
    
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabs();
            initializeModal();
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                themeSelect.innerHTML = '';
                availableThemeNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    themeSelect.appendChild(option);
                });
                themeSelect.value = themeToLoad;
            }
        });

        function initializeModal() {
            const modal = document.getElementById('settings-modal');
            const openBtn = document.getElementById('settings-btn');
            const closeBtn = document.getElementById('close-modal-btn');

            if (modal && openBtn && closeBtn) {
                openBtn.addEventListener('click', () => modal.classList.add('show'));
                closeBtn.addEventListener('click', () => modal.classList.remove('show'));
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) modal.classList.remove('show');
                });
            }
        }

        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
        }

        function showTab(tabName) {
            try {
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            } catch (error) { console.error('Error in showTab:', error); }
        }
    })();
    </script>
